;/*FB_PKG_DELIM*/

__d("LSDeleteThenInsertSharedAlbumContribution",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.filter(b.db.table(280).fetch([[[a[0],a[1],a[2],a[3]]]]),function(c){return b.i64.eq(c.sharedAlbumId,a[0])&&b.i64.eq(c.sharedAlbumContributionId,a[1])&&b.i64.eq(c.threadKey,a[2])&&c.messageId===a[3]&&b.i64.gt(c.authorityLevel,b.i64.cast([0,80]))}).next().then(function(c){var d=c.done;c.value;return d?b.db.table(280).put({sharedAlbumId:a[0],sharedAlbumContributionId:a[1],threadKey:a[2],messageId:a[3],mediaUrl:a[4],mediaUrlFallback:a[5],mediaWidth:a[6],mediaHeight:a[7],urlExpiryMs:a[8],authorityLevel:b.i64.cast([0,80])}):0})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxDeleteThenInsertSharedAlbumContributionStoredProcedure";a.__tables__=["shared_album_contributions"];e.exports=a}),null);
__d("LSUpdateOrInsertSharedAlbum",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(279).fetch([[[a[0],a[1]]]]).next().then(function(c,d){d=c.done;c=c.value;return d?b.sequence([function(c){return b.forEach(b.filter(b.db.table(279).fetch([[[a[0],a[1]]]]),function(c){return b.i64.eq(c.sharedAlbumId,a[0])&&b.i64.eq(c.threadKey,a[1])&&b.i64.lt(c.authorityLevel,a[6])}),function(a){return a["delete"]()})},function(c){return b.db.table(279).add({sharedAlbumId:a[0],threadKey:a[1],title:a[2],offlineThreadingId:a[3],authorityLevel:a[6],lastActivityTimestampMs:a[4],contributionCount:a[5]})}]):(c.item,b.forEach(b.db.table(279).fetch([[[a[0],a[1]]]]),function(b){var c=b.update;b.item;return c({title:a[2],offlineThreadingId:a[3],authorityLevel:a[6],lastActivityTimestampMs:a[4],contributionCount:a[5]})}))})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateOrInsertSharedAlbumStoredProcedure";a.__tables__=["shared_albums"];e.exports=a}),null);