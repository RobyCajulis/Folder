;/*FB_PKG_DELIM*/

__d("ArmadilloReceiveWriteDbFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5720");b=d("FalcoLoggerInternal").create("armadillo_receive_write_db_failure",a);e=b;g["default"]=e}),98);
__d("ArmadilloTaskHandlers",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";b={add:(a=c("JSResourceForInteraction"))("AddTaskHandler").__setRef("ArmadilloTaskHandlers"),get_messenger_db_dump_attachments_for_bug_reporting:a("GetMessengerDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),maw_get_devices:a("MAWGetDevicesTaskHandler").__setRef("ArmadilloTaskHandlers"),preload_messenger_db_dump_attachments_for_bug_reporting:a("PreloadDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),test:a("TestNativeTaskHandler").__setRef("ArmadilloTaskHandlers"),zenon_send_chatd_mws_message:a("MAWZenonSendMultiwayMsgChatdTaskHandler").__setRef("ArmadilloTaskHandlers")};g.TASK_HANDLERS_RESOURCES=b}),98);
__d("MAWCommonWebWorkerErrorLogging",["Env","ErrorGuard","ErrorPubSub","ErrorSetup","ErrorTransport","JSErrorLoggingConfig","SiteData","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(){(h||(h=c("ErrorGuard"))).skipGuardGlobal((i||(i=c("Env"))).nocatch),c("ErrorSetup").setup({appId:c("JSErrorLoggingConfig").appId,client_revision:c("SiteData").client_revision,extra:c("JSErrorLoggingConfig").extra,loggingFramework:"worker",projectBlocklist:c("JSErrorLoggingConfig").projectBlocklist,report_source:c("JSErrorLoggingConfig").report_source,report_source_ref:c("JSErrorLoggingConfig").report_source_ref,sample_weight:c("JSErrorLoggingConfig").sampleWeight!=null?c("JSErrorLoggingConfig").sampleWeight:0,site_category:"armadillo-worker"},d("ErrorTransport").log),self.addEventListener("unhandledrejection",function(a){a=a.reason;(j||(j=c("ErrorPubSub"))).reportError(c("getErrorSafe")(a))})}c("ErrorSetup").preSetup();g.init=a}),98);
__d("MAWPREListeners",["MAWODSProxy","MAWQplProxy","SiteData","WALogger","WAMapWithDefault","WAOdsEnums","WAPREList","WAPREMetrics","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p;function a(){d("WAPREMetrics").subscribe(r)}var q=new(d("WAMapWithDefault").MapWithDefault)(function(){return new Map()});function b(a){return r(a)}function r(a){switch(a.name){case d("WAPREList").PRE_METRIC.EBDB_INIT:t(c("qpl")._(521473151,"2593"),a);break;case d("WAPREList").PRE_METRIC.DELETE_THREAD:t(c("qpl")._(1056845732,"691"),a);break;case d("WAPREList").PRE_METRIC.FRANKING_VALIDATION:t(c("qpl")._(25299246,"150"),a);break;case d("WAPREList").PRE_METRIC.QUERY_GROUPS:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.QUERY_GROUP:s(d("WAOdsEnums").Entity.WA_QUERY_GROUP,a);break;case d("WAPREList").PRE_METRIC.OFFLINE_RETRY:t(c("qpl")._(25309990,"124"),a);break;case d("WAPREList").PRE_METRIC.MEDIA_DOWNLOAD:t(c("qpl")._(25312150,"83"),a);break;case d("WAPREList").PRE_METRIC.MEDIA_UPLOAD:t(c("qpl")._(25313100,"131"),a);break;case d("WAPREList").PRE_METRIC.MEDIA_VALIDATE:t(c("qpl")._(25304678,"2352"),a);break;case d("WAPREList").PRE_METRIC.GET_DEVICES:s(d("WAOdsEnums").Entity.GET_DEVICES,a);break;case d("WAPREList").PRE_METRIC.MESSAGE_DECRYPTION:t(c("qpl")._(25306682,"11176"),a);s(d("WAOdsEnums").Entity.DECRYPTION,a);break;case d("WAPREList").PRE_METRIC.DECRYPT_MESSAGE_FINAL:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.MESSAGE_ENCRYPTION:t(c("qpl")._(25299294,"12933"),a);t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.OFFLINE_QUEUE:t(c("qpl")._(25306361,"5664"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_FATAL_ERROR:t(c("qpl")._(25310891,"540"),a);break;case d("WAPREList").PRE_METRIC.SEND_MESSAGE:t(c("qpl")._(25313175,"1551"),a);break;case d("WAPREList").PRE_METRIC.CREATE_GROUP:t(c("qpl")._(25307987,"970"),a);break;case d("WAPREList").PRE_METRIC.REMOVE_PARTICIPANTS:t(c("qpl")._(25312342,"971"),a);break;case d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE:t(c("qpl")._(1056840931,"814"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_CRITICAL_EVENT:t(c("qpl")._(25311142,"804"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_CRITICAL_BOOTSTRAP_STAGE:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_BOOTSTRAP_APP_STATE_DOWNLOAD:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_DECRYPT_MUTATIONS:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_BOOTSTRAP_DATA_APPLIED:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.SYNCD:t(c("qpl")._(741087294,"2028"),a);break;case d("WAPREList").PRE_METRIC.APP_STATE_SYNC_DAILY:t(c("qpl")._(25306941,"813"),a);break;case d("WAPREList").PRE_METRIC.ICDC_ERROR:t(c("qpl")._(25313187,"948"),a);break;case d("WAPREList").PRE_METRIC.WA_DISCONNECT:s(d("WAOdsEnums").Entity.WA_DISCONNECT,a);break;case d("WAPREList").PRE_METRIC.WA_FAIL_STANZA_QUEUE_ITEM:s(d("WAOdsEnums").Entity.WA_FAIL_STANZA_QUEUE_ITEM,a);break;case d("WAPREList").PRE_METRIC.WA_JOBS_ORCHESTRATOR:t(c("qpl")._(25311870,"1004"),a);break;case d("WAPREList").PRE_METRIC.WA_JOB_MANAGER:t(c("qpl")._(25308825,"136"),a);break;case d("WAPREList").PRE_METRIC.SYNCD_KEY_ROTATION:t(c("qpl")._(25304909,"1204"),a);break;case d("WAPREList").PRE_METRIC.STANZA_QUEUE_MESSAGE_CONSUMER:break;case d("WAPREList").PRE_METRIC.DOWNLOAD_AND_DECRYPT:d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Event "," not implemented"])),a.name);break;case d("WAPREList").PRE_METRIC.ONE_QUEUE:t(c("qpl")._(25308201,"2007"),a);break;case d("WAPREList").PRE_METRIC.WA_NO_SIGNED_PRE_KEY:s(d("WAOdsEnums").Entity.WA_NO_SIGNED_PRE_KEY,a);break}}function s(a,b){var c;switch(b.stage){case"START":break;case"RESUME":case"POINT":case"ANNOTATE":case"CANCEL":break;case"SUCCESS":d("MAWODSProxy").odsBumpEntityKey({entity:a,key:(c=(c=b.annotations)==null||(c=c.string)==null?void 0:c.key)!=null?c:"success"},!0);break;case"FAIL":d("MAWODSProxy").odsBumpEntityKey({entity:a,key:b.reason},!0);break;default:b.stage;d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Received unreachable stage value for the ODS event"])));break}}function t(a,b){var e=babelHelpers["extends"]({},b.annotations);switch(b.stage){case"START":if(q.get(a).has(b.instanceKey))return;var f=babelHelpers["extends"]({},e,{"int":babelHelpers["extends"]({},e["int"],{sharedWorkerRev:c("SiteData").client_revision})});f=d("MAWQplProxy").startQplUserFlow(a,f,{providedTimeoutInMs:b.timeoutInMs});q.get(a).set(b.instanceKey,f);break;case"ANNOTATE":f=q.get(a).get(b.instanceKey);if(f==null){d("WALogger").WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was completed or failed already"])),b.name);return}f.addAnnotations(e);break;case"RESUME":if(b.instanceKey==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Cannot RESUME without instanceKey"])));return}if(u(a,b.instanceKey))return;f=d("MAWQplProxy").startQplUserFlow(a,e,{providedInstanceKey:b.instanceKey});q.get(a).set(b.instanceKey,f);break;case"POINT":f=q.get(a).get(b.instanceKey);if(f==null){d("WALogger").WARN(l||(l=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was completed or failed already"])),b.name);return}f.addPoint(b.reason,e);break;case"SUCCESS":f=q.get(a).get(b.instanceKey);if(f==null){d("WALogger").WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was processed already"])),b.name);return}f.endSuccess(e);q.get(a)["delete"](b.instanceKey);break;case"CANCEL":f=q.get(a).get(b.instanceKey);if(f==null){d("WALogger").WARN(n||(n=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was processed already"])),b.name);return}f.endCancel(e);q.get(a)["delete"](b.instanceKey);break;case"FAIL":f=q.get(a).get(b.instanceKey);if(f==null){d("WALogger").WARN(o||(o=babelHelpers.taggedTemplateLiteralLoose(["The QPL event of "," was processed already"])),b.name);return}f.endFail(b.reason,e);q.get(a)["delete"](b.instanceKey);break;default:d("WALogger").ERROR(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Received unreachable stage value for the event"])));break}}function u(a,b){return q.get(a).has(b)||a===c("qpl")._(25313175,"1551")}g.initializeWAPREMetrics=a;g.testOnly_logger=b}),98);
__d("WAAbPropConverters",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(!a)return{};var b={};Object.keys(a).forEach(function(c){var d=a[c];d!=null&&(b[c]=d)});return b}f.convertAbPropsToPlainObject=a}),66);
__d("WAAbPropsCache",["WAAbPropConverters"],(function(a,b,c,d,e,f,g){"use strict";var h=86400;a=function(){function a(a){var b=a.abKey,c=a.abHash,d=a.lastSyncTime,e=a.expoKeyStr,f=a.refresh,g=a.internalExpoKeys,h=a.propExpoKeys,i=a.propValues;a=a.overridePropValues;this.$1=a!=null?a:{};this.$2=i;this.$4=c;this.$3=b;this.$5=d;this.$7=f;this.$6=e;this.$8=g;this.$9=h}var b=a.prototype;b.getAbProp=function(a){var b;return this.$1[a]!=null?this.$1[a]:(b=this.$2)==null?void 0:b[a]};b.getHash=function(){return this.$4};b.getRefreshSecs=function(){var a;return(a=this.$7)!=null?a:h};b.overrideAbProp=function(a,b){this.$1[a]=b};b.readAll=function(){var a={abKey:this.$3,hash:this.getHash(),refresh:this.getRefreshSecs(),lastSyncTime:this.$5||0};this.$9!=null&&(a.propExpoKeys=this.$9);this.$8!=null&&(a.internalExpoKeys=this.$8);this.$6!=null&&(a.expoKeyStr=this.$6);if(this.$2!=null){var b=this.$2;b!=null&&(a.propValues=d("WAAbPropConverters").convertAbPropsToPlainObject(b),this.$1!=null&&(a.propValues=babelHelpers["extends"]({},a.propValues,d("WAAbPropConverters").convertAbPropsToPlainObject(this.$1))))}return a};b.rewrite=function(a){var b=a.abKey,c=a.abHash,d=a.lastSyncTime,e=a.expoKeyStr,f=a.refresh,g=a.internalExpoKeys,h=a.propExpoKeys;a=a.propValues;this.$2=a;this.$4=c;this.$3=b;this.$5=d;this.$7=f;this.$6=e;this.$8=g;this.$9=h};return a}();g.AbPropsCache=a}),98);
__d("WAAbPropsConverters",["WAAbPropsTypes","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b={expoKeyStr:a.expoKeyStr,internalExpoKeys:a.internalExpoKeys?Array.from(a.internalExpoKeys):[],lastSyncTime:a.lastSyncTime,refresh:a.refresh};a.abHash!=null&&(b.abHash=a.abHash);a.abKey!=null&&(b.abKey=a.abKey);if(a.propExpoKeys){var c=a.propExpoKeys,e=[];Object.keys(c).forEach(function(a){a=Number(a);var b={expoKey:a};c[a]!=null&&(b.value=c[a]);e.push(b)});b.propExpoKeys=e}if(a.propValues){var f=a.propValues,g=[];Object.keys(f).forEach(function(a){var b={name:a,value:{}};switch(typeof f[a]){case"boolean":b.value.boolValue=f[a];break;case"number":b.value.intValue=f[a];break;case"string":b.value.strValue=f[a];break;default:d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["convertAbPropsParsedToDbEntity: unsure how to read ",""])),f[a]);return}g.push(b)});b.propValues=g}return b}function b(a){var b={expoKeyStr:a.expoKeyStr,internalExpoKeys:a.internalExpoKeys,lastSyncTime:a.lastSyncTime,propExpoKeys:a.propExpoKeys,refresh:a.refresh};a.hash!=null&&(b.abHash=a.hash);a.abKey!=null&&(b.abKey=a.abKey);if(a.propValues){var c=a.propValues,d={};Object.keys(c).forEach(function(a){c[a]!=null&&(d[a]=c[a])});b.propValues=d}return b}function c(a){var b=a.abHash,c=a.abKey,e=a.expoKeyStr,f=a.internalExpoKeys,g=a.lastSyncTime,h=a.propExpoKeys,j=a.propValues;a=a.refresh;b={abHash:b,abKey:c,expoKeyStr:e,lastSyncTime:g,refresh:a};f!=null&&(b.internalExpoKeys=new Set(f));if(h!=null){var k={};h.forEach(function(a){a.expoKey!=null&&(k[a.expoKey]=a.value)});b.propExpoKeys=k}if(j!=null){var l={};j.forEach(function(a){var b=a.name,c=d("WAAbPropsTypes").ABPropConfigs[b];if(c==null||c.length<3)return;c=c[2];switch(typeof c){case"boolean":l[b]=a.value.boolValue;return;case"number":l[b]=a.value.intValue;return;case"string":l[b]=a.value.strValue;return;default:d("WALogger").WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["convertDbAbPropsToParsed: unsure how to read ",""])),c);return}});b.propValues=l}return b}g.convertAbPropsParsedToDbEntity=a;g.convertAbPropsDataToParsed=b;g.convertDbAbPropsToParsed=c}),98);
__d("WAGetAbPropsApi",["WAGetMetaApi"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return d("WAGetMetaApi").getMeta().then(function(a){a=a.abProps;return a})};g.getAbProps=a}),98);
__d("WASetAbPropsApi",["WASetMetaApi"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASetMetaApi").setMeta({abProps:a})};g.setAbProps=a}),98);
__d("WAAbPropsInit",["WAAbProps","WAAbPropsCache","WAAbPropsConverters","WAAbPropsToUI","WAAbPropsTypes","WABridge","WAGetAbPropsApi","WALogger","WASetAbPropsApi","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(){if(!j)throw c("err")("Trying to get hash before AbProps gets initialized");return Promise.resolve(j.getHash())}function b(){if(!j)throw c("err")("Trying to get refresh secs before AbProps gets initialized");return Promise.resolve(j.getRefreshSecs())}var k={getAbProps:function(){if(!j)throw c("err")("Trying to read ABProps before they gets initialized");return Promise.resolve(j.readAll())},getHash:a,getRefreshSecs:b,setAbProps:async function(a){var b;a=d("WAAbPropsConverters").convertAbPropsDataToParsed(a);(b=j)==null||b.rewrite(a);await d("WASetAbPropsApi").setAbProps(d("WAAbPropsConverters").convertAbPropsParsedToDbEntity(a));l(a)}};function l(a){if(!a.propValues)return;a=d("WAAbPropsToUI").prepareAbPropsForUI(a.propValues);d("WABridge").getBridge().fireAndForget("event","abPropsUpdated",{abProps:a})}async function e(){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Starting ABProps store"])));var a=await d("WAGetAbPropsApi").getAbProps(),b={};a&&(b=d("WAAbPropsConverters").convertDbAbPropsToParsed(a));j=new(d("WAAbPropsCache").AbPropsCache)(b);d("WAAbProps").startAbProps(k,d("WAAbPropsTypes").ABPropConfigs);l(b);d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["ABProps inited"])))}function f(a,b){if(j==null)throw c("err")("Trying to override ABProp before they get initialized");var e=j;e.overrideAbProp(a,b);l(d("WAAbPropsConverters").convertAbPropsDataToParsed(e.readAll()))}function m(a){return d("WAAbPropsTypes").ABPropConfigs[a][2]}function n(){if(!j)throw c("err")("Trying to read ABProps before they get initialized");return j.readAll()}function o(a){if(!j)throw c("err")("Trying to read ABProp "+a+" before AbProps gets initialized");var b=j.getAbProp(a);return b!=null?b:m(a)}g.getHash=a;g.getRefreshSecs=b;g.initAbProps=e;g.overrideAbProp=f;g.getAbDefault=m;g.getAbProps=n;g.getAbProp=o}),98);
__d("MAWWebWorkerLogger",["MAWBridge","MAWConsoleLogger","MAWLeakDetection","MAWLoggingSwitches","MAWSaveLogToDisk","WAAbPropsInit","WAJids","WATagsLogger","err","fb-error"],(function(a,b,c,d,e,f,g){"use strict";var h=2;function a(){d("WATagsLogger").initializeWaLogger(i)}var i={count:function(a,b){k("count",a,b),d("MAWConsoleLogger").logToConsole("count",a,b)},debug:function(a,b,c){d("MAWConsoleLogger").logToConsole("log",a,b,c)},devConsole:function(a,b,c,e){for(var f=arguments.length,g=new Array(f>4?f-4:0),h=4;h<f;h++)g[h-4]=arguments[h];switch(a){case"COUNT":d("MAWConsoleLogger").logToConsole.apply(void 0,["count",b,c,e].concat(g));break;case"DEV":d("MAWConsoleLogger").logToConsole.apply(void 0,["log",b,c,e].concat(g));break;case"DEV_XMPP":d("MAWConsoleLogger").logToConsole.apply(void 0,["log",b,c,e].concat(g));break;case"LOG":d("MAWConsoleLogger").logToConsole.apply(void 0,["info",b,c,e].concat(g));break;case"WARN":d("MAWConsoleLogger").logToConsole.apply(void 0,["warn",b,c,e].concat(g));break;case"ERROR":d("MAWConsoleLogger").logToConsole.apply(void 0,["error",b,c,e].concat(g));break;case"CATCHING":d("MAWConsoleLogger").logToConsole.apply(void 0,["error",b,c,e].concat(g));break}},error:function(a,b,e){a=d("MAWLeakDetection").maybeReplaceVaultedString(a);e?l(a,b,e):l("webworker",b,c("err")(d("WAJids").maybeSanitizeLogLineText(a)));d("MAWConsoleLogger").logToConsole("error",a,b)},info:function(a,b){k("log",a,b),d("MAWConsoleLogger").logToConsole("info",a,b)},logRestricted:function(a,b){k("logRestricted",a,b),d("MAWConsoleLogger").logToConsole("log",a,b)},warn:function(a,b){k("warn",a,b),d("MAWConsoleLogger").logToConsole("warn",a,b)}};function j(){try{return d("WAAbPropsInit").getAbProp("msgrw_logger_entries")}catch(a){return d("WAAbPropsInit").getAbDefault("msgrw_logger_entries")}}function k(a,b,c){if(d("MAWLoggingSwitches").removeLoggingFromBridge){d("MAWSaveLogToDisk").saveLogEntry("worker",d("MAWSaveLogToDisk").formatLog({date:Date.now(),logLevel:a,logString:b,tags:c}));a==="count"&&d("MAWBridge").getBridge().fireAndForget("event","log",{logLevel:a,logString:b,tags:c},!0);return}a!=="debug"&&d("MAWBridge").getBridge().fireAndForget("event","log",{logLevel:a,logString:b,tags:c},!0)}async function b(){await d("MAWSaveLogToDisk").forceCachedLogEntryPersist()}function l(a,b,e){var f=0;if(e.taalOpcodes!=null){var g;(g=e.taalOpcodes)==null||g.forEach(function(a){a===c("fb-error").TAALOpcode.PREVIOUS_FRAME&&f++})}else f=h;d("MAWLoggingSwitches").removeLoggingFromBridge&&d("MAWSaveLogToDisk").saveLogEntry("worker",d("MAWSaveLogToDisk").formatErrorForLogging(a,b,e,f,j(),e.stack));d("MAWBridge").getBridge().fireAndForget("event","logError",{entriesToReport:j(),framesToPop:f,logString:a,message:e.message,stack:e.stack,tags:b},!0)}g.setupWebWorkerWaLogger=a;g.flushLogs=b}),98);
__d("MAWKeychain",["MWEARKeychainV3"],(function(a,b,c,d,e,f,g){"use strict";a={getDbEncryptionKey:d("MWEARKeychainV3").getDbEncryptionKey,getLatestVersion:d("MWEARKeychainV3").getLatestVersion,init:d("MWEARKeychainV3").init};g["default"]=a}),98);
__d("MWSetupDBEncryption",["BrowserLockManager","ExecutionEnvironment","FBLogger","MAWEncryptionIndexedDbV2","MAWKeychain","MWEARKeychainV3","WAResultOrError","getErrorSafe","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a,b){return b()};function a(a){i=a}var j="mw_ear_db";async function k(a){try{await d("MAWEncryptionIndexedDbV2").makeEncryptionDB(a);return await i("init_setup_keychain",function(){return c("MAWKeychain").init("global_ear",a)})}catch(e){var b=e instanceof Error?e:c("getErrorSafe")(e);c("FBLogger")("messenger_web").catching(b).mustfix("[%s] EAR setup error",String(a));return d("WAResultOrError").DEPRECATED_makeError("keychain-setup-failure",b)}}function l(a){if(d("MAWEncryptionIndexedDbV2").getEncryptionDB()!=null&&d("MWEARKeychainV3").isKeychainInitialised("global_ear"))return Promise.resolve(d("WAResultOrError").makeResult(d("MWEARKeychainV3").getLatestVersion("global_ear")));if(c("BrowserLockManager")!=null)return new Promise(function(b,d){c("promiseDone")(c("BrowserLockManager").request(j,async function(){try{var c=await k(a);b(c)}catch(a){d(a)}}),function(a){},function(a){d(a)})});else return k(a)}function b(a,b){b===void 0&&(b=function(a){return!0});var c=null;return function(d){c==null&&(c=a(d).then(function(a){c=b(a)?Promise.resolve(a):null;return a}).catch(function(a){c=null;throw a}));return c}}e=b(function(a){return l(a)},function(a){return(a==null?void 0:a.success)===!0});f=c("justknobx")._("2804")||(h||(h=c("ExecutionEnvironment"))).isInWorker?e:l;g.setPerformanceMeasurementTool=a;g.init=f}),98);
__d("WAQPLProxy",["WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,e,f,g){g===void 0&&(g=!0);if(j==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["WAQPLProxy: Proxy implementation is not provided for ",""])),a);throw c("err")("WAQPLProxy: Proxy implementation is not provided")}return j.start(a,b,e,f,g)}function b(a,b){if(j==null){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["WAQPLProxy: Proxy implementation is not provided for ",""])),a);throw c("err")("WAQPLProxy: Proxy implementation is not provided")}return j.resume(a,b)}var j=null;function e(a){j=a}g.waQPLProxyStart=a;g.waQPLProxyStartResume=b;g.provideProxyImplementationForWAQPLProxy=e}),98);
__d("BackendInitLoggingUtils",["ErrorMetadata","MAWCommonWebWorkerErrorLogging","MAWLoggerUtils","MAWPREListeners","MAWQplProxy","MAWWebWorkerLogger","MWSetupDBEncryption","WAQPLProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b){return d("MAWQplProxy").measurePerfInQPL_USE_WITH_CARE(c("qpl")._(25310776,"6155"),"backend_"+a,b)};b=function(a){return d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),a)};e=function(a){return d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(1056839232,"112"),a)};function a(){d("MAWWebWorkerLogger").setupWebWorkerWaLogger(),d("MAWCommonWebWorkerErrorLogging").init(),c("ErrorMetadata").addGlobalMetadata("MESSENGER_E2EE_WEB","ENVIRONMENT","worker"),d("MAWLoggerUtils").initMessengerWebLogging(),d("WAQPLProxy").provideProxyImplementationForWAQPLProxy({resume:d("MAWQplProxy").makeQplUserFlowFromExistedInstance,start:function(a,b,c,e,f){return d("MAWQplProxy").startQplUserFlow(a,b,{callBridgeWithTimestamp:f,providedInstanceKey:c,providedTimeoutInMs:e})}}),d("MAWPREListeners").initializeWAPREMetrics(),d("MWSetupDBEncryption").setPerformanceMeasurementTool(h)}g.measureMawInit=h;g.MAWInitPoint=b;g.MAWMICPoint=e;g.initializeBackendLogging=a}),98);
__d("BroadcastChannelClientServerHandshake",["FBLogger","Promise","Random","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a.addEventListener("message",function(b){var c;((c=b.data)==null?void 0:c.type)==="BroadcastChannelHandshake-syn"&&a.postMessage({nonce:b.data.nonce,type:"BroadcastChannelHandshake-syn-ack"})})}function e(a,e){var f=d("Random").random(),g=0;return new(h||(h=b("Promise")))(function(b,d){var h=!1,i=function(){if(g===6){h=!0;a.removeEventListener("message",j);try{throw c("FBLogger")("messenger_web").mustfixThrow("[LS] BC handshake failed, failing, likely worker failure%s",e!=null?" for"+e:"")}catch(a){d(a)}return}if(h)return;a.postMessage({nonce:f,type:"BroadcastChannelHandshake-syn"});c("setTimeout")(i,100*Math.pow(2,g++))},j=function(c){var d;((d=c.data)==null?void 0:d.type)==="BroadcastChannelHandshake-syn-ack"&&((d=c.data)==null?void 0:d.nonce)===f&&(b(),h=!0,a.removeEventListener("message",j))};a.addEventListener("message",j);i()})}g.listen=a;g.checkAlive=e}),98);
__d("CometTaskFrameworkTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["UNKNOWN","BACKGROUND","CURRENT_THREAD","LS_WORKER","MAW_WORKER","TEST"]);c="comet_task_framework";f.ExecutionContext=a;f.TASK_FRAMEWORK_PREFIX=c}),66);
__d("CurrentWorkerMessagePort",["err","ifRequired"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function a(){if(h==null)if("SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope){var a;h=(a=c("ifRequired")("SharedWorkerBootstrapExperimental",function(a){return new a.CurrentSharedWorkerExperimentalAdapter()},function(){return null}))!=null?a:c("ifRequired")("CurrentSharedWorkerAdapter",function(a){return new a.CurrentSharedWorkerAdapter()},function(){return null})}else if("DedicatedWorkerGlobalScope"in self&&self instanceof self.DedicatedWorkerGlobalScope)h=self;else throw new Error("CurrentWorkerAdapter: Unsupported worker type");if(h==null)throw c("err")("CurrentWorkerAdapter: None of shared worker adapters are available");return h}g.getMessagePort=a}),98);
__d("EBMinosWasmDeriveMailboxAuthKeypair",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["derive-mailbox-auth-key-pair"]);function e(a){var b=a.mailboxAuthPrivateKey;a=a.mailboxAuthPublicKey;return d("WAResultOrError").makeResult({pk:d("EBMinosTypes").unsafeCastToMailboxAuthPK(a),sk:d("EBMinosTypes").unsafeCastToMailboxAuthSK(b)})}return async function(a){var f=a.epochNumber;a=a.exportRootKey;var g=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DeriveMailboxAuthKeypairInputSpec,ResultSpec:d("EBMinosWasm.pb").DeriveMailboxAuthKeypairResultSpec,cli:"minos_cli",command:"derive-mailbox-auth-key-pair",getWasmModule:b,logger:c,validateResult:e});g=await g({epochNumber:f,exportRootKey:a});return g}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.deriveMailboxAuthKeypair=b}),98);
__d("EBMinosWasmEncryptMekForDistribution",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["encrypt-mek-for-distribution"]);function e(a){a=a.ciphertext;return d("WAResultOrError").makeResult({encryptedMek:d("EBMinosTypes").unsafeCastToEncryptedMek(a)})}return async function(a){var f=a.fromKeypair,g=a.mek,h=a.senderEpochHead;a=a.toMailboxPk;var i=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").EncryptMekForDistributionInputSpec,ResultSpec:d("EBMinosWasm.pb").EncryptMekForDistributionResultSpec,cli:"minos_cli",command:"encrypt-mek-for-distribution",getWasmModule:b,logger:c,validateResult:e});i=await i({fromKeypair:f,mek:g,senderEpochHead:h,toMailboxPk:a});if(!i.success)return i;f=i.value.encryptedMek;return d("WAResultOrError").makeResult({encryptedMek:f})}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.encryptMekForDistribution=b}),98);
__d("EBMinosWasmEncryptMeksForDistributionFromTransportSender",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["encrypt-meks-for-distribution-from-transport-sender"]);function e(a){var b=a.encryptedMeks,c=a.ephemeralEncryptionPk,e=a.signature;a=a.signingPk;return d("WAResultOrError").makeResult({encryptedMeks:b.map((b=d("EBMinosTypes")).unsafeCastToEncryptedMek),ephemeralEncryptionPk:b.unsafeCastToTransportSenderEphemeralPK(c),signature:b.unsafeCastToTransportSenderEphemeralKeySig(e),signingPk:b.unsafeCastToTransportSigningPK(a)})}return async function(a){var f=a.mek,g=a.recipientEpochHeads,h=a.recipientMailboxEncryptionPks;a=a.transportSigningKp;var i=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").EncryptMeksForDistributionFromTransportSenderInputSpec,ResultSpec:d("EBMinosWasm.pb").EncryptMeksForDistributionFromTransportSenderResultSpec,cli:"minos_cli",command:"encrypt-meks-for-distribution-from-transport-sender",getWasmModule:b,logger:c,validateResult:e});i=await i({mek:f,recipientEpochHeads:g,recipientMailboxEncryptionPks:h,transportSigningKp:a});return i}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.createMinosWasmEncryptMeksForDistributionFromTransportSender=a;g.encryptMeksForDistributionFromTransportSender=b}),98);
__d("EBMinosWasmGenerateMek",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["generate-mek"]);function e(a){a=a.mek;return d("WAResultOrError").makeResult({key:d("EBMinosTypes").unsafeCastMekKey(a.key),mekId:d("EBMinosTypes").unsafeCastToMekId(a.mekId),rosterHash:d("EBMinosTypes").unsafeCastMekRosterHash(a.rosterHash)})}return async function(a){a=a.epochHeads;var f=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").GenerateMekInputSpec,ResultSpec:d("EBMinosWasm.pb").GenerateMekResultSpec,cli:"minos_cli",command:"generate-mek",getWasmModule:b,logger:c,validateResult:e});f=await f({epochHeads:a});return f}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.generateMek=b}),98);
__d("WAPromiseMap",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){return(g||(g=b("Promise"))).resolve(a).then(function(a){return(g||(g=b("Promise"))).all(a.map(function(a,b){return c(a,b)}))})}f.promiseMap=a}),66);
__d("EBGeneratetAndUploadMek",["EBMinosWasmDeriveMailboxAuthKeypair","EBMinosWasmEncryptMekForDistribution","EBMinosWasmEncryptMeksForDistributionFromTransportSender","EBMinosWasmGenerateMek","WAErrorMessage","WALongInt","WAPromiseMap","WAResultOrError","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=["mekEnvelopes"],i,j,k,l,m,n,o,p,q,r,s,t;async function a(a){var b=a.actThreadId,e=a.io,f=a.logger,g=a.msgUploadQpl,q=a.participantMailboxes;a=a.transportSigningKeypair;f.DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["start generate and upload mek"])));g.addPoint("generate_mek_start");var r=q.map(function(a){a=a.epochHead;return a});r=await d("EBMinosWasmGenerateMek").generateMek({epochHeads:r});if(!r.success){f.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["mek generated error: ",""])),r.error);return d("WAResultOrError").makeError("generate-mek-error")}g.addPoint("generate_mek_end");g.addPoint("get_minos_mailbox_key_start");var s=await e.loadSelfMinosEpochs().then(async function(a){a=a.sort(function(a,b){return d("WALongInt").numberOrThrowIfTooLarge(b.epochNumber)-d("WALongInt").numberOrThrowIfTooLarge(a.epochNumber)});a=a[0];if(a==null)return d("WAResultOrError").makeError("unable-to-get-latest-epoch");var b=await d("EBMinosWasmDeriveMailboxAuthKeypair").deriveMailboxAuthKeypair({epochNumber:a.epochNumber,exportRootKey:a.exportRootKey});if(!b.success){f.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Unable to get mailbox auth key pair for sender - failed with exception ",""])),b.error);return d("WAResultOrError").makeError("unable-to-get-sender-mailbox-auth-key-pair")}return d("WAResultOrError").makeResult({epochFbId:a.epochFbId,epochHead:a.epochHead,mailboxAuthKeyPair:b.value})});s=s.success?{fromKeypair:s.value.mailboxAuthKeyPair,senderEpochFbId:s.value.epochFbId,senderEpochHead:s.value.epochHead,senderType:"Minos"}:{senderType:"Transport",transportSigningKp:a};f.DEV(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Sender type: ",". Hard-coded fake keys: ",""])),s.senderType,c("gkx")("14827")===!1);g.addPoint("get_minos_mailbox_key_end",{string:{senderType:s.senderType}});f.DEV(m||(m=babelHelpers.taggedTemplateLiteralLoose(["start encrypy mek. senderType: ",""])),s.senderType);g.addPoint("encrypt_mek_envelopes_start");a=r.value;r=await (s.senderType==="Minos"?u({fromKeypair:s.fromKeypair,logger:f,mek:a,participantMailboxes:q,senderEpochFbId:s.senderEpochFbId,senderEpochHead:s.senderEpochHead}):v({logger:f,mek:a,participantMailboxes:q,transportSigningKp:s.transportSigningKp}));if(!r.success){g.addPoint("encrypt_mek_envelopes_fail");return d("WAResultOrError").makeError("encrypt-mek-error")}g.addPoint("encrypt_mek_envelopes_end");q=r.value;s=q.mekEnvelopes;r=babelHelpers.objectWithoutPropertiesLoose(q,h);g.addPoint("register_mek_gql_start");q=await e.registerMinosMessageEncryptionKey({actThreadId:b,instanceKey:g.getInstanceKey(),mekEnvelopes:s,mekId:a.mekId,mekRosterHash:a.rosterHash,sender:r}).catch(function(a){var b=d("WAErrorMessage").maybeGetMessageFromError(a);f.ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["upload mek runtime-error: ",". ",""])),b,a);return d("WAResultOrError").makeError({errorName:"runtime-error",failReason:b})});if(q.success!==!0){e=q.error;b=e.errorName;s=e.failReason;f.ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["upload mek error: ",". Reason: ",""])),b,s);g.addPoint("register_mek_gql_fail");return d("WAResultOrError").makeError("distribute-mek-error")}g.addPoint("register_mek_gql_end");f.DEV(p||(p=babelHelpers.taggedTemplateLiteralLoose(["register minos message encryption key success"])));return d("WAResultOrError").makeResult({mek:a,mekFbid:q.value.mekFbid,miThreadFbid:q.value.miThreadFbid})}async function u(a){var b=a.fromKeypair,c=a.logger,e=a.mek,f=a.participantMailboxes,g=a.senderEpochFbId,h=a.senderEpochHead;a=await d("WAPromiseMap").promiseMap(f,async function(a){var f=a.mailboxKey,g=a.mailboxKeyFbid;a=a.participantId;var i=await d("EBMinosWasmEncryptMekForDistribution").encryptMekForDistribution({fromKeypair:b,mek:e,senderEpochHead:h,toMailboxPk:f});if(!i.success){c.ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["mek encryption error: ",""])),i.error);return null}return{encryptedMek:i.value.encryptedMek,mailboxKey:f,mailboxKeyFbid:g,participantId:a}});f=a.filter(Boolean);if(f.length===0){c.ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["no successful mek encryption results"])));return d("WAResultOrError").makeError("encrypt-mek-error")}return d("WAResultOrError").makeResult({epochFbId:g,mekEnvelopes:f,senderType:"Minos"})}async function v(a){var b=a.logger,c=a.mek,e=a.participantMailboxes;a=a.transportSigningKp;var f=await d("EBMinosWasmEncryptMeksForDistributionFromTransportSender").encryptMeksForDistributionFromTransportSender({mek:c,recipientEpochHeads:e.map(function(a){a=a.epochHead;return a}),recipientMailboxEncryptionPks:e.map(function(a){a=a.mailboxKey;return a}),transportSigningKp:a});if(!f.success){b.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["mek encryption error: ",""])),f.error);return d("WAResultOrError").makeError("encrypt-mek-error")}if(f.value.encryptedMeks.length!==e.length){b.ERROR(t||(t=babelHelpers.taggedTemplateLiteralLoose(["number of encrypted meks does not match number of participants"])));return d("WAResultOrError").makeError("encrypt-mek-error")}c=e.map(function(a,b){return{encryptedMek:f.value.encryptedMeks[b],mailboxKey:a.mailboxKey,mailboxKeyFbid:a.mailboxKeyFbid,participantId:a.participantId}});return d("WAResultOrError").makeResult({ephemeralEncryptionPk:f.value.ephemeralEncryptionPk,mekEnvelopes:c,senderType:"Transport",signature:f.value.signature,signingPk:f.value.signingPk})}g.generateAndUploadMek=a}),98);
__d("EBMinosWasmDeriveAttachmentAccessTokenSecret",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["derive-attachment-access-token-secret"]);function e(a){a=a.attachmentAccessTokenSecret;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToAttachmentAccessTokenSecret(a))}return async function(a){a=a.mediaKey;var f=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DeriveAttachmentAccessTokenSecretInputSpec,ResultSpec:d("EBMinosWasm.pb").DeriveAttachmentAccessTokenSecretResultSpec,cli:"minos_cli",command:"derive-attachment-access-token-secret",getWasmModule:b,logger:c,validateResult:e});f=await f({mediaKey:a});return f}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.deriveAttachmentAccessTokenSecret=b}),98);
__d("EBMinosWasmDeriveAttachmentPrimaryKeySecret",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["derive-attachment-primary-key-secret"]);function e(a){a=a.attachmentPrimaryKeySecret;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToAttachmentPrimaryKeySecret(a))}return async function(a){a=a.mediaKey;var f=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DeriveAttachmentPrimaryKeySecretInputSpec,ResultSpec:d("EBMinosWasm.pb").DeriveAttachmentPrimaryKeySecretResultSpec,cli:"minos_cli",command:"derive-attachment-primary-key-secret",getWasmModule:b,logger:c,validateResult:e});f=await f({mediaKey:a});return f}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.deriveAttachmentPrimaryKeySecret=b}),98);
__d("EBGetMinosAttachmentPayloadFromMpsMessage",["EBMinosTypes","EBMinosWasmDeriveAttachmentAccessTokenSecret","EBMinosWasmDeriveAttachmentPrimaryKeySecret","MpsMessageToBridgeWrapper","WAMediaUtils","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m;function a(a){var b,c=a.logger,e=a.message;a=a.qplFlow;e=d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(e);e=e.deserialize();b=(b=e.encryptedTransportMessage())==null?void 0:b.consumerMessage();if(b!=null)return n({consumerApplication:b,logger:c,qplFlow:a});e=(b=e.encryptedTransportMessage())==null||(b=b.armadillo())==null?void 0:b.extendedContentMessage();return e!=null?o({extendedContentMessage:e,logger:c,qplFlow:a}):Promise.resolve([])}async function n(a){var b,c,e,f,g,h,i=a.consumerApplication,j=a.logger;a=a.qplFlow;b=(b=(b=(b=(b=i.audioMessage())!=null?b:i.documentMessage())!=null?b:i.imageMessage())!=null?b:i.stickerMessage())!=null?b:i.videoMessage();if(b==null)return[];i=b.kind;b=b.payload.integral;c=(c=b==null||(e=b.transport)==null?void 0:e.integral)!=null?c:{};c=c.mediaKey;f=(f=b==null||(g=b.transport)==null?void 0:g.ancillary)!=null?f:{};f=f.objectId;c=await p({logger:j,maybeMediaKey:c,maybeObjectId:f});f=b==null||(h=b.transport)==null||(h=h.ancillary)==null||(h=h.thumbnail)==null?void 0:h.downloadableThumbnail;b=f==null?null:await p({logger:j,maybeMediaKey:f.mediaKey,maybeObjectId:f.objectId});j=a.getInstanceKey().toString();return[c.success===!0?babelHelpers.extends({},c.value,{attachmentTraceId:j,mediaType:q(i)}):null,(b==null?void 0:b.success)===!0?babelHelpers.extends({},b.value,{attachmentTraceId:j,mediaType:d("EBMinosTypes").MinosAttachmentMediaType.MESSENGER_PREVIEW}):null].filter(Boolean)}async function o(a){var b=a.extendedContentMessage,c=a.logger,e=a.qplFlow;a=[b.favicon(),b.headerImage()].concat(b.previews()).filter(Boolean);if(a.length===0)return[];b=await Promise.all(a.map(function(a){var b;return p({logger:c,maybeMediaKey:(b=a.integral)==null||(b=b.transport)==null||(b=b.integral)==null?void 0:b.mediaKey,maybeObjectId:(b=a.integral)==null||(b=b.transport)==null||(b=b.ancillary)==null?void 0:b.objectId})}));a=b.filter(function(a){return a.success===!0});b=b.filter(function(a){return a.success===!1});b.forEach(function(a){c.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to parse an attachment in XMA message: ",""])),a.error)});a.length===0&&c.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to parse all attachments in XMA message"])));return a.map(function(a){return babelHelpers.extends({},a.value,{attachmentTraceId:e.getInstanceKey().toString(),mediaType:d("EBMinosTypes").MinosAttachmentMediaType.XMA})})}async function p(a){var b=a.logger,c=a.maybeMediaKey;a=a.maybeObjectId;if(c==null){b.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Missing mediaKey in media message protobuf"])));return d("WAResultOrError").makeError("missing-media-key")}if(a==null){b.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Missing objectId in media message protobuf"])));return d("WAResultOrError").makeError("missing-object-id")}c=d("WAMediaUtils").castToMediaKey(c);c=await Promise.all([d("EBMinosWasmDeriveAttachmentPrimaryKeySecret").deriveAttachmentPrimaryKeySecret({mediaKey:c}),d("EBMinosWasmDeriveAttachmentAccessTokenSecret").deriveAttachmentAccessTokenSecret({mediaKey:c})]);var e=c[0];c=c[1];if(!e.success){b.ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Failed to derive attachment primary key secret"])));return d("WAResultOrError").makeError("derive-primary-key-secret-error")}if(!c.success){b.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Failed to derive attachment access token secret"])));return d("WAResultOrError").makeError("derive-access-token-secret-error")}return d("WAResultOrError").makeResult({accessTokenSecret:c.value,primaryKeySecret:e.value,zippyObjectId:d("WAMediaUtils").stringToDeliveryObjectId(a)})}function q(a){switch(a){case"audioTransport":return d("EBMinosTypes").MinosAttachmentMediaType.PTT;case"imageTransport":return d("EBMinosTypes").MinosAttachmentMediaType.IMAGE;case"videoTransport":return d("EBMinosTypes").MinosAttachmentMediaType.VIDEO;case"stickerTransport":return d("EBMinosTypes").MinosAttachmentMediaType.STICKER;default:a;return d("EBMinosTypes").MinosAttachmentMediaType.DOCUMENT}}g.getMinosAttachmentPayloadFromMpsMessage=a}),98);
__d("EBMessageEncryptionKeyStorage",["WABase64"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){return d("WABase64").encodeB64(a)+"|"+d("WABase64").encodeB64(b)}function a(a){var b=a.io,c=a.logger,d=new Map();a=async function(a){var e=a.minosThreadId;a=a.rosterHash;var f=i(a,e),g=d.get(f);if(g!=null)return{cacheStatus:"cached-by-memory",registeredMek:g};g=await b.loadMessageEncryptionKey(e,a).catch(function(a){c.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["loadMessageEncryptionKey runtime-error: ",""])),a);return null});if(g!=null){d.set(f,g);return{cacheStatus:"cached-by-db",registeredMek:g}}return null};var e=async function(a){var c=a.minosThreadId,e=a.registeredMek;a=a.rosterHash;a=i(a,c);d.set(a,e);await b.saveNewMessageEncryptionKey(c,e.mek,e.mekFbid,e.miThreadFbid)};return{getMessageEncryptionKey:a,setNewMessageEncryptionKey:e}}g.createMessageEncryptionKeyStorage=a}),98);
__d("EBMinosWasmDecryptAndVerifyMessage",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.getWasmModule;var b=d("EBMinosLogger").minosLogger.TAGS(["minos-decrypt-and-verify-message"]);function c(a){a=a.plaintext;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToDecryptedMessage(a))}var e=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").MinosDecryptAndVerifyMessageInputSpec,ResultSpec:d("EBMinosWasm.pb").MinosDecryptAndVerifyMessageResultSpec,cli:"minos_cli",command:"minos-decrypt-and-verify-message",getWasmModule:a,logger:b,validateResult:c});return function(a){var b=a.cipherText,c=a.mekKey,d=a.metadata,f=a.signature;a=a.transportSigningPK;return e({encryptedMessageCiphertext:b,encryptedMessageSignature:f,mek:c,metadata:d,transportSigningPk:a})}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.decryptAndVerifyMessage=b}),98);
__d("EBMinosWasmDecryptMekForDistribution",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["decrypt-mek-for-distribution"]);function e(a){a=a.mek;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastMekKey(a))}return async function(a){var f=a.encryptedMek,g=a.mailboxAuthPk,h=a.mailboxEncSk,i=a.mekId,j=a.rosterHash;a=a.senderEpochHead;var k=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DecryptMekForDistributionInputSpec,ResultSpec:d("EBMinosWasm.pb").DecryptMekForDistributionResultSpec,cli:"minos_cli",command:"decrypt-mek-for-distribution",getWasmModule:b,logger:c,validateResult:e});k=await k({ciphertext:f,fromPk:g,mekId:i,rosterHash:j,senderEpochHead:a,toMailboxSk:h});return k}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.decryptMekForDistribution=b}),98);
__d("EBMinosWasmDecryptMekForDistributionFromTransportSender",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["decrypt-mek-for-distribution-from-transport-sender"]);function e(a){a=a.mek;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastMekKey(a))}return async function(a){var f=a.mekDistribution,g=a.mekId,h=a.recipientEncSk;a=a.rosterHash;var i=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DecryptMekForDistributionFromTransportSenderInputSpec,ResultSpec:d("EBMinosWasm.pb").DecryptMekForDistributionFromTransportSenderResultSpec,cli:"minos_cli",command:"decrypt-mek-for-distribution-from-transport-sender",getWasmModule:b,logger:c,validateResult:e});i=await i({mekDistribution:f,mekId:g,recipientEncSk:h,rosterHash:a});return i}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.createMinosWasmDecryptMekForDistributionFromTransportSender=a;g.decryptMekForDistributionFromTransportSender=b}),98);
__d("EBMinosWasmDeriveMailboxEncryptionKeypair",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["derive-mailbox-encryption-key-pair"]);function e(a){var b=a.mailboxEncryptionPrivateKey;a=a.mailboxEncryptionPublicKey;return d("WAResultOrError").makeResult({pk:d("EBMinosTypes").unsafeCastToMailboxEncryptionPK(a),sk:d("EBMinosTypes").unsafeCastToMailboxEncryptionSK(b)})}return async function(a){var f=a.epochNumber;a=a.exportRootKey;var g=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").DeriveMailboxEncryptionKeypairInputSpec,ResultSpec:d("EBMinosWasm.pb").DeriveMailboxEncryptionKeypairResultSpec,cli:"minos_cli",command:"derive-mailbox-encryption-key-pair",getWasmModule:b,logger:c,validateResult:e});g=await g({epochNumber:f,exportRootKey:a});return g}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.deriveMailboxEncryptionKeypair=b}),98);
__d("EBMinosWasmEncryptAndSignMessage",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.getWasmModule;var b=d("EBMinosLogger").minosLogger.TAGS(["encrypt-and-sign-message"]);function c(a){var b=a.ciphertext;a=a.signature;return d("WAResultOrError").makeResult({encryptedMsg:d("EBMinosTypes").unsafeCastToEncryptedMessage(b),signature:d("EBMinosTypes").unsafeCastToEncryptedMessageSignature(a)})}var e=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").MinosEncryptAndSignMessageInputSpec,ResultSpec:d("EBMinosWasm.pb").MinosEncryptAndSignMessageResultSpec,cli:"minos_cli",command:"minos-encrypt-and-sign-message",getWasmModule:a,logger:b,validateResult:c});return function(a){var b=a.mekKey,c=a.metadata,d=a.plaintext;a=a.transportSigningSK;return e({mek:b,metadata:c,plaintext:d,transportSigningSk:a})}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.encryptAndSignMessage=b}),98);
__d("EBMinosWasmGenerateMekRosterHash",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["generate-mek-roster-hash"]);function e(a){a=a.rosterHash;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastMekRosterHash(a))}return async function(a){a=a.epochHeads;var f=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").GenerateMekRosterHashInputSpec,ResultSpec:d("EBMinosWasm.pb").GenerateMekRosterHashResultSpec,cli:"minos_cli",command:"generate-mek-roster-hash",getWasmModule:b,logger:c,validateResult:e});f=await f({epochHeads:a});return f}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.generateMekRosterHash=b}),98);
__d("EBMinosWasmWrapTransportSigningPublicKey",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["wrap-transport-signing-public-key"]);function e(a){a=a.prefixedKey;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToTransportSigningPK(a))}return async function(a){a=a.signalIdentityPublicKey;var f=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").WrapTransportSigningPublicKeyInputSpec,ResultSpec:d("EBMinosWasm.pb").WrapTransportSigningPublicKeyResultSpec,cli:"minos_cli",command:"wrap-transport-signing-public-key",getWasmModule:b,logger:c,validateResult:e});f=await f({keyBytes:a});return f}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.wrapTransportSigningPublicKey=b}),98);
__d("EBMinosWasmWrapTransportSigningSecretKey",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["wrap-transport-signing-secret-key"]);function e(a){a=a.prefixedKey;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToTransportSigningSK(a))}return async function(a){a=a.signalIdentityPrivateKey;var f=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").WrapTransportSigningSecretKeyInputSpec,ResultSpec:d("EBMinosWasm.pb").WrapTransportSigningSecretKeyResultSpec,cli:"minos_cli",command:"wrap-transport-signing-secret-key",getWasmModule:b,logger:c,validateResult:e});f=await f({keyBytes:a});return f}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.wrapTransportSigningSecretKey=b}),98);
__d("EBMinosWrapTransportSigningKeypair",["EBMinosLogger","EBMinosWasmWrapTransportSigningPublicKey","EBMinosWasmWrapTransportSigningSecretKey","WAByteArray","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a){var b=a.privateKey;a=a.publicKey;a=d("EBMinosWasmWrapTransportSigningPublicKey").wrapTransportSigningPublicKey({signalIdentityPublicKey:d("WAByteArray").uint8ArrayToBuffer(a)});b=d("EBMinosWasmWrapTransportSigningSecretKey").wrapTransportSigningSecretKey({signalIdentityPrivateKey:d("WAByteArray").uint8ArrayToBuffer(b)});a=await Promise.all([a,b]);b=a[0];a=a[1];if(!b.success){d("EBMinosLogger").minosLogger.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to wrap transport signing public key"])));return d("WAResultOrError").makeError("minos-wrap-transport-signing-keypair-error")}if(!a.success){d("EBMinosLogger").minosLogger.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to wrap transport signing secret key"])));return d("WAResultOrError").makeError("minos-wrap-transport-signing-keypair-error")}b={pk:b.value,sk:a.value};return d("WAResultOrError").makeResult(b)}g.wrapTransportSigningKeypair=a}),98);
__d("EBMinosWasmMinosThreadIdFromActThreadId",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["minos-thread-id-from-act-thread-id"]);function e(a){a=a.threadId;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToMinosThreadId(a))}return async function(a){a=a.actThreadId;var f=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").MinosThreadIdFromActThreadIdInputSpec,ResultSpec:d("EBMinosWasm.pb").MinosThreadIdFromActThreadIdResultSpec,cli:"minos_cli",command:"minos-thread-id-from-act-thread-id",getWasmModule:b,logger:c,validateResult:e});f=await f({actThreadId:a});return f}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.minosThreadIdFromActThreadId=b}),98);
__d("EBMinosWasmMinosThreadIdFromOneToOneThread",["EBGetMinosWasm","EBMinosLogger","EBMinosTypes","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.getWasmModule,c=d("EBMinosLogger").minosLogger.TAGS(["minos-thread-id-from-one-to-one-thread"]);function e(a){a=a.threadId;return d("WAResultOrError").makeResult(d("EBMinosTypes").unsafeCastToMinosThreadId(a))}return async function(a){var f=a.actThreadId;a=a.selfFbid;var g=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").MinosThreadIdFromOneToOneThreadInputSpec,ResultSpec:d("EBMinosWasm.pb").MinosThreadIdFromOneToOneThreadResultSpec,cli:"minos_cli",command:"minos-thread-id-from-one-to-one-thread",getWasmModule:b,logger:c,validateResult:e});g=await g({actThreadId:f,selfFbid:a});return g}}b=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm});g.minosThreadIdFromOneToOneThread=b}),98);
__d("MpsThreadIdToMinosThreadId",["EBMinosLogger","EBMinosWasmMinosThreadIdFromActThreadId","EBMinosWasmMinosThreadIdFromOneToOneThread","Promise","WAJids","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,c){var e=d("WAJids").validateUserJid(a);if(e!=null){e=d("WAJids").userIdFromJid(e);return d("EBMinosWasmMinosThreadIdFromOneToOneThread").minosThreadIdFromOneToOneThread({actThreadId:e,selfFbid:c}).then(function(a){if(a.success)return d("WAResultOrError").makeResult(a.value);d("EBMinosLogger").minosLogger.ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["mpsThreadIdToMinosThreadId UserJid error: ",""])),a.error);return d("WAResultOrError").makeError("create-minos-thread-id-error")})}e=d("WAJids").validateGroupJid(a);if(e!=null){c=d("WAJids").groupIdFromJid(e);return d("EBMinosWasmMinosThreadIdFromActThreadId").minosThreadIdFromActThreadId({actThreadId:c}).then(function(a){if(a.success)return d("WAResultOrError").makeResult(a.value);d("EBMinosLogger").minosLogger.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["mpsThreadIdToMinosThreadId GroupJid error: ",""])),a.error);return d("WAResultOrError").makeError("create-minos-thread-id-error")})}return(j||(j=b("Promise"))).resolve(d("WAResultOrError").makeError("invalid-mps-thread-id"))}g.mpsThreadIdToMinosThreadId=a}),98);
__d("MpsThreadIdToWaThreadId",["WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("WAJids").validateUserJid(a);if(b!=null)return d("WAJids").userIdFromJid(b);b=d("WAJids").validateGroupJid(a);return b!=null?d("WAJids").groupIdFromJid(b):null}g.mpsThreadIdToWaThreadId=a}),98);
__d("EBMinosCryptoLibrary",["EBGeneratetAndUploadMek","EBGetMinosAttachmentPayloadFromMpsMessage","EBMessageEncryptionKeyStorage","EBMinosLogger","EBMinosTypes","EBMinosWasmDecryptAndVerifyMessage","EBMinosWasmDecryptMekForDistribution","EBMinosWasmDecryptMekForDistributionFromTransportSender","EBMinosWasmDeriveMailboxEncryptionKeypair","EBMinosWasmEncryptAndSignMessage","EBMinosWasmGenerateMekRosterHash","EBMinosWrapTransportSigningKeypair","MpsThreadIdToMinosThreadId","MpsThreadIdToWaThreadId","MpsTypes","WAGlobals","WAResultOrError","err","gkx","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;async function a(a){var b=a.io,e=b.loadMessageEncryptionKey,f=b.loadSelfMinosEpochForDecryption,g=b.loadSelfMinosEpochs,u=b.registerMinosMessageEncryptionKey;b=b.saveNewMessageEncryptionKey;var v=a.logger;a=a.transportSigningKeypair;v.DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["gk wmi_lb11_dyi: ",""])),c("gkx")("10542"));v.DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["gk wmi_lb11_m2_2: ",""])),c("gkx")("2760"));v.DEV(j||(j=babelHelpers.taggedTemplateLiteralLoose(["gk wmi_lb11_m2_1: ",""])),c("gkx")("16567"));v.DEV(k||(k=babelHelpers.taggedTemplateLiteralLoose(["gk wmi_lb11_m1_2: ",""])),c("gkx")("14827"));var w=d("EBMessageEncryptionKeyStorage").createMessageEncryptionKeyStorage({io:{loadMessageEncryptionKey:e,saveNewMessageEncryptionKey:b},logger:v});e=await d("EBMinosWrapTransportSigningKeypair").wrapTransportSigningKeypair(a);if(e.success===!1)return d("WAResultOrError").makeError("transport-signing-keypair-error");var x=e.value;b=async function(a){var b=a.qplFlow;a=a.uploadEntity;var e=a.deletionOfflineThreadingId,f=a.directive,h=a.mailboxKeys,i=a.messageId,j=a.payload,k=a.senderId,q=a.supplementalOpToken,r=a.tags,s=a.threadId;a=a.timestampMs;b.addPoint("generate_mek_roster_hash_start");var t=h.map(function(a){a=a.epochHead;return a});t=await d("EBMinosWasmGenerateMekRosterHash").generateMekRosterHash({epochHeads:t});if(!t.success){b.addPoint("generate_mek_roster_hash_fail");return d("WAResultOrError").makeError("generate-mek-roster-hash-error")}t=t.value;b.addPoint("generate_mek_roster_hash_end");b.addPoint("get_or_generate_mek_start");var y=d("EBMinosTypes").userJidToUserFbId(d("WAGlobals").getMyUserJid());if(y==null){v.ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["selfFbid is invalid"])));return d("WAResultOrError").makeError("invalid-self-fbid")}y=await d("MpsThreadIdToMinosThreadId").mpsThreadIdToMinosThreadId(s,y);if(!y.success){v.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["mpsThreadIdToMinosThreadId error: ",""])),y.error);return d("WAResultOrError").makeError("create-minos-thread-id-error")}y=y.value;h=await z({actThreadId:c("nullthrows")(d("MpsThreadIdToWaThreadId").mpsThreadIdToWaThreadId(s),"invalid MPS threadId"),io:{loadSelfMinosEpochs:g,registerMinosMessageEncryptionKey:u},logger:v,mailboxKeys:h,mekStorage:w,minosThreadId:y,msgUploadQpl:b,rosterHash:t,transportSigningKeypair:x});if(!h.success){v.ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["get or generate mek error: ",""])),h.error);b.addPoint("get_or_generate_mek_fail");return d("WAResultOrError").makeError("get-mek-error")}b.addPoint("get_or_generate_mek_end",{string:{mekCacheStatus:h.value.cacheStatus}});t=h.value.registeredMek;h=t.mek;var A=t.mekFbid;t=t.miThreadFbid;b.addPoint("encrypt_message_start");y=await d("EBMinosWasmEncryptAndSignMessage").encryptAndSignMessage({mekKey:h.key,metadata:{mekId:h.mekId,messageId:i,threadId:y,timestamp:a},plaintext:new Uint8Array(j),transportSigningSK:x.sk});if(!y.success){v.ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["message encryption error: ",""])),y.error);b.addPoint("encrypt_message_fail");return d("WAResultOrError").makeError("encrypt-message-error")}b.addPoint("encrypt_message_end");j=await d("EBGetMinosAttachmentPayloadFromMpsMessage").getMinosAttachmentPayloadFromMpsMessage({logger:v,message:{messageId:i,payload:j,senderId:k,threadId:s,timestampMs:a},qplFlow:b});v.DEV(p||(p=babelHelpers.taggedTemplateLiteralLoose([""," attchmentSecrets generated"])),j.length);return d("WAResultOrError").makeResult({attachmentPayload:j,backupActionType:f.actionType,deletionOfflineThreadingId:e,encryptedMsg:y.value.encryptedMsg,encryptedMsgSignature:y.value.signature,mekFbid:A,mekId:h.mekId,messageTimestampMs:a,miThreadFbid:t,otid:i,supplementalOpToken:q,tags:r,toplevelOfflineThreadingId:d("MpsTypes").toMessageId(f.originalMsgProtocolId.externalId),transportSigningPK:x.pk,waThreadId:s})};a=async function(a){var b=a.encryptedMessage,c=a.encryptedMsgSignature,e=a.mekCreatorInfo,g=a.mekInfo,h=a.messageInfo,i=a.recipientInfo;a=a.transportSigningPK;var j=await f(i.epochFbId);if(!j.success){v.ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["epoch decryption error: ",""])),j.error);return d("WAResultOrError").makeError("load-epoch-error")}i=await d("EBMinosWasmDeriveMailboxEncryptionKeypair").deriveMailboxEncryptionKeypair({epochNumber:i.epochAnonId,exportRootKey:j.value.exportRootKey});if(!i.success){v.ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["mailbox encryption key pair derivation error: ",""])),i.error);return d("WAResultOrError").makeError("derive-mailbox-keys-error")}j=i.value.sk;i=e.senderType==="Transport"?await d("EBMinosWasmDecryptMekForDistributionFromTransportSender").decryptMekForDistributionFromTransportSender({mekDistribution:{encryptedMek:g.encryptedMek,ephemeralEncryptionPk:e.transportSenderEphemeralPK,signature:e.transportSenderEphemeralKeySig,signingPk:a},mekId:g.mekId,recipientEncSk:j,rosterHash:g.mekRosterHash}):await d("EBMinosWasmDecryptMekForDistribution").decryptMekForDistribution({encryptedMek:g.encryptedMek,mailboxAuthPk:e.senderMailboxAuthPK,mailboxEncSk:j,mekId:g.mekId,rosterHash:g.mekRosterHash,senderEpochHead:e.senderEpochHead});if(!i.success){v.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["mek decryption error: ",""])),i.error);return d("WAResultOrError").makeError("decrypt-mek-error")}j=await d("EBMinosWasmDecryptAndVerifyMessage").decryptAndVerifyMessage({cipherText:b,mekKey:i.value,metadata:{mekId:g.mekId,messageId:h.messageId,threadId:h.threadId,timestamp:h.timestamp},signature:c,transportSigningPK:a});if(!j.success){v.ERROR(t||(t=babelHelpers.taggedTemplateLiteralLoose(["message decryption error: ",""])),j.error);return d("WAResultOrError").makeError("decrypt-message-error")}return d("WAResultOrError").makeResult(j.value)};return d("WAResultOrError").makeResult({decryptMessage:a,encryptMessage:b})}var y=null;function b(a){if(y!=null){d("EBMinosLogger").minosLogger.DEV(u||(u=babelHelpers.taggedTemplateLiteralLoose(["Minos crypto library is already set"])));return}d("EBMinosLogger").minosLogger.DEV(v||(v=babelHelpers.taggedTemplateLiteralLoose(["Minos crypto library is initialized"])));y=a}function e(){if(y==null){d("EBMinosLogger").minosLogger.ERROR(w||(w=babelHelpers.taggedTemplateLiteralLoose(["Minos crypto library is not set"])));throw c("err")("Minos crypto library is not set")}return y}async function z(a){var b=a.actThreadId,e=a.io,f=a.logger,g=a.mailboxKeys,h=a.mekStorage,i=a.minosThreadId,j=a.msgUploadQpl,k=a.rosterHash;a=a.transportSigningKeypair;var l=c("gkx")("14827")?await h.getMessageEncryptionKey({minosThreadId:i,rosterHash:k}):null;if(l!=null)return d("WAResultOrError").makeResult(l);l=await d("EBGeneratetAndUploadMek").generateAndUploadMek({actThreadId:b,io:{loadSelfMinosEpochs:e.loadSelfMinosEpochs,registerMinosMessageEncryptionKey:e.registerMinosMessageEncryptionKey},logger:f,msgUploadQpl:j,participantMailboxes:g,transportSigningKeypair:a});if(!l.success){f.ERROR(x||(x=babelHelpers.taggedTemplateLiteralLoose(["mek register error: ",""])),l.error);return d("WAResultOrError").makeError("register-mek-error")}b={mek:l.value.mek,mekFbid:l.value.mekFbid,miThreadFbid:l.value.miThreadFbid};await h.setNewMessageEncryptionKey({minosThreadId:i,registeredMek:b,rosterHash:k});return d("WAResultOrError").makeResult({cacheStatus:"new",registeredMek:b})}g.createMinosCryptoLibrary=a;g.setMinosCryptoLibrary=b;g.getMinosCryptoLibrary=e}),98);
__d("InstamadilloCoreTypeActionLog.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="ActionLog";a.internalSpec={actionLogReaction:[1,d("WAProtoConst").TYPES.MESSAGE,b],__oneofs__:{actionLogSubtype:["actionLogReaction"]}};b.name="ActionLogReaction";b.internalSpec={emojiUnicode:[1,d("WAProtoConst").TYPES.STRING]};g.ActionLogSpec=a;g.ActionLogReactionSpec=b}),98);
__d("InstamadilloCoreTypeAdminMessage.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={DEVICE_ADMIN_MESSAGE_TYPE_NONE:0,DEVICE_ADMIN_MESSAGE_TYPE_LOCAL_USER_CHANGED_IDENTITY_KEY_NAMED_DEVICE:1,DEVICE_ADMIN_MESSAGE_TYPE_SECURITY_ALERT_PARTICIPANT_KEY_CHANGE:2,DEVICE_ADMIN_MESSAGE_TYPE_SECURITY_ALERT_PARTICIPANT_NEW_LOGIN:3};b={};c={};b.name="AdminMessage";b.internalSpec={deviceAdminMessage:[1,d("WAProtoConst").TYPES.MESSAGE,c],__oneofs__:{adminMessageSubtype:["deviceAdminMessage"]}};c.name="DeviceAdminMessage";c.internalSpec={deviceAdminMessageType:[1,d("WAProtoConst").TYPES.ENUM,a],deviceName:[2,d("WAProtoConst").TYPES.STRING]};g.DEVICE_ADMIN_MESSAGE_TYPE=a;g.AdminMessageSpec=b;g.DeviceAdminMessageSpec=c}),98);
__d("InstamadilloCoreTypeMedia.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={PJPEG_SCAN_CONFIGURATION_UNSPECIFIED:0,PJPEG_SCAN_CONFIGURATION_WA:1,PJPEG_SCAN_CONFIGURATION_E15:2,PJPEG_SCAN_CONFIGURATION_E35:3};b={RAVEN_VIEW_MODEL_UNSPECIFIED:0,RAVEN_VIEW_MODEL_ONCE:1,RAVEN_VIEW_MODEL_REPLAYABLE:2,RAVEN_VIEW_MODEL_PERMANENT:3};c={UNSET:0,NONE:1,NUDE:2};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={};e.name="Media";e.internalSpec={staticPhoto:[1,(d=d("WAProtoConst")).TYPES.MESSAGE,f],voice:[2,d.TYPES.MESSAGE,h],video:[3,d.TYPES.MESSAGE,i],raven:[4,d.TYPES.MESSAGE,l],gif:[5,d.TYPES.MESSAGE,j],avatarSticker:[6,d.TYPES.MESSAGE,k],__oneofs__:{media:["staticPhoto","voice","video","raven","gif","avatarSticker"]}};f.name="StaticPhoto";f.internalSpec={mediaTransport:[1,d.TYPES.MESSAGE,o],height:[2,d.TYPES.INT32],width:[3,d.TYPES.INT32],scanLengths:[4,d.FLAGS.REPEATED|d.FLAGS.PACKED|d.TYPES.INT32],thumbnail:[5,d.TYPES.MESSAGE,n],pjpegScanConfiguration:[6,d.TYPES.ENUM,a]};h.name="Voice";h.internalSpec={mediaTransport:[1,d.TYPES.MESSAGE,o],duration:[2,d.TYPES.INT32],waveforms:[3,d.FLAGS.REPEATED|d.FLAGS.PACKED|d.TYPES.FLOAT],waveformSamplingFrequencyHz:[4,d.TYPES.INT32]};i.name="Video";i.internalSpec={mediaTransport:[1,d.TYPES.MESSAGE,o],height:[2,d.TYPES.INT32],width:[3,d.TYPES.INT32],thumbnail:[4,d.TYPES.MESSAGE,n],videoExtraMetadata:[5,d.TYPES.MESSAGE,p]};j.name="Gif";j.internalSpec={mediaTransport:[1,d.TYPES.MESSAGE,o],height:[2,d.TYPES.INT32],width:[3,d.TYPES.INT32],isSticker:[4,d.TYPES.BOOL],stickerId:[5,d.TYPES.STRING],gifUrl:[6,d.TYPES.STRING],gifSize:[7,d.TYPES.INT32],isRandom:[8,d.TYPES.BOOL]};k.name="AvatarSticker";k.internalSpec={mediaTransport:[1,d.TYPES.MESSAGE,o],isAnimated:[2,d.TYPES.BOOL],stickerId:[3,d.TYPES.STRING],stickerTemplate:[4,d.TYPES.STRING],nuxType:[5,d.TYPES.INT32]};l.name="Raven";l.internalSpec={viewMode:[1,d.TYPES.ENUM,b],content:[2,d.TYPES.MESSAGE,m]};m.name="RavenContent";m.internalSpec={staticPhoto:[1,d.TYPES.MESSAGE,f],video:[2,d.TYPES.MESSAGE,i],__oneofs__:{ravenContent:["staticPhoto","video"]}};n.name="Thumbnail";n.internalSpec={mediaTransport:[1,d.TYPES.MESSAGE,o],height:[2,d.TYPES.INT32],width:[3,d.TYPES.INT32]};o.name="CommonMediaTransport";o.internalSpec={mediaId:[1,d.TYPES.STRING],fileSha256:[2,d.TYPES.STRING],mediaKey:[3,d.TYPES.STRING],fileEncSha256:[4,d.TYPES.STRING],directPath:[5,d.TYPES.STRING],mediaKeyTimestamp:[6,d.TYPES.STRING],sidecar:[7,d.TYPES.STRING],fileLength:[8,d.TYPES.INT32],mimetype:[9,d.TYPES.STRING],objectId:[10,d.TYPES.STRING]};p.name="VideoExtraMetadata";p.internalSpec={uploadMosClientScore:[1,d.TYPES.FLOAT]};g.PJPEG_SCAN_CONFIGURATION=a;g.RAVEN_VIEW_MODE=b;g.MEDIA_INTERVENTION_TYPE=c;g.MediaSpec=e;g.StaticPhotoSpec=f;g.VoiceSpec=h;g.VideoSpec=i;g.GifSpec=j;g.AvatarStickerSpec=k;g.RavenSpec=l;g.RavenContentSpec=m;g.ThumbnailSpec=n;g.CommonMediaTransportSpec=o;g.VideoExtraMetadataSpec=p}),98);
__d("InstamadilloCoreTypeCollection.pb",["InstamadilloCoreTypeMedia.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="Collection";a.internalSpec={name:[1,d("WAProtoConst").TYPES.STRING],media:[2,d("WAProtoConst").FLAGS.REPEATED|d("WAProtoConst").TYPES.MESSAGE,d("InstamadilloCoreTypeMedia.pb").MediaSpec]};g.CollectionSpec=a}),98);
__d("InstamadilloCoreTypeLink.pb",["InstamadilloCoreTypeMedia.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};a.name="Link";a.internalSpec={text:[1,(e=d("WAProtoConst")).TYPES.STRING],linkContext:[2,e.TYPES.MESSAGE,b]};b.name="LinkContext";b.internalSpec={linkImageUrl:[1,e.TYPES.MESSAGE,c],linkPreviewTitle:[2,e.TYPES.STRING],linkUrl:[3,e.TYPES.STRING],linkSummary:[4,e.TYPES.STRING],linkMusicPreviewUrl:[5,e.TYPES.STRING],linkMusicPreviewCountriesAllowed:[6,e.FLAGS.REPEATED|e.TYPES.STRING],linkPreviewThumbnail:[7,e.TYPES.MESSAGE,d("InstamadilloCoreTypeMedia.pb").ThumbnailSpec],linkPreviewBody:[8,e.TYPES.STRING]};c.name="ImageUrl";c.internalSpec={url:[1,e.TYPES.STRING],width:[2,e.TYPES.INT32],height:[3,e.TYPES.INT32]};g.LinkSpec=a;g.LinkContextSpec=b;g.ImageUrlSpec=c}),98);
__d("InstamadilloCoreTypeText.pb",["InstamadilloCoreTypeMedia.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={TEXT_FORMAT_STYLE_UNSPECIFIED:0,TEXT_FORMAT_STYLE_BOLD:1,TEXT_FORMAT_STYLE_ITALIC:2,TEXT_FORMAT_STYLE_STRIKETHROUGH:3,TEXT_FORMAT_STYLE_UNDERLINE:4,TEXT_FORMAT_STYLE_INVALID:5};b={};c={};e={};f={};var i={};b.name="Text";b.internalSpec={text:[1,(h=d("WAProtoConst")).TYPES.STRING],isSuggestedReply:[2,h.TYPES.BOOL],postbackPayload:[3,h.TYPES.STRING],powerUpData:[4,h.TYPES.MESSAGE,c],commands:[5,h.FLAGS.REPEATED|h.TYPES.MESSAGE,e],animatedEmojiCharacterRanges:[6,h.FLAGS.REPEATED|h.TYPES.MESSAGE,i]};c.name="PowerUpsData";c.internalSpec={style:[1,h.TYPES.INT32],mediaAttachment:[2,h.TYPES.MESSAGE,d("InstamadilloCoreTypeMedia.pb").CommonMediaTransportSpec]};e.name="CommandRangeData";e.internalSpec={offset:[1,h.TYPES.INT32],length:[2,h.TYPES.INT32],type:[3,h.TYPES.INT32],fbid:[4,h.TYPES.STRING],userOrThreadFbid:[5,h.TYPES.STRING]};f.name="FormattedText";f.internalSpec={offset:[1,h.TYPES.INT32],length:[2,h.TYPES.INT32],style:[3,h.TYPES.ENUM,a]};i.name="AnimatedEmojiCharacterRange";i.internalSpec={offset:[1,h.TYPES.INT32],length:[2,h.TYPES.INT32]};g.TEXT_FORMAT_STYLE=a;g.TextSpec=b;g.PowerUpsDataSpec=c;g.CommandRangeDataSpec=e;g.FormattedTextSpec=f;g.AnimatedEmojiCharacterRangeSpec=i}),98);
__d("InstamadilloXmaContentRef.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={XMA_ACTION_TYPE_UNSPECIFIED:0,XMA_ACTION_TYPE_SHARE:1,XMA_ACTION_TYPE_REPLY:2,XMA_ACTION_TYPE_REACT:3,XMA_ACTION_TYPE_MENTION:4};b={RECEIVER_FETCH_CONTENT_TYPE_UNSPECIFIED:0,RECEIVER_FETCH_CONTENT_TYPE_NOTE:1,RECEIVER_FETCH_CONTENT_TYPE_STORY:2,RECEIVER_FETCH_CONTENT_TYPE_PROFILE:3,RECEIVER_FETCH_CONTENT_TYPE_CLIP:4,RECEIVER_FETCH_CONTENT_TYPE_FEED:5,RECEIVER_FETCH_CONTENT_TYPE_LIVE:6,RECEIVER_FETCH_CONTENT_TYPE_COMMENT:7,RECEIVER_FETCH_CONTENT_TYPE_LOCATION_SHARE:8,RECEIVER_FETCH_CONTENT_TYPE_REELS_AUDIO:9,RECEIVER_FETCH_CONTENT_TYPE_MEDIA_NOTE:10,RECEIVER_FETCH_CONTENT_TYPE_STORY_HIGHLIGHT:11,RECEIVER_FETCH_CONTENT_TYPE_SOCIAL_CONTEXT:12};c={MEDIA_NOTE_FETCH_PARAMS_MESSAGE_TYPE_UNSPECIFIED:0,MEDIA_NOTE_FETCH_PARAMS_MESSAGE_TYPE_MENTION:1,MEDIA_NOTE_FETCH_PARAMS_MESSAGE_TYPE_REPLY:2};e={};f={};var h={},i={},j={},k={},l={},m={},n={},o={},p={},q={},r={};e.name="XmaContentRef";e.internalSpec={actionType:[1,(d=d("WAProtoConst")).TYPES.ENUM,a],contentType:[2,d.TYPES.ENUM,b],targetUrl:[3,d.TYPES.STRING],userName:[4,d.TYPES.STRING],ownerFbid:[5,d.TYPES.STRING],fetchParams:[6,d.TYPES.MESSAGE,f]};f.name="ReceiverFetchXmaFetchParams";f.internalSpec={noteFetchParams:[1,d.TYPES.MESSAGE,h],storyFetchParams:[2,d.TYPES.MESSAGE,i],profileFetchParams:[3,d.TYPES.MESSAGE,j],clipFetchParams:[4,d.TYPES.MESSAGE,k],feedFetchParams:[5,d.TYPES.MESSAGE,l],liveFetchParams:[6,d.TYPES.MESSAGE,m],commentFetchParams:[7,d.TYPES.MESSAGE,n],locationShareFetchParams:[8,d.TYPES.MESSAGE,o],reelsAudioFetchParams:[9,d.TYPES.MESSAGE,p],mediaNoteFetchParams:[10,d.TYPES.MESSAGE,q],socialContextFetchParams:[11,d.TYPES.MESSAGE,r],__oneofs__:{receiverFetchXmaFetchParams:["noteFetchParams","storyFetchParams","profileFetchParams","clipFetchParams","feedFetchParams","liveFetchParams","commentFetchParams","locationShareFetchParams","reelsAudioFetchParams","mediaNoteFetchParams","socialContextFetchParams"]}};h.name="ReceiverFetchXmaNoteFetchParams";h.internalSpec={noteIgid:[1,d.TYPES.STRING]};i.name="ReceiverFetchXmaStoryFetchParams";i.internalSpec={storyIgid:[1,d.TYPES.STRING],reelId:[2,d.TYPES.STRING]};j.name="ReceiverFetchXmaProfileFetchParams";j.internalSpec={profileIgid:[1,d.TYPES.STRING]};k.name="ReceiverFetchXmaClipFetchParams";k.internalSpec={mediaIgid:[1,d.TYPES.STRING]};l.name="ReceiverFetchXmaFeedFetchParams";l.internalSpec={mediaIgid:[1,d.TYPES.STRING],carouselShareChildMediaIgid:[2,d.TYPES.STRING]};m.name="ReceiverFetchXmaLiveFetchParams";m.internalSpec={liveIgid:[1,d.TYPES.STRING]};n.name="ReceiverFetchXmaCommentFetchParams";n.internalSpec={commentFbid:[1,d.TYPES.STRING]};o.name="ReceiverFetchXmaLocationShareFetchParams";o.internalSpec={locationIgid:[1,d.TYPES.STRING]};p.name="ReceiverFetchXmaReelsAudioFetchParams";p.internalSpec={audioIgid:[1,d.TYPES.STRING]};q.name="ReceiverFetchXmaMediaNoteFetchParams";q.internalSpec={mediaNoteIgid:[1,d.TYPES.STRING],messageType:[2,d.TYPES.ENUM,c]};r.name="ReceiverFetchXmaSocialContextFetchParams";r.internalSpec={mediaIgid:[1,d.TYPES.STRING]};g.XMA_ACTION_TYPE=a;g.RECEIVER_FETCH_CONTENT_TYPE=b;g.MEDIA_NOTE_FETCH_PARAMS_MESSAGE_TYPE=c;g.XmaContentRefSpec=e;g.ReceiverFetchXmaFetchParamsSpec=f;g.ReceiverFetchXmaNoteFetchParamsSpec=h;g.ReceiverFetchXmaStoryFetchParamsSpec=i;g.ReceiverFetchXmaProfileFetchParamsSpec=j;g.ReceiverFetchXmaClipFetchParamsSpec=k;g.ReceiverFetchXmaFeedFetchParamsSpec=l;g.ReceiverFetchXmaLiveFetchParamsSpec=m;g.ReceiverFetchXmaCommentFetchParamsSpec=n;g.ReceiverFetchXmaLocationShareFetchParamsSpec=o;g.ReceiverFetchXmaReelsAudioFetchParamsSpec=p;g.ReceiverFetchXmaMediaNoteFetchParamsSpec=q;g.ReceiverFetchXmaSocialContextFetchParamsSpec=r}),98);
__d("InstamadilloAddMessage.pb",["InstamadilloCoreTypeActionLog.pb","InstamadilloCoreTypeAdminMessage.pb","InstamadilloCoreTypeCollection.pb","InstamadilloCoreTypeLink.pb","InstamadilloCoreTypeMedia.pb","InstamadilloCoreTypeText.pb","InstamadilloXmaContentRef.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={PLACEHOLDER_TYPE_NONE:0,PLACEHOLDER_TYPE_DECRYPTION_FAILURE:1,PLACEHOLDER_TYPE_NOT_SUPPORTED_NEED_UPDATE:2,PLACEHOLDER_TYPE_DEVICE_UNAVAILABLE:3,PLACEHOLDER_TYPE_NOT_SUPPORTED_NOT_RECOVERABLE:4};b={};c={};e={};f={};var i={},j={},k={},l={},m={},n={},o={};b.name="AddMessagePayload";b.internalSpec={content:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,c],metadata:[2,h.TYPES.MESSAGE,e]};c.name="AddMessageContent";c.internalSpec={text:[1,h.TYPES.MESSAGE,d("InstamadilloCoreTypeText.pb").TextSpec],like:[2,h.TYPES.MESSAGE,m],link:[3,h.TYPES.MESSAGE,d("InstamadilloCoreTypeLink.pb").LinkSpec],receiverFetchXma:[4,h.TYPES.MESSAGE,n],media:[5,h.TYPES.MESSAGE,d("InstamadilloCoreTypeMedia.pb").MediaSpec],placeholder:[6,h.TYPES.MESSAGE,o],collection:[7,h.TYPES.MESSAGE,d("InstamadilloCoreTypeCollection.pb").CollectionSpec],adminMessage:[8,h.TYPES.MESSAGE,d("InstamadilloCoreTypeAdminMessage.pb").AdminMessageSpec],actionLog:[9,h.TYPES.MESSAGE,d("InstamadilloCoreTypeActionLog.pb").ActionLogSpec],__oneofs__:{addMessageContent:["text","like","link","receiverFetchXma","media","placeholder","collection","adminMessage","actionLog"]}};e.name="AddMessageMetadata";e.internalSpec={sendSilently:[1,h.TYPES.BOOL],privateReplyInfo:[2,h.TYPES.MESSAGE,j],repliedToMessage:[3,h.TYPES.MESSAGE,f],forwardingParams:[4,h.TYPES.MESSAGE,k],ephemeralityParams:[5,h.TYPES.MESSAGE,l]};f.name="RepliedToMessage";f.internalSpec={repliedToMessageOtid:[1,h.TYPES.STRING],repliedToMessageWaServerTimeSec:[2,h.TYPES.STRING],repliedToMessageCollectionItemId:[3,h.TYPES.STRING],omMicroSecTs:[4,h.TYPES.MESSAGE,i]};i.name="OpenMessageMicroSecondTimestamp";i.internalSpec={timestampMs:[1,h.TYPES.INT64],microSecondsBits:[2,h.TYPES.INT32]};j.name="PrivateReplyInfo";j.internalSpec={commentId:[1,h.TYPES.STRING],postLink:[2,h.TYPES.STRING]};k.name="ForwardingParams";k.internalSpec={forwardedThreadId:[1,h.TYPES.STRING]};l.name="EphemeralityParams";l.internalSpec={ephemeralDurationSec:[1,h.TYPES.INT64]};m.name="Like";m.internalSpec={};n.name="ReceiverFetchXma";n.internalSpec={contentRef:[1,h.TYPES.STRING],text:[2,h.TYPES.STRING],media:[3,h.TYPES.MESSAGE,d("InstamadilloCoreTypeMedia.pb").MediaSpec],xmaContentRef:[4,h.TYPES.MESSAGE,d("InstamadilloXmaContentRef.pb").XmaContentRefSpec]};o.name="Placeholder";o.internalSpec={placeholderType:[1,h.TYPES.ENUM,a]};g.PLACEHOLDER_TYPE=a;g.AddMessagePayloadSpec=b;g.AddMessageContentSpec=c;g.AddMessageMetadataSpec=e;g.RepliedToMessageSpec=f;g.OpenMessageMicroSecondTimestampSpec=i;g.PrivateReplyInfoSpec=j;g.ForwardingParamsSpec=k;g.EphemeralityParamsSpec=l;g.LikeSpec=m;g.ReceiverFetchXmaSpec=n;g.PlaceholderSpec=o}),98);
__d("InstamadilloDeleteMessage.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="DeleteMessagePayload";a.internalSpec={messageOtid:[1,d("WAProtoConst").TYPES.STRING]};g.DeleteMessagePayloadSpec=a}),98);
__d("InstamadilloMessageIdUtils",["FBLogger","I64","MAWUnsafeCoerce","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){var c;(h||(h=d("I64"))).isI64(a)?c=(h||(h=d("I64"))).to_string(a):c=a;return c+":"+b}function a(a){a=a.split(":");if(a.length!==2)throw c("FBLogger")("igd_web").mustfixThrow("Invalid instamadillo message id format. Format is <threadKey>:<stanzaId>.");return{stanzaId:a[1],threadKey:a[0]}}function b(a){a=a.split(":");if(a.length!==2){c("FBLogger")("igd_web").warn("Invalid instamadillo message id format. Format is <threadKey>:<stanzaId>.");return null}return{stanzaId:a[1],threadKey:a[0]}}function e(a){a=a.message.decrypted.id;return j(a)}function j(a){var b=a.externalId;a=d("WAJids").threadIdForChatJid(a.chat);return i(a,b)}function f(a,b,c){return{author:d("WAJids").toMsgrUserJid(c),chat:d("WAJids").toMsgrUserJid((h||(h=d("I64"))).to_string(a)),externalId:d("MAWUnsafeCoerce").unsafeCoerce(b)}}g.toInstamadilloMessageId=i;g.fromInstamadilloMessageId=a;g.maybeFromInstamadilloMessageId=b;g.getInstamadilloMessageIdFromStanza=e;g.getInstamadilloMessageIdFromProtocolMsgId=j;g.toProtocolMsgId=f}),98);
__d("InstamadilloSupplementMessage.pb",["InstamadilloCoreTypeMedia.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={};b={};c={};e={};f={};var i={},j={},k={};a.name="SupplementMessagePayload";a.internalSpec={targetMessageOtid:[1,(h=d("WAProtoConst")).TYPES.STRING],uniquingKeyForSupplementalData:[2,h.TYPES.STRING],content:[3,h.TYPES.MESSAGE,b],targetMessageWaServerTimeSec:[4,h.TYPES.STRING],targetWaThreadId:[5,h.TYPES.STRING]};b.name="SupplementMessageContent";b.internalSpec={reaction:[1,h.TYPES.MESSAGE,e],contentView:[2,h.TYPES.MESSAGE,f],editText:[3,h.TYPES.MESSAGE,i],mediaReaction:[4,h.TYPES.MESSAGE,c],originalTransportPayload:[5,h.TYPES.MESSAGE,j],mediaInterventions:[6,h.TYPES.MESSAGE,k],__oneofs__:{supplementMessageContent:["reaction","contentView","editText","mediaReaction","originalTransportPayload","mediaInterventions"]}};c.name="MediaReaction";c.internalSpec={mediaId:[1,h.TYPES.STRING],reaction:[2,h.TYPES.MESSAGE,e]};e.name="Reaction";e.internalSpec={reactionType:[1,h.TYPES.STRING],reactionStatus:[2,h.TYPES.STRING],emoji:[3,h.TYPES.STRING],superReactType:[4,h.TYPES.STRING],actionLogOtid:[5,h.TYPES.STRING]};f.name="ContentView";f.internalSpec={seen:[1,h.TYPES.BOOL],screenshotted:[2,h.TYPES.BOOL],replayed:[3,h.TYPES.BOOL],mimetype:[4,h.TYPES.STRING],objectId:[5,h.TYPES.STRING]};i.name="EditText";i.internalSpec={newContent:[1,h.TYPES.STRING],editCount:[2,h.TYPES.INT32]};j.name="OriginalTransportPayload";j.internalSpec={originalTransportPayload:[1,h.TYPES.BYTES]};k.name="MediaInterventions";k.internalSpec={mediaId:[1,h.TYPES.STRING],interventionType:[2,h.TYPES.ENUM,d("InstamadilloCoreTypeMedia.pb").MEDIA_INTERVENTION_TYPE]};g.SupplementMessagePayloadSpec=a;g.SupplementMessageContentSpec=b;g.MediaReactionSpec=c;g.ReactionSpec=e;g.ContentViewSpec=f;g.EditTextSpec=i;g.OriginalTransportPayloadSpec=j;g.MediaInterventionsSpec=k}),98);
__d("InstamadilloTransportPayload.pb",["InstamadilloAddMessage.pb","InstamadilloDeleteMessage.pb","InstamadilloSupplementMessage.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={PAYLOAD_CREATOR_UNSPECIFIED:0,PAYLOAD_CREATOR_IGIOS:1,PAYLOAD_CREATOR_IG4A:2,PAYLOAD_CREATOR_WWW:3,PAYLOAD_CREATOR_IGLITE:4};b={};c={};b.name="TransportPayload";b.internalSpec={franking:[4,(e=d("WAProtoConst")).TYPES.MESSAGE,c],openEb:[5,e.TYPES.BOOL],isE2EeAttributed:[6,e.TYPES.BOOL],payloadCreator:[7,e.TYPES.ENUM,a],add:[1,e.TYPES.MESSAGE,d("InstamadilloAddMessage.pb").AddMessagePayloadSpec],"delete":[2,e.TYPES.MESSAGE,d("InstamadilloDeleteMessage.pb").DeleteMessagePayloadSpec],supplement:[3,e.TYPES.MESSAGE,d("InstamadilloSupplementMessage.pb").SupplementMessagePayloadSpec],__oneofs__:{transportPayload:["add","delete","supplement"]}};c.name="Franking";c.internalSpec={frankingKey:[1,e.TYPES.BYTES],frankingVersion:[2,e.TYPES.INT32]};g.PAYLOAD_CREATOR=a;g.TransportPayloadSpec=b;g.FrankingSpec=c}),98);
__d("MAWBuildNewMsgPayload",["FBLogger","MAWAdminMsgType","MAWAuthor","MAWDbMsg","MAWJids","MAWMsgType","WAArmadilloXMA.pb","WAAssertUnreachable","WAJids","WALogger","WAMsgType","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,e,f){if(d("MAWDbMsg").isUnrenderedMsgType(a))throw c("FBLogger")("messenger_web").mustfixThrow("getNewMsg called for wrong message type "+a);var g,h;if(e.quote!=null&&(f==null?void 0:f.content)!=null){var i;h=f==null||(i=f.content)==null?void 0:i.externalId;g={content:f==null?void 0:f.content,remoteJid:(f=f==null?void 0:f.remoteJid)!=null?f:void 0}}if(e.noteContent!=null){f=d("MAWJids").toUserJid(b.threadJid);g={content:{author:f,expirationTs:d("WATimeUtils").castToUnixTime(e.noteExpirationTs),externalId:b.externalId,msgContent:{content:e.noteContent},ts:b.ts,type:d("WAMsgType").NOTE_REPLY},remoteJid:void 0}}f=babelHelpers["extends"]({},b,{quote:g,quoteExternalId:h});var j=e.mediaGroupMetadata;switch(a){case"Text":return babelHelpers["extends"]({},f,{msgContent:{commands:e.commands,content:e.content!=null?e.content:"",mentionedJids:e.mentionedJids},type:d("MAWMsgType").MSG_TYPE.TEXT});case"Image":return babelHelpers["extends"]({},f,{hdType:e.hdType,type:d("MAWMsgType").MSG_TYPE.IMAGE},j);case"Video":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.VIDEO});case"Ptt":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.PTT});case"Gif":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.GIF});case"Sticker":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.STICKER});case"DocumentFile":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case"XMA":if(e.xmaMessageType==null)throw c("FBLogger")("messenger_web").mustfixThrow("XMA Message Missing xmaMessageType");j=e.content!=null&&e.xmaMessageType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE?e.content:"";return babelHelpers["extends"]({},f,{msgContent:{commands:e.commands,content:j,mentionedJids:e.mentionedJids},type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:e.xmaMessageType});case"EditAction":throw c("FBLogger")("messenger_web").mustfixThrow("EditAction is not supported yet");case"BumpExistingMessage":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE});case"ReceiverFetch":throw c("FBLogger")("messenger_web").mustfixThrow("ReceiverFetch is not supported yet");case"GroupPollCreate":return babelHelpers["extends"]({},b,{msgContent:{adminMsgContent:[(j=e.title)!=null?j:""],adminType:d("MAWAdminMsgType").CURRENT_USER_CREATED_POLL,version:1},type:d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE});case"GroupPollUpdate":throw c("FBLogger")("messenger_web").mustfixThrow("GroupPollUpdate is not supported yet");case"Revoked":case"DeleteForMe":case"Ciphertext":case"Futureproof":case"Unavailable":case"Admin":case"ExpiredEphemeral":case"EphemeralSettingAdmin":case"EphemeralScreenshotAction":case"AlertICDC":case"GroupInvite":case"Reaction":case"Raven":case"RavenAction":case"NoteReply":throw c("FBLogger")("messenger_web").mustfixThrow("Should not be writing ciphertext, futureproof, unsent, admin,\n        ephemeral setting messages, ephemeral screenshot action, group invite messages");default:throw c("WAAssertUnreachable")(a)}}function b(a,b,e,f){if(!d("MAWDbMsg").isUnrenderedMsgType(a))throw c("FBLogger")("messenger_web").mustfixThrow("getNewUnrenderedMsg called for wrong message type "+a);switch(a){case"EphemeralSyncResponse":if(e.ephemeralSetting==null)throw c("FBLogger")("messenger_web").mustfixThrow("Ephemeral Sync Response without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE});case"EphemeralSettingChangeFromCurrentDevice":var g;if(e.ephemeralSetting==null)throw c("FBLogger")("messenger_web").mustfixThrow("Ephemeral Setting Change without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,isEphemeralSettingReset:(g=e.isEphemeralSettingReset)!=null?g:!1,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE});case"GroupInvite":g=d("WAJids").interpretAsGroupJid(b.threadJid);if(g==null)throw c("FBLogger")("messenger_web").mustfixThrow("Group Invite without valid group jid");if(e.invitedParticipantUserJid==null)throw c("FBLogger")("messenger_web").mustfixThrow("Group Invite without invited user jid");return babelHelpers["extends"]({},b,{groupName:e.groupName==null?void 0:e.groupName,invitedParticipantUserJid:e.invitedParticipantUserJid,type:d("MAWMsgType").MSG_TYPE.GROUP_INVITE});case"SenderKeyDistribution":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION});case"RavenAction":if(f==null)throw c("FBLogger")("messenger_web").mustfixThrow("Raven Action without Raven Message External Id");if(e.actionType==null)throw c("FBLogger")("messenger_web").mustfixThrow("Raven Action without Action Type");return babelHelpers["extends"]({},b,{actionType:e.actionType,ravenActionToMsgExternalId:d("WAStanzaUtils").toStanzaId(f),type:d("MAWMsgType").MSG_TYPE.RAVEN_ACTION});case"EditAction":throw c("FBLogger")("messenger_web").mustfixThrow("Edit action not implemented yet");default:throw c("WAAssertUnreachable")(a)}}function e(a){var b,e={author:d("MAWAuthor").getAuthorUserJid(a.author)||d("WAJids").AUTHOR_ME,externalId:a.externalId,mediaId:a.mediaId,msgId:a.msgId,plaintextHash:a.plaintextHash,specialTextSize:a.specialTextSize,ts:a.ts,xmaMessageType:a.xmaMessageType};switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.IMAGE});case d("MAWMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.VIDEO});case d("MAWMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.PTT});case d("MAWMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.TEXT});case d("MAWMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.STICKER});case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case d("MAWMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.GIF});case d("MAWMsgType").MSG_TYPE.XMA:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:a.xmaMessageType});case d("MAWMsgType").MSG_TYPE.REVOKED:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE});case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:if(((b=a.quote)==null?void 0:b.content)==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["BumpExistingMessage does not have quote content when replying"])));return null}return babelHelpers["extends"]({},a.quote.content,{author:d("MAWAuthor").getAuthorUserJid(a.quote.content.author)||d("WAJids").AUTHOR_ME});case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH});case d("MAWMsgType").MSG_TYPE.RAVEN:return babelHelpers["extends"]({},e,{ravenEphemeralMediaState:a.ravenEphemeralMediaState,ravenEphemeralType:a.ravenEphemeralType,ravenMediaType:a.ravenMediaType,type:d("MAWMsgType").MSG_TYPE.RAVEN});default:d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["msgToQuotedMsg: Unsupported message type ",""])),a.type);throw c("FBLogger")("messenger_web").mustfixThrow("Trying to reply to a message type that does not support replies")}}g.buildNewMsg=a;g.getNewUnrenderedMsg=b;g.msgToQuotedMsg=e}),98);
__d("MAWCheckThreadExistsTxn",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READONLY},"checkThreadExists",function(b){return function(){return b.threads.get({jid:a}).then(function(a){return a!=null})}})()}g.checkThreadExistsTxn=a}),98);
__d("MAWCommonScheduler",["WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){h==null&&(h=d("WorkerScheduler").makeScheduler("msgr-common",{concurrency:1,maxConcurrency:10,maxThrottleMs:5e3}));return h}g.mawCommonScheduler=a}),98);
__d("MAWConstants",[],(function(a,b,c,d,e,f){"use strict";a=5;b="Facebook user";c="Instagram user";d=3;f.MESSAGE_RETRY_COUNT_LIMIT=a;f.FB_UNKNOWN_USER=b;f.INS_UNKNOWN_USER=c;f.CURRENT_REGISTRATION_VERSION=d}),66);
__d("MAWCryptoAuthTokenWrapper",["MessengerWebInitData"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("MessengerWebInitData").cryptoAuthToken}g.getCryptoAuthToken=a}),98);
__d("MAWDBKeychain",["BrowserLockManager","EARInitType","ExecutionEnvironment","FBLogger","MAWCurrentUser","MAWDexie","MAWIndexedDbMetadata","MWEARKeychainV3","MWSetupDBEncryption"],(function(a,b,c,d,e,f,g){"use strict";var h=["id"],i,j="encryptionMetaV3",k=function(a){a===void 0&&(a=d("MWEARKeychainV3").logMawInitPoint);a("maw_ear_check_mawdb_start");var b=d("MAWCurrentUser").getID();b=d("MAWIndexedDbMetadata").dbName(b);b=new(c("MAWDexie"))(b,{addons:[]});return b.open().then(function(b){a("maw_ear_check_mawdb_end");return b}).catch("NoSuchDatabaseError",function(){a("maw_ear_check_mawdb_no_db");return null}).catch(function(b){a("maw_ear_check_mawdb_error");throw b})};b=async function(a){a===void 0&&(a=d("MWEARKeychainV3").logMawInitPoint);var b=async function(){var b;try{b=await k(a);if(!b){c("FBLogger")("messenger_web").info("MAWDB is missing for MAW EAR worker init.");a("maw_ear_new_user");return{isNewUser:!0,reinitEAR:!0,useMawEAR:!0}}if(!b.backendDB().objectStoreNames.contains(j)){b.close();c("FBLogger")("messenger_web").info("MAW EAR is missing for MAW EAR worker init.");a("maw_ear_missing_ear_table");return{reinitEAR:!0,useMawEAR:!0}}var e=await m(b.backendDB());e.length===0&&(c("FBLogger")("messenger_web").info("Migrating global EAR to MAW EAR"),a("maw_ear_migrating"),await l(b.backendDB()));d("MWEARKeychainV3").setNamespaceSourceDbWithoutMarkingDbReady("maw_ear",b.backendDB());a("maw_ear_init_keychain");e=await d("MWEARKeychainV3").init("maw_ear",c("EARInitType").MAW_INIT,a);if(e.success===!1){if(e.payload!=null)throw e.payload;throw c("FBLogger")("messenger_web").mustfixThrow("Failed to init MAW EAR Keychain.")}a("maw_ear_success");c("FBLogger")("messenger_web").info("MAW EAR worker successfully initialised.");return{useMawEAR:!0}}finally{d("MWEARKeychainV3").setNamespaceSourceDbWithoutMarkingDbReady("maw_ear",null);(e=b)==null||e.close()}};return new Promise(function(a,d){if(c("BrowserLockManager")!=null)return c("BrowserLockManager").request("mawdb_keychain_init_ear",function(){return b().then(a).catch(d)});else return b().then(a).catch(d)}).catch(function(b){a("maw_ear_failure");throw c("FBLogger")("messenger_web").catching(b).mustfixThrow("Failed to init MAW EAR Worker.")})};var l=async function(a){var b=await d("MWSetupDBEncryption").init(c("EARInitType").MAW_INIT);if(!b.success){if(b.payload!=null)throw b.payload;throw c("FBLogger")("messenger_web").mustfixThrow("Failed to init global EAR.")}b=d("MWEARKeychainV3").getKeychain("global_ear");if(b.databaseEncryptionKeys.size===0)throw c("FBLogger")("messenger_web").mustfixThrow("Global EAR data is missing.");var e=Array.from(b.databaseEncryptionKeys.entries()).map(function(a){a[0];a=a[1].dbEntry;a.id;a=babelHelpers.objectWithoutPropertiesLoose(a,h);return a});return new Promise(function(b,c){var d=a.transaction(j,"readwrite");e.forEach(function(a){d.objectStore(j).add(a)});d.onerror=function(){return c(d.error)};d.oncomplete=function(){return b()}})};function m(a){return new Promise(function(b,c){var d=a.transaction(j,"readonly"),e=d.objectStore(j).getAll();e.onsuccess=function(){return b(e.result)};e.onerror=function(){return c(e.error)}})}function a(a,b){if(a.encryptionMetaV3!=null){var e=d("MWEARKeychainV3").getKeychainInitStatus("maw_ear");if(e==="none"&&b!=null){d("MWEARKeychainV3").logMawInitPoint("maw_ear_populate_unstored_key");a.encryptionMetaV3.add(b);return}e=d("MWEARKeychainV3").isKeychainSettled("maw_ear")?"maw_ear":"global_ear";var f=Array.from(d("MWEARKeychainV3").getKeychain(e).databaseEncryptionKeys).map(function(a){a[0];a=a[1].dbEntry;return a});if(f.length>0)c("FBLogger")("messenger_web").info("DB re-populated after external DB deletion. Namespace: %s. isWorker: %s",e,(i||(i=c("ExecutionEnvironment"))).isInWorker),a.encryptionMetaV3.bulkPut(f),d("MWEARKeychainV3").setNamespaceSourceDbAndMarkAsReady("maw_ear",a.db.backendDB());else throw c("FBLogger")("messenger_web").mustfixThrow("No encryption keys to populate MAWDB. Namespace: %s. HasUnstoredKey: %s. isWorker: %s",e,Boolean(b),(i||(i=c("ExecutionEnvironment"))).isInWorker)}}g.STORENAME=j;g.checkMawDbExists=k;g.initEAR=b;g.getEncryptionKeys=m;g.onDbPopulateMAWKeychain=a}),98);
__d("MAWDbGroupInfoTxns",["MAWBridgeTypesCreators","MAWIndexedDb","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a,b.jid).then(function(c){var d=b.participantVersion;c.success&&c.value.participantVersion!=null&&b.participantVersion==null&&(d=c.value.participantVersion);c=b.subject.content;c!=null&&c.length===0&&(c=void 0);var e={creationTs:b.creationTs,creator:b.creator,groupJid:b.jid,inviter:b.inviter,memberAddMode:b.memberAddMode,name:c,nameOwner:b.subject.user,nameTs:b.subject.ts,participantVersion:d};return i(a,e).then(function(){return e})})}function h(a,b){return a.groupInfo.get({groupJid:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function i(a,b){return a.groupInfo.put(b).then(function(){d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(b)})})}function b(a,b){return a.groupInfo.bulkPut(b).then(function(){b.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(a)})})})}function c(a,b){return a.groupInfo.bulkGet(b)}function e(a,b){return a.groupInfo["delete"](b)}g.putGroupInfo=a;g.getGroupInfo=h;g.updateGroupInfo=i;g.bulkUpdateGroupInfo=b;g.getGroupInfos=c;g.deleteGroupInfo=e}),98);
__d("MAWDbGroupInviteTxns",["MAWDexieTable","MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.groupInvites.put(b).then(function(){return b})}function b(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).anyOf([[b,c]])["delete"]()}function h(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).equals([b,c]).first()}function c(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).anyOf([[b,c]]).toArray()}function e(a,b){return b.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE?b.invitedParticipantUserJid==null?d("MAWDexieTable").dexieResolve():h(a,b.threadJid,b.invitedParticipantUserJid):d("MAWDexieTable").dexieResolve()}g.putGroupInvite=a;g.deleteGroupInvitesByThreadAndInvitedParticipant=b;g.maybeGetGroupInvite=h;g.getGroupInvitesByThreadAndInvitedParticipant=c;g.getAndCheckGroupInviteFromMsg=e}),98);
__d("MAWDbInitIndexedDb",["MAWIndexedDb","MWEARKeychainV3","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.onDbPopulate;return d("MAWIndexedDb").makeDB(d("MWEARKeychainV3").getDbEncryptionKey,{enableDataSyncMiddleware:!0,enableMutationValidator:c("gkx")("1627"),onDbPopulate:a})}g.dbInit=a}),98);
__d("MAWDbPollTxns",["MAWIndexedDb","MAWTransactionMode","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";e=d("MAWIndexedDb").makeMsgrTransactor({poll:d("MAWTransactionMode").READONLY},"handleIncomingMessagesStanzas",function(a){return function(b,c){return a.poll.get([b,d("WAStanzaUtils").toStanzaId(c)])}});function a(a,b){return a.poll.put(b).then(function(){return b})}function b(a,b,c){return a.poll.get([b,d("WAStanzaUtils").toStanzaId(c)])}function c(a,b,c){return a.messages.where(["threadJid","pollStanzaId","sortOrderMs"]).between([c,b,Number.MIN_SAFE_INTEGER],[c,b,Number.MAX_SAFE_INTEGER],!1,!1).reverse().first()}g.getDbPoll=e;g.updatePoll=a;g.getPoll=b;g.maybeGetLatestPollUpdateMsg=c}),98);
__d("MAWDbRavenActionTxns",["FBLogger","MAWBridgeTypesCreators","MAWDbMsg","MAWIndexedDb","MAWMsg","MAWRavenUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){return a.messages.where("externalId").equals(b.ravenActionToMsgExternalId).filter(function(a){return a.threadJid===e.jid}).first().then(function(f){var g=f==null?void 0:f.msgId;if(g==null){c("FBLogger")("maw_incoming_handlers").warn("[MAWDbRavenActionTxns] Cannot Write Raven Action without ID of Raven Message.");return}return h(a,f).then(function(c){var d=babelHelpers["extends"]({msgId:g,threadJid:e.jid},b);return a.unrenderedMessages.add(d).then(function(a){return babelHelpers["extends"]({rowId:a},d)})}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"RavenActionUpdate",value:d("MAWBridgeTypesCreators").createBridgeRavenAction(a)});return})})}function h(a,b){if((b==null?void 0:b.type)!=="Raven")throw c("FBLogger")("messenger_web").mustfixThrow("Cannot Modify Message because Message is not Raven Message");var e=[d("MAWMsg").MAWRavenMsgEphemeralMediaState.cast(Number(b.ravenEphemeralMediaState)),d("MAWMsg").MAWRavenMsgEphemeralType.cast(Number(b.ravenEphemeralType))],f=e[0];e=e[1];if(f==null||e==null)throw c("FBLogger")("messenger_web").mustfixThrow("ravenEphemeralMediaStateEnum or ravenEphemeralTypeEnum is null");f=d("MAWRavenUtils").getNextRavenMessageEphemeralState(f,e);return a.messages.put(babelHelpers["extends"]({},b,{ravenEphemeralMediaState:f}))}function b(a,b,c){c=d("MAWDbMsg").isRavenActionMsgType(c)&&(b==null?void 0:b.externalId)!=null?[b.externalId]:[];return a.messages.where("externalId").anyOf(c).filter(function(a){return a.author===(b==null?void 0:b.author)&&a.threadJid===(b==null?void 0:b.chat)}).first()}g.writeRavenActionMsg=a;g.modifyRavenMsgWithActionMsg=h;g.maybeGetRavenMsgQueryByProtocolMsgId=b}),98);
__d("MAWDbReceiverFetchTxns",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.receiverFetchInfo.get({receiverFetchId:b})}f.maybeGetReceiverFetchInfoFromReceiverFetchId=a}),66);
__d("MAWDebugMsg",["MAWBridgeMsg","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWExternalId","MAWIndexedDb","MAWJidUtils","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWTransactionMode","MAWTransactor","MAWUseProtocolMsgIdForMsgId","OfflineThreadingId","WAStanzaUtils","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWTransactor").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"writeDebugMsg",function(a){return function(b,e,f){return!c("gkx")("23958")?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return;var c=b.value;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getThreadNewestMessageBySortOrder(a,c.jid),d("MAWDbMsgTxns").getThreadNewestMessageMs(a,c.jid),(f==null?void 0:f.decryptionError)==="errDuplicateMsg"?d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f.protocolMsgId).then(function(a){if(a==null)return", no existing message";return a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?", existing ciphertext message":",  existing message"}):d("MAWDexieTable").dexieResolve(""),d("MAWUseProtocolMsgIdForMsgId").shouldUseProtocolMsgIdForMsgId()?d("MAWDexieTable").dexieResolve(null):d("MAWDbMsgTxns").getNextMsgIdNumberForThread(a,c)]).then(function(a){var b=a[0],f=a[1],g=a[2];a=a[3];a=a!=null?d("MAWDbMsg").craftDebugMsgId(c.chatId,a-1):d("MAWJidUtils").formatProtocolMsgIdFromExternalId(c.jid,d("WAStanzaUtils").toStanzaId(d("OfflineThreadingId").createOfflineThreadingID()));f=d("WATimeUtils").castToMillisTime(((b=(b=b==null?void 0:b.sortOrderMs)!=null?b:f)!=null?b:0)+1);b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:["[fb-only][DEBUG]: "+(e+g)],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG,version:0},c.jid,d("MAWExternalId").generateExternalId());d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(babelHelpers["extends"]({},b,{msgId:a,sortOrderMs:f}))})})})}});g.writeDebugMsg=b}),98);
__d("WADbIdentityTxns",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.identity.bulkGet(b).then(function(a){return a.map(function(a){if(a==null)return;return{id:a.deviceJid,identity:a.identity}}).filter(Boolean)})}f.bulkGetIdentities=a}),66);
__d("WACompareIdentity",["WACryptoUtils","WADbIdentityTxns","WADbSignal","WAJids","WASignalKeys"],(function(a,b,c,d,e,f,g){"use strict";async function a(a){var b=await a.meta.bulkGet([d("WADbSignal").MetaKeysEnum.fbid,d("WADbSignal").MetaKeysEnum.deviceId,d("WADbSignal").MetaKeysEnum.identityKeyPair]),c=b[0],e=b[1];b=b[2];c=c==null?void 0:c.value.fbid;e=e==null?void 0:e.value.deviceId;b=b==null?void 0:b.value.identityKeyPair;if(c!=null&&e!=null){c=d("WAJids").toDeviceJid(d("WAJids").toMsgrUserJid(c),e);e=await d("WADbIdentityTxns").bulkGetIdentities(a,[c]);if(!(e.length===0)){a=e[0];if((b==null?void 0:b.publicKey)==null)return!0;if(!d("WACryptoUtils").serializedPubKeysEqual(a.identity,d("WASignalKeys").serializePubKey(b)))return!1}return!0}return!0}g.compareIdentity=a}),98);
__d("WAGetRegistrationInfoApi",["WACompareIdentity","WADbSignal","WALogger","WASignalDB","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return d("WASignalDB").getDb().runInTransaction(["meta","identity"],"readonly",async function(a){var b,c,e,f,g,h,i,j,k,l;l=await Promise.all([a.stores.meta.bulkGet([(l=d("WADbSignal")).MetaKeysEnum.lastSignedPrekeyId,l.MetaKeysEnum.deviceUUID,l.MetaKeysEnum.lastSessionDeviceWasLinkedTo,l.MetaKeysEnum.regId,l.MetaKeysEnum.identityKeyPair,l.MetaKeysEnum.fbid,l.MetaKeysEnum.deviceId,l.MetaKeysEnum.registrationVersion,l.MetaKeysEnum.deviceRegUnixTime,l.MetaKeysEnum.cat]),d("WACompareIdentity").compareIdentity(a.stores)]);a=l[0];var m=a[0],n=a[1],o=a[2],p=a[3],q=a[4],r=a[5],s=a[6],t=a[7],u=a[8];a=a[9];l=l[1];m=m==null||(b=m.value)==null?void 0:b.lastSignedPrekeyId;n=n==null||(c=n.value)==null?void 0:c.deviceUUID;o=o==null||(e=o.value)==null?void 0:e.lastSessionDeviceWasLinkedTo;p=p==null||(f=p.value)==null?void 0:f.regId;q=q==null||(g=q.value)==null?void 0:g.identityKeyPair;r=r==null||(h=r.value)==null?void 0:h.fbid;s=s==null||(i=s.value)==null?void 0:i.deviceId;t=t==null?void 0:t.value.registrationVersion;u=u==null||(j=u.value)==null?void 0:j.deviceRegUnixTime;a=a==null||(k=a.value)==null||(k=k.cat)==null?void 0:k.expiration_time_in_seconds;return{lastSignedPrekeyId:m,deviceUUID:n,lastSessionDeviceWasLinkedTo:o,regId:p,identityKeyPair:q,registrationUnixTime:u,fbid:r,deviceId:s,registrationVersion:t,identityCompareResult:l,catExpiryUnixTime:a!=null?d("WATimeUtils").castToUnixTime(a):void 0}},d("WASignalDB").signalOp("getRegistrationInfo"))}function b(){return d("WASignalDB").getDb().runInTransaction(["plaintextMeta"],"readonly",function(a){return a.stores.plaintextMeta.get(d("WADbSignal").PlainTextMetaKeysEnum.registrationHistory).then(function(a){return a==null?void 0:a.value.registrationHistory})},"getRegistrationHistory")}var i=10;function c(a){return d("WASignalDB").getDb().runInTransaction(["plaintextMeta"],"readwrite",function(b){return b.stores.plaintextMeta.get(d("WADbSignal").PlainTextMetaKeysEnum.registrationHistory).then(function(c){var e=d("WATimeUtils").unixTime();c=c==null?void 0:c.value.registrationHistory;if(c==null&&a==null)return;var f;if(a!=null)f=[].concat(c!=null?c:[],[{deviceRegTime:a,lastActivityTime:e}]);else{c=c;if(c.length===0){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Registration history log unexpectedly empty"])));return}var g=c[c.length-1];f=[].concat(c.slice(0,-1),[babelHelpers.extends({},g,{lastActivityTime:e})])}return b.stores.plaintextMeta.bulkPut([{key:d("WADbSignal").PlainTextMetaKeysEnum.registrationHistory,value:{registrationHistory:f.slice(-i)}}])})},"updateRegistrationHistory")}g.getRegistrationInfo=a;g.getRegistrationHistory=b;g.updateRegistrationHistory=c}),98);
__d("WASignedKeyApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WASignalDB").getDb().runInTransaction(["signedPrekey"],"readonly",function(b){return b.stores.signedPrekey.get(a)},d("WASignalDB").signalOp("getSignedKey"))}g.getSignedKey=a}),98);
__d("MAWDeviceRegistrationActions",["MAWLoggerUtils","MAWODSProxy","MWFBLogger","MessengerWebInitData","WADbSignal","WAGetRegistrationInfoApi","WAOdsEnums","WASignedKeyApi"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p="Device registration meta is incomplete: ",q=d("MWFBLogger").MWLogger().tags([d("MAWLoggerUtils").Tag.DeviceRegistration]);function r(a,b,c,e,f){(a!=null||b!=null||c!=null||e!=null||f!=null)&&(a==null&&q.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),p,d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId),b==null&&q.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),p,d("WADbSignal").MetaKeysEnum.deviceUUID),c==null&&q.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),p,d("WADbSignal").MetaKeysEnum.regId),e==null&&q.MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),p,d("WADbSignal").MetaKeysEnum.identityKeyPair),f==null&&q.MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["",": ",""])),p,d("WADbSignal").MetaKeysEnum.fbid))}async function a(){var a=await d("WAGetRegistrationInfoApi").getRegistrationInfo(),b=a.deviceId,e=a.deviceUUID,f=a.fbid,g=a.identityCompareResult,h=a.identityKeyPair,i=a.lastSessionDeviceWasLinkedTo,j=a.lastSignedPrekeyId,k=a.regId,l=a.registrationUnixTime;a=a.registrationVersion;g||d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.COMPARE_IDENTITY,key:"meta_identity_mismatch"});if(j==null||e==null||k==null||h==null||f==null){r(j,e,k,h,f);return null}c("MessengerWebInitData").sessionId==null&&q.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["MAWDeviceRegistrationActions: sessionId is null"])));if(b!=null&&typeof b!=="number"){q.MUSTFIX(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[Device Registration Meta Check] Device Id should be a number"])));return null}f=await d("WASignedKeyApi").getSignedKey(j);if(f==null){q.MUSTFIX(o||(o=babelHelpers.taggedTemplateLiteralLoose(["",": signedPrekey}"])),p);return null}return{deviceId:b,deviceUUID:e,identityCompareResult:g,lastSessionDeviceWasLinkedTo:i,lastSignedPrekeyId:j,registrationUnixTime:l,registrationVersion:a!=null?a:void 0,signalRegInfo:{identityKeyPair:h,regId:k,signedPreKey:f}}}g.getRegistrationMetaWorm=a}),98);
__d("MAWDeviceRegistrationODSBump",["MAWCurrentUser","MAWODSProxy","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.DEVICE_REGISTRATION,key:a}),d("MAWCurrentUser").isEmployee()||d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.DEVICE_REGISTRATION_NON_EMPLOYEE,key:a})}g["default"]=a}),98);
__d("XArmadilloWebLinkDeviceToSessionControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/messenger/armadillo/link_device/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("MAWDeviceRegistrationSessionUtil",["CSRFGuard","CurrentMessengerUser","DTSG","DTSGUtils","MAWLoggerUtils","MWFBLogger","PHPQuerySerializer","SprinkleConfig","WAAPI","WAWorkerGlobalScope","XArmadilloWebLinkDeviceToSessionControllerRouteBuilder"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=d("MWFBLogger").MWLogger().tags([d("MAWLoggerUtils").Tag.DeviceRegistration,"LinkDeviceToTheSession"]);async function a(a,b){var e;e=(e=d("WAWorkerGlobalScope").workerGlobalScope.location)==null?void 0:e.origin;if(e==null||e==="")return;if(d("CurrentMessengerUser").isTestUser()&&e.includes("twshared"))return;if(a==null){o.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["DeviceUUID is null"])));return}e=new URL(e).hostname;e=(e=c("XArmadilloWebLinkDeviceToSessionControllerRouteBuilder").buildUri({}).setDomain(e))==null||(e=e.setProtocol("https"))==null?void 0:e.toString();if(e==null)return;var f=d("DTSG").getToken();if(f==null)return;a={device_id:a,fb_dtsg:f};c("SprinkleConfig").param_name&&(a[c("SprinkleConfig").param_name]=c("DTSGUtils").getNumericValue(f));f=d("WAWorkerGlobalScope").workerGlobalScope.fetch;var g;try{g=await f(e,{body:(n||(n=c("PHPQuerySerializer"))).serialize(a),headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST",redirect:"error"})}catch(a){o.catching(a).MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Fetch error, fetch defined: ",""])),f!=null);return}if(!g.ok){o.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Fetch is not 200: ",""])),g.status);return}e=await g.text();d("CSRFGuard").exists(e)&&(e=d("CSRFGuard").clean(e));var p;try{p=JSON.parse(e)}catch(a){o.catching(a).MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Parse response error"])));return}((a=p)==null?void 0:a.success)===!0?(o.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["LinkDeviceToTheSession success"]))),await c("WAAPI").saveLastSessionDeviceWasLinkedTo({sessionId:b})):o.WARN(m||(m=babelHelpers.taggedTemplateLiteralLoose(["fetch result is not succesful"])))}g.linkDeviceToTheSession=a}),98);
__d("WAPreRegistrationCrypto",["WACryptoManager","WASignalSignatures","err"],(function(a,b,c,d,e,f,g){"use strict";async function a(){var a=await d("WACryptoManager").generateRegistrationInfo(),b=a.regId,c=a.staticKeyPair;a=a.authKeyPair;var e=Date.now();e=await d("WASignalSignatures").generateSignedPreKey(1,e,c);var f=e.plainObject;e=e.record;return{regId:b,identityKeyPair:c,authKeyPair:a,signedPreKey:{keyId:f.id,encoded:e}}}function b(a){var b=d("WASignalSignatures").deserializeSignedPreKey(a.signedPreKey.encoded);if(b==null||b.id!==a.signedPreKey.keyId)throw c("err")("Badly formatted signed prekey");return{regId:a.regId,identityPubKeyType:5,identityPubKey:a.identityKeyPair.publicKey,signedPreKey:b}}g.makeRegistrationData=a;g.serializeRegistrationData=b}),98);
__d("MAWDeviceRegistrationUtilWorker",["FBLogger","MAWConstants","MAWCurrentUser","URI","WABase64","WADbDeviceRegistration","WAPreRegistrationCrypto","WATimeUtils","WAWorkerGlobalScope","gkx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){var c=new Uint8Array(b);a=a;for(b=b-1|0;b>=0;--b)c[b]=a&255,a=a>>>8;return c}function j(a,b,c,e,f,g,h,j,k){var l;f=(l=d("WABase64")).encodeB64(i(f,4));g=l.encodeB64(i(g,1));h=l.encodeB64(h);var m=l.encodeB64(i(j.id,3)),n=l.encodeB64(j.keyPair.publicKey);l=l.encodeB64(j.signature);j=new Map().set("fbid",a).set("fb_cat",b).set("app_id",c).set("device_id",e).set("e_regid",f).set("e_keytype",g).set("e_ident",h).set("e_skey_id",m).set("e_skey_val",n).set("e_skey_sig",l);if(k){a=d("WABase64").encodeB64(k.signedICDCIdentityList);b=d("WABase64").encodeB64(k.ihash);j.set("icdc_list",a).set("icdc_ts",k.ts).set("icdc_seq",k.seq).set("ihash",b)}return j}function k(a){var b=[];a.forEach(function(a,c,d){b.push(encodeURIComponent(c)+("="+encodeURIComponent(a.toString())))});return b.join("&")}async function l(a,b){b=await d("WAWorkerGlobalScope").workerGlobalScope.fetch(b,{body:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",priority:"high"});return await b.json()}async function m(a,b,c){b=await d("WAWorkerGlobalScope").workerGlobalScope.fetch(b,{body:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",priority:"high",signal:c});return b.json()}function n(){var a=new(h||(h=c("URI")))(p()+d("WADbDeviceRegistration").ICDC_ENDPOINT);return a.toString()}async function o(a){var b=n();a=await l(a,b);if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow(d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER);if(a.status!==200)throw c("FBLogger")("messenger_web").mustfixThrow("WA Server returned status code "+a.status+" while attempting device registration");return a}function p(){var a=Number(d("MAWCurrentUser").getAppID()),b=d("WADbDeviceRegistration").REG_FB_DOMAIN;switch(a){case 1217981644879628:case 936619743392459:case 487152425211411:case 1035956773910536:b=d("WADbDeviceRegistration").REG_IGD_DOMAIN;break;case 772021112871879:b=d("WADbDeviceRegistration").REG_MSGR_DOMAIN;break;default:b=d("WADbDeviceRegistration").REG_FB_DOMAIN}return b}function q(){var a=new(h||(h=c("URI")))(p()+d("WADbDeviceRegistration").REGISTRATION_ENDPOINT);return a.toString()}var r=new Set(["www.facebook.com","intern.facebook.com","web.facebook.com","www.instagram.com","www.messenger.com"]);function s(){if(c("gkx")("2456")){var a=d("WAWorkerGlobalScope").workerGlobalScope.location.hostname;r.has(a)||c("FBLogger")("bt","device_registration").warn("Invalid subdomain for device registration: %s",a)}}async function t(a){var b=q();s();var e;try{e=await m(a,b)}catch(a){throw c("FBLogger")("messenger_web").mustfixThrow("Post request failed: "+(a==null?void 0:a.message)+" url:"+b)}if(e==null)throw c("FBLogger")("messenger_web").mustfixThrow(d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER);if(e.status!==200){c("FBLogger")("messenger_web").warn("WA Server returned status code %s %s while attempting device registration",e.status,(a=e.message)!=null?a:"");return{message:(b=e.message)!=null?b:"Empty message",status:e.status,success:!1}}if(typeof e.wa_device_id!=="number")throw c("FBLogger")("messenger_web").mustfixThrow("Device ID from WA Server was not a number");if(typeof e.product!=="string")throw c("FBLogger")("messenger_web").mustfixThrow("Product info from WA Server was not a string");return{edge_routing_info:e.edge_routing_info,icdc_success:e.icdc_success,product:e.product,status:200,success:!0,type:e.type,wa_device_id:e.wa_device_id}}function a(a,b,c,d){a=new Map().set("fbid",a).set("fb_cat",b).set("app_id",c).set("device_id",d);b=k(a);return o(b)}function b(a,b,c,d,e,f,g,h,i){a=j(a,b,c,d,e,f,g,h,i);b=k(a);return t(b)}async function e(){var a=await d("WAPreRegistrationCrypto").makeRegistrationData();return{deviceUUID:c("uuidv4")(),lastSignedPrekeyId:a.signedPreKey.keyId,registrationUnixTime:d("WATimeUtils").unixTime(),registrationVersion:d("MAWConstants").CURRENT_REGISTRATION_VERSION,signalRegInfo:a}}g.getRegistrationEndpoint=q;g.fetchICDC=a;g.register=b;g.createNewRegistrationMeta=e}),98);
__d("WAIdentityApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["identity"],"readwrite",function(b){return b.stores.identity.bulkPut([a])},d("WASignalDB").signalOp("saveIdentity"))};g.saveIdentity=a}),98);
__d("WAMockServerShell",["cr:8600"],(function(a,b,c,d,e,f,g){"use strict";a=b("cr:8600")!=null;g.isMockServerMode=a;g.getMockServer=b("cr:8600")}),98);
__d("MAWDeviceRegistrationWorker",["IGDWebUtils","MAWClearSignalAndTempStores","MAWCryptoAuthTokenWrapper","MAWCurrentUser","MAWDeviceRegistrationActions","MAWDeviceRegistrationODSBump","MAWDeviceRegistrationSessionUtil","MAWDeviceRegistrationUtilWorker","MAWJids","MAWLoggerUtils","MAWODSProxy","MAWQplProxy","MWFBLogger","MessengerWebInitData","UserAgentData","WADbDeviceRegistration","WADbMetaTxns","WADbRegistrationApi","WAGetSafeQPLError","WAICDCUtils","WAIdentityApi","WAIdentityUtils","WAJids","WAMockServerShell","WAOdsEnums","WAPreRegistrationCrypto","WASignalKeys","WATimeUtils","cr:7755","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n=d("MWFBLogger").MWLogger().tags([d("MAWLoggerUtils").Tag.DeviceRegistration]),o=function(){return d("IGDWebUtils").isInstagramWebSupportedApp(Number(d("MAWCurrentUser").getAppID()))};function p(a){switch(a){case 1217981644879628:case 936619743392459:case 487152425211411:case 1035956773910536:return"instagram.com";case 772021112871879:return"messenger.com";case 2220391788200892:return"facebook.com";default:return"unknown"}}function q(a,b){b===void 0&&(b=400);return{message:a,registrationState:{type:d("WADbDeviceRegistration").RegistrationStatesEnum.failed},status:b}}async function r(a,b,e){function f(a){b.addPoint(a),e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(e,"device_registration_"+a)}n.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Beginning device registration"])));var g=await d("MAWDeviceRegistrationUtilWorker").createNewRegistrationMeta();f("registration_created");b.addAnnotations({string:{unique_device_id:g.deviceUUID}});await d("WADbRegistrationApi").saveRegistrationMeta(d("MAWCurrentUser").getID(),g);f("registration_saved");var j=d("MAWCurrentUser").getID(),k=g.deviceUUID,l=d("WAPreRegistrationCrypto").serializeRegistrationData(g.signalRegInfo),m=null,p=!1;p=(p=p?1019394685547802:d("MAWCurrentUser").getAppID())==null?void 0:p.toString();if(p==null)return q("appId is null, cannot register to WhatsApp");if(j==="0")return q(d("WADbDeviceRegistration").DEVICE_REGISTER_ERROR_ZERO_AS_USER_ID);var r=null,s=null;try{var t=await d("MAWDeviceRegistrationUtilWorker").fetchICDC(j,a.encrypted_serialized_cat,p,k);f("icdc_fetched");var u=[].concat(d("WAICDCUtils").base64DeviceIdentitiesToSerializedPubKeys(t.device_identities));if(t.curr_identity_idx!=null){var v=t.curr_identity_idx;u[v]=d("WASignalKeys").serializeIdentity(l.identityPubKey)}else u.push(d("WASignalKeys").serializeIdentity(l.identityPubKey));r=d("WAICDCUtils").computeICDCInfoForUpload(g.signalRegInfo.identityKeyPair,t.icdc_seq,u,"registration","registration");s=await d("WAIdentityUtils").computeIdentitiesHash(u);f("identities_computed")}catch(a){n.catching(a).MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Cannot process ICDC payload during registration"])))}v=!1;try{t=await d("MAWDeviceRegistrationUtilWorker").register(j,a.encrypted_serialized_cat,p,k,l.regId,l.identityPubKeyType,l.identityPubKey,l.signedPreKey,r&&s?{ihash:s,seq:r.icdcInfo.seq,signedICDCIdentityList:r.encodedSignedICDC,ts:r.icdcInfo.timestamp}:null);f("device_registered");u=t==null?void 0:t.type;u!=null&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.REGISTRATION_TYPE,key:u});if(!t||!(t!=null&&t.success)){return{message:(a=t==null?void 0:t.message)!=null?a:d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER,registrationState:{type:d("WADbDeviceRegistration").RegistrationStatesEnum.failed},status:(p=t==null?void 0:t.status)!=null?p:"400"}}m=t.wa_device_id;v=(l=t.icdc_success)!=null?l:!1}catch(a){return q(d("WAGetSafeQPLError").getSafeQPLErrorMessage(a))}if(m==null)return q(d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER);s=d("MAWJids").toUserJid(j);if(!o()){f=c("MessengerWebInitData").sessionId;f!=null&&c("promiseDone")(d("MAWDeviceRegistrationSessionUtil").linkDeviceToTheSession(k,f))}if(r!=null&&v){u=r.icdcInfo;await d("WADbRegistrationApi").saveICDC(s,{devices:u.devices,dirty:!0,sequence:u.seq,signingDeviceIndex:u.signingDeviceIndex,timestamp:u.timestamp});b.addPoint("icdc_saved")}await d("WADbRegistrationApi").saveDeviceId(m);b.addPoint("device_saved");a={deviceJid:d("WAJids").toDeviceJid(s,m),identity:d("WASignalKeys").serializeIdentity(g.signalRegInfo.identityKeyPair.publicKey),userJid:s};await d("WAIdentityApi").saveIdentity(a);b.addPoint("identity_saved");return{message:d("WADbDeviceRegistration").DEVICE_SUCCESSFULLY_REGISTERED,registrationState:{registrationTime:g.registrationUnixTime,type:d("WADbDeviceRegistration").RegistrationStatesEnum.finished},status:200}}async function a(a,e){var f=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25307273,"1410"),{string:{browser_name:c("UserAgentData").browserName,device_os:c("UserAgentData").platformName,device_os_version:c("UserAgentData").platformVersion,interface:p(Number(d("MAWCurrentUser").getAppID()))}},{providedTimeoutInMs:2e4}),g=function(a,b){return d("MAWQplProxy").measurePerfInQPL(f,a,b)};try{e=e!=null?e:d("MAWCryptoAuthTokenWrapper").getCryptoAuthToken();if(e==null||e.encrypted_serialized_cat===""){n.WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Crypto Auth Token was null or incomplete"])));f.endFail("empty_cat_token");return q(d("WADbDeviceRegistration").DEVICE_REGISTER_ERROR_EMPTY_CAT_TOKEN,414)}a!=null&&d("MAWQplProxy").sendQPLAnnotationsThroughBridge(a,{int:{secondsUntilCATExpiration:Math.floor(e.expiration_time_in_seconds-Date.now()/1e3)}});if(!d("WATimeUtils").isInFuture(d("WATimeUtils").castToUnixTime(e.expiration_time_in_seconds))){f.endFail("expired_cat_token");return q(d("WADbDeviceRegistration").DEVICE_REGISTER_ERROR_EXPIRED_CAT_TOKEN,413)}if(d("WAMockServerShell").isMockServerMode){var h=await d("MAWDeviceRegistrationUtilWorker").createNewRegistrationMeta();await Promise.all([d("WADbRegistrationApi").saveRegistrationMeta(d("MAWCurrentUser").getID(),h),d("WADbRegistrationApi").saveDeviceId(d("WAJids").interpretAsDeviceId(1)),d("WADbMetaTxns").saveCAT(e)]);f.addPoint("wa_device_registration_mock_server");f.endSuccess();return{message:"Skipping registration because of Mock Server",registrationState:{registrationTime:h.registrationUnixTime,type:d("WADbDeviceRegistration").RegistrationStatesEnum.finished},status:200}}b("cr:7755")!=null&&await b("cr:7755").updateRegDataFromLocalStorage();h=d("MAWDeviceRegistrationActions").getRegistrationMetaWorm();h=await g("get_registration_data",h);f.addAnnotations({string:{unique_device_id:h==null?void 0:h.deviceUUID}});a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_check",{annotations:{bool:{identityCompareResult:h==null?void 0:h.identityCompareResult},int:{registrationVersion:h==null?void 0:h.registrationVersion}}});var i=(h==null?void 0:h.identityCompareResult)===!1;if(h==null||h.deviceId==null||i){f.addAnnotations({bool:{isNewRegistartion:!0}});a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_new_reg_start");try{await g("clear_signal_stores",d("MAWClearSignalAndTempStores").clearSignalAndTempStores()),a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_signal_temp_stores_cleared"),await g("save_cat",d("WADbMetaTxns").saveCAT(e)),a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_cat_saved")}catch(a){return q(d("WAGetSafeQPLError").getSafeQPLErrorMessage(a))}i=await g("try_register",r(e,f,a));i.registrationState.type===d("WADbDeviceRegistration").RegistrationStatesEnum.failed?f.endFail("wa_device_registration_failed",{string:{errorMsg:i.message}}):(f.addPoint("wa_device_registration_successful"),f.endSuccess());a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_new_reg_end");return i}else{f.addAnnotations({bool:{isNewRegistartion:!1}});a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_existing_reg_start");await g("save_cat",d("WADbMetaTxns").saveCAT(e));i=c("MessengerWebInitData").sessionId;g=h.lastSessionDeviceWasLinkedTo==null||h.lastSessionDeviceWasLinkedTo!==i;i!=null&&!(h.deviceUUID===i||h.deviceUUID.startsWith(i+"-"))&&g&&!o()&&c("promiseDone")(d("MAWDeviceRegistrationSessionUtil").linkDeviceToTheSession(h.deviceUUID,i));a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(a,"device_registration_existing_reg_end")}c("MAWDeviceRegistrationODSBump")("already_registered");f.addPoint("wa_device_registration_persisted");f.endSuccess();n.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Skipping device registration"])));return{message:d("WADbDeviceRegistration").DEVICE_ALREADY_REGISTERED,registrationState:{type:d("WADbDeviceRegistration").RegistrationStatesEnum.finished},status:200}}catch(a){f.endFail("uncaught_exception",{string:{errorMsg:(e=a==null?void 0:a.message)!=null?e:"No error message"}});throw a}}function e(a){c("MAWDeviceRegistrationODSBump")("fail");n.MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["",""])),d("WADbDeviceRegistration").FAILED_REGISTRATION_RETRIES);for(a of a)n.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Device registration failure - ",""])),a)}g.handleRegistrationError=q;g.setupDeviceRegistration=a;g.logDeviceRegistrationRetryFailure=e}),98);
__d("MAWFbCat",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function a(a){h=a}function b(){if(h==null)throw c("FBLogger")("messenger_web").mustfixThrow("FBCat is not set");return h}g.setFbCat=a;g.getFbCat=b}),98);
__d("MAWRotateCAT",["FBLogger","MAWBridge","MAWCatQuery.graphql","MAWCryptoAuthToken","MAWFbCat","MAWODSProxy","MAWQplProxy","WAArrayBufferUtils","WADbDeviceRegistration","WADbMetaTxns","WALogger","WAOdsEnums","WAPromiseRetryLoop","WARetryUtils","createWorkerQuery","getErrorSafe","gkx","qpl","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=c("requireDeferred")("WorkerRelayNetwork").__setRef("MAWRotateCAT"),n=c("qpl")._(1056847537,"2667"),o=0;function p(a){var b=a.initiator;a=a.qplAnnotations;o++;var e=d("MAWQplProxy").startQplUserFlow(n,{int:babelHelpers.extends({},a.int,{totalRotationCounter:o}),string:babelHelpers.extends({},a.string,{initiator:b})});d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.CAT_ROTATION,key:"rotateCAT"});d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Starting rotate CAT Task Bridge event"])));c("gkx")("8216")?(e.addAnnotations({string:{fetchFrom:"worker"}}),a=r(e).catch(function(a){e.addPoint("fallback_to_ui");return s().catch(function(b){b=c("getErrorSafe")(b);e.addPoint("fallback_error",{string:{errorDescriptionUI:b.message}});return Promise.reject(a)})})):(e.addAnnotations({string:{fetchFrom:"tab"}}),a=s());return a.then(function(a){if(!a){e.addPoint("no_valid_result");throw c("FBLogger")("messenger_web").mustfixThrow("CAT Rotation failed: no valid result")}return d("WADbMetaTxns").saveCAT(a)}).then(function(a){e.addPoint("set_fb_cat");d("MAWFbCat").setFbCat(d("WAArrayBufferUtils").stringToArrayBuffer(a.encrypted_serialized_cat));d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["CAT Finished Rotating"])));e.endSuccess();return a}).catch(function(a){a=c("getErrorSafe")(a);d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[MAWRotateCAT] Got an error while attempting to rotate CAT: ",""])),a);e.endFail("error",{string:{errorDescription:a.message}});return null})}var q=null;function a(a){var b;if(q!=null)return q.promise();var e=(b=a==null?void 0:a.retries)!=null?b:d("WADbDeviceRegistration").MAX_ROTATE_CRYPTO_AUTH_TOKEN_RETRIES,f=0;b=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({code:async function(b){var g;if(f===e){d("WALogger").COUNT(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Unable to rotate CAT"])));throw c("FBLogger")("messenger_web").mustfixThrow("Unable to rotate CAT")}g=await p({initiator:"MAWRotateCAT::tryRotateCAT",qplAnnotations:{int:babelHelpers.extends({},(g=a.qplAnnotations)==null?void 0:g.int,{retryLoopAllowedRetries:e,retryLoopZeroBasedIteration:f}),string:babelHelpers.extends({},(g=a.qplAnnotations)==null?void 0:g.string,{retryLoopInitiator:a.initiator})}});g!=null&&(d("WALogger").LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Rotate CAT finished, ending rotate CAT promise retry loop"]))),b());f++},name:"rotateCAT",timer:d("WARetryUtils").fibonacciBackoff(!0)});b.start();b.promise().finally(function(){q=null});q=b;return b.promise()}async function r(a){await m.load().then(function(a){a=a.createWorkerNetworkExecute;a()});return c("createWorkerQuery")(c("MAWCatQuery.graphql"),{},{onExecute:function(){a.addPoint("query_executed")},onResponse:function(b){a.addPoint("response_received",{bool:{response_is_array:Array.isArray(b),response_is_null:b===null},int:{response_array_size:Array.isArray(b)?b.length:void 0},string:{response_type:typeof b}});if(typeof b==="object"){b=Array.isArray(b)?b[0]:b;b!=null&&a.addAnnotations({string:{response_payload:JSON.stringify(b.payload)},string_array:{response_keys:Object.keys(b)}})}}}).then(function(a){return d("MAWCryptoAuthToken").processCatResponse(a)}).then(function(a){if(a.error!=null)throw c("FBLogger")("messenger_web").mustfixThrow(a.error);return a.success})}async function s(){await d("MAWQplProxy").workerBridgeDeferred.getPromise();return d("MAWBridge").getBridge().sendAndReceive("event","rotateCryptoAuthToken",{})}g.rotateCAT=p;g.tryRotateCAT=a}),98);
__d("MAWDeviceRegistrationInitWorker",["BackendInitLoggingUtils","BrowserLockManager","MAWDeviceRegistrationODSBump","MAWDeviceRegistrationWorker","MAWHMACKey","MAWQplProxy","MAWRotateCAT","MWFBLogger","WADbDeviceRegistration","WADbRegistrationApi","WAGetRegistrationInfoApi","WAPromiseRetryLoop","WARetryUtils","justknobx","memoizeOneWithArgs","promiseDone","qpl","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o=d("MWFBLogger").MWLogger().tags(["backend","init","deviceRegistration"]);function a(){var a=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();return c("BrowserLockManager")!=null&&!a?d("BackendInitLoggingUtils").measureMawInit("request_maw_registration_lock",function(){return new Promise(function(a,b){c("promiseDone")(c("BrowserLockManager").request("maw_registration_lock",async function(){try{var c=await p();a(c)}catch(a){b(a)}}))})}):p()}var p=c("memoizeOneWithArgs")(async function(){var a=await d("BackendInitLoggingUtils").measureMawInit("init_device_reg_overall",function(){return q()}),b=a.message;a=a.registrationState;if(a===d("WADbDeviceRegistration").RegistrationStatesEnum.failed)throw o.mustfixThrow("registration_failed: "+b);a=await Promise.all([d("BackendInitLoggingUtils").measureMawInit("load_reg_in_txn",function(){return d("WADbRegistrationApi").loadAllRegistrationMetaInTransaction()}),d("BackendInitLoggingUtils").measureMawInit("gen_insert_hmac",function(){return d("MAWHMACKey").generateAndInsertHMACKey()})]);b=a[0];a=a[1];return{hmacKey:a,regData:b}});function q(){var a=0,b=new Set(),e=0,f=new(d("WAPromiseRetryLoop").PromiseRetryLoop)({code:async function(f){a++;if(a>d("WADbDeviceRegistration").MAX_DEVICE_REGISTRATION_RETRIES){d("MAWDeviceRegistrationWorker").logDeviceRegistrationRetryFailure(b);var g=d("MAWDeviceRegistrationWorker").handleRegistrationError(d("WADbDeviceRegistration").FAILED_REGISTRATION_RETRIES);f(g);return}try{g=null;switch(e){case 414:case 413:case 418:o.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration ",". Rotate CAT"])),e);g=await d("MAWRotateCAT").rotateCAT({initiator:"MAWDeviceRegistrationInitWorker::initDeviceRegistration",qplAnnotations:{int:{prevStatusCode:e}}});break;case 400:case 401:o.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration ",": User should re-login"])),e);c("justknobx")._("3526")&&(g=await d("MAWRotateCAT").rotateCAT({initiator:"MAWDeviceRegistrationInitWorker::initDeviceRegistration",qplAnnotations:{int:{prevStatusCode:e}}}));break;case 415:o.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration 415: User should take action to  re-register to WAI"])));break;case 403:o.MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration 403: User is banned"])));break;case 500:o.MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["DeviceRegistration 500: Retry is needed"])));break}var p=a===1?c("qpl")._(25310776,"6155"):null;p=await d("MAWDeviceRegistrationWorker").setupDeviceRegistration(p,g);e=p.status;c("MAWDeviceRegistrationODSBump")("attempt."+a+".result."+p.registrationState.type);p.registrationState.type===d("WADbDeviceRegistration").RegistrationStatesEnum.finished&&(p.registrationState.registrationTime!=null&&c("MAWDeviceRegistrationODSBump")("success"),o.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Registration finished, ending device registration promise retry loop"]))),f(p));b.add(p.message);d("MAWQplProxy").sendQPLAnnotationsThroughBridge(c("qpl")._(25310776,"6155"),{int:{deviceRegistrationLastAttemptCount:a},string:{deviceRegistrationLastAttemptMessages:Array.from(b).join(", ")}})}catch(e){g="Uncaught device registration error - "+e;o.WARN(n||(n=babelHelpers.taggedTemplateLiteralLoose(["",""])),g);b.add(""+g);d("MAWQplProxy").sendQPLAnnotationsThroughBridge(c("qpl")._(25310776,"6155"),{int:{deviceRegistrationLastAttemptCount:a},string:{deviceRegistrationLastAttemptMessages:Array.from(b).join(", ")}})}},name:"deviceRegistration",timer:d("WARetryUtils").fibonacciBackoff(!0)});f.start();return f.promise().then(function(a){a.registrationState.type===d("WADbDeviceRegistration").RegistrationStatesEnum.finished&&c("promiseDone")(d("WAGetRegistrationInfoApi").updateRegistrationHistory(a.registrationState.registrationTime));return a})}g.registerDevice=a;g.performDeviceRegistration=p;g.initDeviceRegistration=q}),98);
__d("MAWExpiredXMACleaner",["FBLogger","MAWMsgCleaner","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=null;function a(a){j==null&&(j=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.XMA))}function b(a){if(j==null){var b="Trying to add new addNewExpiredXMACleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["",""])),b);throw c("FBLogger")("messenger_web").mustfixThrow(b)}else d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["ExpiredXMACleaner: Adding timestamps backend(",")"])),a),j.update(a)}function e(){return j}function f(){j=null}g.startExpiredXMACleaner=a;g.addNewExpiredXMACleanerTimestamp=b;g.getExpiredXMACleaner_FOR_TESTING_ONLY=e;g.resetExpiredXMACleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWLoadGroupInvitesTxns",["MAWBridgeTypesCreators","MAWDbGroupInviteTxns","MAWDexieTable","MAWIndexedDb","MAWUserJidWrapper","WAJids","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=[],f=d("MAWUserJidWrapper").getMyUserJid();b.forEach(function(b){return d("WAJids").switchOnMsgrChatJidType(b.jid,{group:function(){e.push(d("MAWDbGroupInviteTxns").getGroupInvitesByThreadAndInvitedParticipant(a,b.jid,f))},user:c("emptyFunction")})});return d("MAWDexieTable").dexieAll(e).then(function(a){a.forEach(function(a,b){a.forEach(function(b,a){d("MAWIndexedDb").afterTransaction({tag:"GroupInviteUpdate",value:d("MAWBridgeTypesCreators").createBridgeGroupInvite(b)})})})})}g.loadGroupInvites=a}),98);
__d("MAWLoadOneToOneMessageRequestCapabilitiesTxn",["MAWDexieTable","MAWIndexedDb","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a.map(d("WAJids").interpretAsUserJid).forEach(function(a){return a!=null&&d("MAWIndexedDb").afterTransaction({tag:"OneToOneMessageRequestLoaded",value:{fbid:d("WAJids").extractUserId(a),threadJid:a}})});return d("MAWDexieTable").dexieResolve()}g.loadOneToOneMessageRequestCapabilities=a}),98);
__d("MAWLoadMessagesRequest",["FBLogger","MAWMessagesCompare","MAWMessagesDirection","MessagesRangesV2ExternalIds","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";b={admin:!1,editMsgHistory:!1,media:!1,polls:!1,reactions:!1,receiverFetch:!1,xma:!1};function h(a,b,e){if(a.length===0)return[];e=d("MAWMessagesCompare").getSortComparisonFunctionForDirection(d("MAWMessagesDirection").translateMawDirectionToMwpDirection(e));a=[].concat(a).sort(e);if(b.lowerBoundExternalId!=null&&((e=b.lowerBoundExternalId)==null?void 0:e.toString())!==d("MessagesRangesV2ExternalIds").MIN_EXTERNAL_ID&&((e=b.lowerBoundExternalId)==null?void 0:e.toString())!==d("MessagesRangesV2ExternalIds").MAX_EXTERNAL_ID){e=a.findIndex(function(a){return a.externalId===b.lowerBoundExternalId});e!==-1?a=a.slice(e):c("FBLogger")("messenger_web").mustfix("Get messages for range: no external id in source msgs list")}a=i(a,b);return a.slice(0,b.numMsgs)}function a(a,b,c,e){a=a.filter(function(a){var c;return((c=a.sortOrderMs)!=null?c:Number.MAX_SAFE_INTEGER)>=b.gte[0]&&((c=a.sortOrderMs)!=null?c:Number.MIN_SAFE_INTEGER)<=b.lte[0]});var f=d("MAWMessagesDirection").switchOnMAWMessagesDirection(c,{after:[b.gte,b.lte],before:[b.lte,b.gte]}),g=f[0],i=g[0];g=g[1];f=f[1];f[0];var j=f[1];f=h(a,{includeLowerBoundMsg:!0,lowerBoundExternalId:d("WAStanzaUtils").toStanzaId(g),lowerBoundSortOrderMs:i,numMsgs:e},c);if(j!==d("MessagesRangesV2ExternalIds").MIN_EXTERNAL_ID&&j!==d("MessagesRangesV2ExternalIds").MAX_EXTERNAL_ID){a=f.findIndex(function(a){return a.externalId===j});if(a!==-1)return f.slice(0,a)}return f}function i(a,b){if(b.includeLowerBoundMsg||a.length===0)return a;return a[0].externalId===b.lowerBoundExternalId||a[0].sortOrderMs===b.lowerBoundSortOrderMs?a.slice(1):a}g.loadMsgsConfigForCheckingOnly=b;g.getMsgsForRange=h;g.getMsgsForBounds=a}),98);
__d("MAWLoadMsgsDedupper",["MAWDbMsgUtil","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=new Set();return function(b){b=d("MAWDbMsgUtil").getProtocolMsgIdFromDbMsg(b);if(b==null)return!0;b=d("WAMsg").craftWAMsgIdString(b);if(b!=null){if(a.has(b))return!1;a.add(b)}return!0}}g["default"]=a}),98);
__d("MAWLoadMsgsUtil",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){var d=0,e=0,f=!1,g=null;return function(h){e++;if(g!=null&&g===h.sortOrderMs)return!1;if(e>b&&h.sortOrderMs!==a)return!0;h.msgId===c&&(f=!0);f&&d++;if(d>b)return!0;g=h.sortOrderMs;return!1}}function b(a){var b=!0,c=0,d=null;return function(e){if(d===null)c++;else if(d===e.sortOrderMs){c+=b?0:1;return!1}else c++,b=!1;if(c>a)return!0;d=e.sortOrderMs;return!1}}f.makeUntilWithRangeExtension=a;f.makeUntilWithRangeExtensionBothDirections=b}),66);
__d("MAWLoadMsgsTxnsV2",["I64","MAWBridgeMsg","MAWBridgeMsgCountdown","MAWBridgeReceiverFetchInfo","MAWBridgeTypesCreators","MAWBridgeXMA","MAWCurrentUser","MAWDbChunkTxns","MAWDbEditMsgHistoryTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbPollTxns","MAWDbReactionsTxns","MAWDbReceiverFetchTxns","MAWDbXMATxns","MAWDexieTable","MAWGetIsMediaDownloadStatusEnabled","MAWHandleXmaTransactionUtil","MAWLoadMessagesRequest","MAWLoadMsgsDedupper","MAWLoadMsgsUtil","MAWLoadReplyMediaTxns","MAWLoggerUtils","MAWMediaUtils","MAWMessagesDirection","MAWODSProxy","MAWRavenUtils","MAWXMAUtils","MWFBLogger","MsgrWebGating","WAMsgType","WAOdsEnums","WATimeUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m;function n(a,b,d,e,f,g){switch(d){case"before":return h();case"after":return i().then(function(a){return a.reverse()})}function h(){var d=c("MAWLoadMsgsDedupper")();return a.messages.where(["threadJid","sortOrderMs"]).between([b,0],[b,e],!0,!0).reverse().filter(f).filter(d).filter(function(a){return c("justknobx")._("3227")?a.source!=="media_restore":a!=null}).until(g,!0).toArray()}function i(){var d=c("MAWLoadMsgsDedupper")();return a.messages.where(["threadJid","sortOrderMs"]).between([b,e],[b,Number.MAX_SAFE_INTEGER],!0,!0).filter(f).filter(d).filter(function(a){return c("justknobx")._("3227")?a.source!=="media_restore":a!=null}).until(g,!0).toArray()}}function o(a,b){return d("MAWDbReactionsTxns").getReactionsFromMessages(a,b).then(function(a){return a.map(function(a){var b=a.author,c=a.reaction,e=a.reactToMsgId,f=a.threadJid;a=a.ts;if(e==null)return;return c==null?{reaction:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:f,reactToMsgId:e}),type:"delete"}:{reaction:d("MAWBridgeTypesCreators").createBridgeUpsertReaction({author:b,chatJid:f,reaction:c||"",reactToMsgId:e,ts:a}),type:"upsert"}}).filter(Boolean)})}function p(a,b){return d("MAWDbMediaTxns").getMsgMediaPairFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b[0],e=b[1];return d("MAWDbChunkTxns").hasMediaChunk(a,e.hashedPlaintextHash).then(function(b){return q(a,c.threadJid,e).then(function(f){var g=f.map(function(a){return a.msgId}),h=d("MAWMediaUtils").createHdTypesForBridgeMedia(f);g=c.ravenEphemeralType!=null&&c.ravenEphemeralMediaState!=null?d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:c.threadJid,filteredMsgIds:g,hasMediaForUI:b,hdTypes:h,media:e,ravenSettings:d("MAWRavenUtils").deriveRavenSettings(c.ravenEphemeralType,c.ravenEphemeralMediaState),sortOrderMs:c.sortOrderMs}):d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:c.threadJid,filteredMsgIds:g,hasMediaForUI:b,hdTypes:h,media:e,sortOrderMs:c.sortOrderMs});return d("MAWMediaUtils").getBridgeMediaAnnotatedForDisplay(a,g,f)})})}))})}function q(a,b,c){return a.messages.where("msgId").anyOf(c.msgIds).toArray().then(function(a){return a.filter(function(a){return a.threadJid===b})})}function r(a,b){return d("MAWDbXMATxns").getXMAFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return d("MAWDexieTable").dexieResolve(null);if(d("MAWGetIsMediaDownloadStatusEnabled").getIsMediaDownloadStatusForXMAsEnabledWithChunkVerification()){var c=[b.defaultPreviewMediaId,b.faviconMediaId,b.headerMediaId].filter(Boolean);return d("MAWDbMediaTxns").maybeBulkGetMediaFromMediaId(a,c).then(function(c){if(c.size===0)return d("MAWBridgeXMA").createBridgeXMA(null,b,{hasMedia:!1,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1});var e=b.defaultPreviewMediaId!=null?c.get(b.defaultPreviewMediaId):null,f=b.headerMediaId!=null?c.get(b.headerMediaId):null;c=b.faviconMediaId!=null?c.get(b.faviconMediaId):null;return d("MAWHandleXmaTransactionUtil").verifyAllMediaChunksForXMA(e,c,f,a).then(function(a){var c=a.hasMedia,f=a.hasXmaFaviconMedia;a=a.hasXmaHeaderMedia;return d("MAWBridgeXMA").createBridgeXMA(e,b,{hasMedia:c,hasXmaFaviconMedia:f,hasXmaHeaderMedia:a})})})}return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.defaultPreviewMediaId).then(function(c){return c==null?d("MAWBridgeXMA").createBridgeXMA(c,b,{hasMedia:!1,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1}):d("MAWDexieTable").dexieAll([c,d("MAWDbChunkTxns").hasMediaChunk(a,c==null?void 0:c.hashedPlaintextHash)]).then(function(a){var c=a[0];a=a[1];return d("MAWBridgeXMA").createBridgeXMA(c,b,{hasMedia:a,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1})})})}))}).then(function(a){return a.filter(Boolean)})}function s(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){return b.receiverFetchId==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbReceiverFetchTxns").maybeGetReceiverFetchInfoFromReceiverFetchId(a,b.receiverFetchId).then(function(a){return a==null?d("MAWDexieTable").dexieResolve(null):d("MAWBridgeReceiverFetchInfo").createBridgeReceiverFetchInfoPayloadFromDbInfo(b.threadJid,b.msgId,b.sortOrderMs,b.ts,a)})})).then(function(a){return a.filter(Boolean)})}function t(a,b){var c=new Map();return d("MAWDexieTable").dexieAll(b.map(function(b){if(b.type!==d("WAMsgType").MSG_TYPE.GROUP_POLL_CREATE&&b.type!==d("WAMsgType").MSG_TYPE.GROUP_POLL_UPDATE)return null;var e=b.type===d("WAMsgType").MSG_TYPE.GROUP_POLL_CREATE?b.externalId:b.pollStanzaId;if(e==null){d("MWFBLogger").MWMediaLogger().tags(["GroupPollsE2EE"]).mustfix("pollStanzaId is null for poll msg in MLV2");return null}var f=c.get(e);if(f!=null){if(f.externalId===b.externalId){return u(a,b.threadJid,e,f.msgId,d("WATimeUtils").castToMillisTime((f=f==null?void 0:f.sortOrderMs)!=null?f:0))}return null}return d("MAWDbPollTxns").maybeGetLatestPollUpdateMsg(a,e,b.threadJid).then(function(f){if(f==null){var g;return u(a,b.threadJid,e,b.msgId,d("WATimeUtils").castToMillisTime((g=b.sortOrderMs)!=null?g:0))}c.set(e,f);if(f.externalId===b.externalId){return u(a,b.threadJid,e,f.msgId,d("WATimeUtils").castToMillisTime((g=f==null?void 0:f.sortOrderMs)!=null?g:0))}else return null})})).then(function(a){return a.filter(Boolean)})["finally"](function(){c.clear()})}function u(a,b,c,e,f){return a.poll.get([b,c]).then(function(a){if(a==null){d("MWFBLogger").MWMediaLogger().tags(["GroupPollsE2EE"]).mustfix("Poll is null in MLV2");return null}return{contactIdForCurrentUser:(m||(m=d("I64"))).of_string(d("MAWCurrentUser").getID()),dbPoll:a,latestUpdateMsgId:e,latestUpdateTimestampMs:f}})}function v(a,b,c){if(!d("MsgrWebGating").isQuotedMessagesInLsEnabled())return d("MAWDexieTable").dexieResolve([c,[]]);var e=c.map(function(c){return c.quote==null?null:d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,c.quote.content.externalId,b,(c=c.quote)==null?void 0:c.content.author)}).filter(Boolean);return e.length<=0?d("MAWDexieTable").dexieResolve([c,[]]):d("MAWDexieTable").dexieAll(e).then(function(a){return[c,a.filter(Boolean)]})}function w(a,b,c,e,f,g,h){h===void 0&&(h=function(){return!0});var i=d("WATimeUtils").unixTime(),j=function(a){return a.messageExpirationTs==null||a.messageExpirationTs>i};c=d("MAWLoadMsgsUtil").makeUntilWithRangeExtension(f,c,g);return n(a,b,e,f,function(a){return h(a)&&j(a)},c).then(function(c){return v(a,b,c)}).then(function(b){var c=b[0],e=b[1];return d("MAWDexieTable").dexieAll([].concat(c,e).map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return{msgs:c,quoteMsgs:e,replyMediaInfo:a}})})}function x(a,b){return a.messages.where("externalId").equals(b).toArray()}function y(a,b){return x(a,b).then(function(c){c.length>1&&d("MWFBLogger").MWLogger().tags(["Pinned"]).warn("duplicate MAW msg returned for externalId",b);return d("MAWDexieTable").dexieAll(c.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return{msgs:c,replyMediaInfo:a}})})}function z(a){a=a.filter(function(a){return a.ephemeralCounterStarted});if(a.length>0){d("MWFBLogger").MWLogger().tags([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown,d("MAWLoggerUtils").Tag.OnLoad]).DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCounter: Showing UI counter for ",""])),String(a.map(function(a){return a.msgId})));return d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(a).msgs}return[]}function A(a,b){return a!=null?a:d("MAWMessagesDirection").switchOnMAWMessagesDirection(b,{after:Number.MIN_SAFE_INTEGER,before:Number.MAX_SAFE_INTEGER})}function a(a){var b=a.chatJid,c=a.config,e=a.db,f=a.direction,g=a.range,h=d("WATimeUtils").unixTime();a=function(a){var b=a.messageExpirationTs!=null&&a.messageExpirationTs<h,e=a.type===d("WAMsgType").MSG_TYPE.ADMIN&&!c.admin;a=a.isCollapsed===!0;return!b&&!e&&!a};var j=g.includeLowerBoundMsg?g.numMsgs:g.numMsgs+1;j=d("MAWLoadMsgsUtil").makeUntilWithRangeExtensionBothDirections(j);var k=A(g.lowerBoundSortOrderMs,f);return n(e,b,f,k,a,j).then(function(a){return v(e,b,a)}).then(function(a){var b=a[0],c=a[1],h=d("MAWLoadMessagesRequest").getMsgsForRange(b,g,f);return d("MAWDexieTable").dexieAll([].concat(h,c).map(function(a){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(e,a)})).then(function(a){return{msgsForRange:h,quotedMsgs:c,replyMediaInfo:a}})}).then(function(a){var h=a.msgsForRange,j=a.quotedMsgs;a=a.replyMediaInfo;d("MWFBLogger").MWLogger().tags(["MAWSecureLocalDBDataSource"]).DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs, chatJid: ",", range: ",".}"])),b,String(g));return B(e,h,j,a,f,g.numMsgs,c,b)})}function b(a,b,c,e,f,g,h,i){var k=A(f,e);return w(a,b,c,e,k,h,function(a){var b=a.isCollapsed===!0;a=!i.admin&&a.type===d("WAMsgType").MSG_TYPE.ADMIN;return!(b||a)}).then(function(f){var l=f.msgs,m=f.quoteMsgs;f=f.replyMediaInfo;var n=l;g||(n=n.filter(function(a){return a.msgId!==h}),n.length===l.length&&l.length!==0&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.LOAD_MORE_NO_ORIGINAL_MSG_IN_MAW,key:"mismatch"}));d("MWFBLogger").MWLogger().tags(["MAWSecureLocalDBDataSource"]).DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs: From:"," orignalMsgId:",", chatJid: ",""])),k,h,b);return B(a,n,m,f,e,c,i,b)})}function B(a,b,c,e,f,g,h,i){var j=b.length;if(j===0)return d("MAWDexieTable").dexieResolve({editMsgHistory:[],expiringCountdown:[],hasMoreAfter:D(j,g,f),hasMoreBefore:C(j,g,f),medias:[],msgs:[],polls:[],quotedMsgs:[],reactions:[],receiverFetchInfoPayloads:[],xmas:[]});var l=b.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,(e||[])[b])}).filter(Boolean),m=z(b);d("MWFBLogger").MWLogger().tags(["MAWSecureLocalDBDataSource"]).DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs, chatJid: ",", result: ",""])),i,String(l.map(function(a){return a.msgId+":"+a.sortOrderMs})));return d("MAWDexieTable").dexieAll([h.reactions?o(a,b):d("MAWDexieTable").dexieResolve([]),h.media?p(a,b):d("MAWDexieTable").dexieResolve([]),h.xma?r(a,b):d("MAWDexieTable").dexieResolve([]),h.editMsgHistory?d("MAWDbEditMsgHistoryTxns").loadEditMsgHistory(a,b):d("MAWDexieTable").dexieResolve([]),h.receiverFetch?s(a,b):d("MAWDexieTable").dexieResolve([]),h.polls?t(a,b):d("MAWDexieTable").dexieResolve([])]).then(function(a){var b=a[0],e=a[1],h=a[2],i=a[3],k=a[4];a=a[5];return{editMsgHistory:i,expiringCountdown:m,hasMoreAfter:D(j,g,f),hasMoreBefore:C(j,g,f),medias:e,msgs:l,polls:a,quotedMsgs:c.map(function(a){return d("MAWBridgeMsg").createBridgeMsg(a,null,!0)}),reactions:b,receiverFetchInfoPayloads:k,xmas:h}})}function C(a,b,c){switch(c){case"before":return a>=b;default:c;return!0}}function D(a,b,c){switch(c){case"after":return a>=b;default:c;return!0}}function e(a,b,c){return y(a,b).then(function(e){var f=e.msgs,g=e.replyMediaInfo;if(f.length===0)return{editMsgHistory:[],medias:[],msgs:[],polls:[],reactions:[],receiverFetchInfoPayloads:[],xmas:[]};var h=f.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,(g||[])[b])}).filter(Boolean);d("MWFBLogger").MWLogger().tags(["MAWFetchMessageByPinnedExternalId"]).DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["LoadMsgsByExternalId: From: externalId:",". ",""])),b,String(h.map(function(a){return""+a.msgId})));return d("MAWDexieTable").dexieAll([c.reactions?o(a,f):d("MAWDexieTable").dexieResolve([]),c.media?p(a,f):d("MAWDexieTable").dexieResolve([]),c.xma?r(a,f):d("MAWDexieTable").dexieResolve([]),c.editMsgHistory?d("MAWDbEditMsgHistoryTxns").loadEditMsgHistory(a,f):d("MAWDexieTable").dexieResolve([]),c.receiverFetch?s(a,f):d("MAWDexieTable").dexieResolve([]),c.polls?t(a,f):d("MAWDexieTable").dexieResolve([])]).then(function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4];a=a[5];return{editMsgHistory:e,medias:c,msgs:h,polls:a,reactions:b,receiverFetchInfoPayloads:f,xmas:d}})})}g.loadMoreMsgsAndMediaForRange=a;g.loadMoreMsgsAndMediaFromTs=b;g.loadMsgsAndMediaByExternalId=e}),98);
__d("MAWLoadMsgsTxns",["MAWIndexedDb","MAWLoadMsgsTxnsV2"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){e===void 0&&(e=!1);f===void 0&&(f="before");return d("MAWLoadMsgsTxnsV2").loadMoreMsgsAndMediaFromTs(a,b,c,f,null,e,null,{admin:!0,editMsgHistory:!0,media:!0,polls:!0,reactions:!0,receiverFetch:!0,xma:!0}).then(function(a){var b=a.expiringCountdown,c=a.hasMoreAfter,e=a.hasMoreBefore,f=a.medias,g=a.msgs,h=a.quotedMsgs,i=a.receiverFetchInfoPayloads;a=a.xmas;h!=null&&(h.length>0&&d("MAWIndexedDb").afterTransaction({tag:"NewMsgs",value:{msgs:h}}));g.length>0&&d("MAWIndexedDb").afterTransaction({tag:"NewMsgs",value:{msgs:g}});b.length>0&&d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:{msgs:b}});a.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"NewXMA",value:a})});f.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"NewMedia",value:a})});i.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"NewReceiverFetchInfo",value:a})});return{hasMoreAfter:c,hasMoreBefore:e}})}g.loadMsgAndMedia_COMPAT=a}),98);
__d("MAWLoadThreadsTxns",["FBLogger","I64","MAWBridgeThread","MAWBridgeTypesCreators","MAWDbParticipantTxns","MAWDexieTable","MAWIndexedDb","MAWLoadGroupInvitesTxns","MAWLoadMsgsTxns","MAWLoadOneToOneMessageRequestCapabilitiesTxn","MAWMpsGating","MAWThreadMappingQPL","MAWTransactionMode","MAWUserJidWrapper","WAJids","WALogger","emptyFunction","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,e,f){f===void 0&&(f="unknown");b.forEach(function(a){var b=d("MAWThreadMappingQPL").getInstanceKeyForJidInWorker(a.jid);d("MAWThreadMappingQPL").startInWorker({instanceKey:b,jid:a.jid,threadKey:a.optimisticThreadKey==null?void 0:(h||(h=d("I64"))).of_string(a.optimisticThreadKey),trigger:"loadContentsForThreads_"+f});d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(a,e==null?void 0:e.get(a.jid),void 0,"loadContentsForThreads_"+f,b)})});return d("MAWMpsGating").isFullMpsEnabled()?d("MAWDexieTable").dexieResolve(b):d("MAWDexieTable").dexieAll([].concat(b.map(function(b){return d("MAWLoadMsgsTxns").loadMsgAndMedia_COMPAT(a,b.jid,c,!0)}),[i(a,b),d("MAWLoadOneToOneMessageRequestCapabilitiesTxn").loadOneToOneMessageRequestCapabilities(b.map(function(a){return a.jid})),d("MAWLoadGroupInvitesTxns").loadGroupInvites(a,b)])).then(function(){return b})}function i(a,b){var e=[];b.forEach(function(a){return d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(a){return e.push(a)},user:c("emptyFunction")})});return a.groupInfo.bulkGet(e).then(function(a){a.forEach(function(a){a!=null&&d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(a)})})})}b=function(a){a=a.threadJid;return j(a)};var j=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY},"checkIfGroupParticipant",function(a){return function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return k.apply(void 0,[a].concat(c))}});function k(a,b,e,f,g,h){e===void 0&&(e=!0);f===void 0&&(f=!0);var i=d("MAWUserJidWrapper").getMyUserJid();return d("MAWDbParticipantTxns").getParticipant(a,b,i).then(function(a){if(!a.success){var j=e?"group":"one_to_one";d("WALogger").LOG(["[Occamadillo] User is not a participant of "+j+" thread\n        "+b.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]);if(g==null){var k;c("FBLogger")("maw_db","checkIfParticipant").catching((k=a.payload)!=null?k:c("err")(a.error)).warn("[Occamadillo] User %s is not a participant of %s thread %s, occam: %s, archived: %s, cannotReplyReason null.",i,j,b.toString(),f,h)}c("FBLogger")("labyrinth_web","checkIfParticipant").warn("[Occamadillo] User not a participant from checkIfParticipant");k={cannotReplyReason:"viewer_not_subscribed",threadJid:b};d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(k)})}})}g.loadContentsForThreads=a;g.loadGroups=i;g.checkIfGroupParticipant=b}),98);
__d("MAWGroupInviteManagementTxns",["MAWDbGroupInviteTxns","MAWDbParticipantTxns","MAWDexieTable","MAWUserJidWrapper"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=!1;return d("MAWDbParticipantTxns").getInvitedParticipantsInThread(a,b).then(function(e){if(e.length===0){c=!0;var f=d("MAWUserJidWrapper").getMyUserJid();return d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,f).then(function(){return c})}else{var g=[];e.forEach(function(c){g.push(d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,c.userJid))});return d("MAWDexieTable").dexieAll(g).then(function(){return c})}})}g.deleteGroupInvitesByThread=a}),98);
__d("MAWThreadManagementTxns",["MAWBridgeEventTransmitter","MAWBridgeParticipants","MAWBridgeTypesCreators","MAWDbGroupInfoTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDexieTable","MAWGetOrCreateThreadTxns","MAWGroupInviteManagementTxns","MAWIndexedDb","MAWLoadOneToOneMessageRequestCapabilitiesTxn","MAWQplProxy","WAJids","WALogger","WAMsgType","WASortedLists","WATimeUtils","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f){var g=b.authoritativeThreadKey,h=b.createTs,i=b.description,j=b.folder,k=b.lastActivityTimestamp,m=b.lastReadWatermarkTimestamp,n=b.offlineThreadingId,o=b.skipVerifyThread,p=b.userJid;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:g,clientThreadKey:n,createTs:h,description:i,folder:j,instanceKey:f,jid:p,lastActivityTimestamp:k,lastReadWatermarkTimestamp:m,skipVerifyThread:o},e).then(function(b){var g=b.created;b=b.thread;e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"process-setup-thread-start",{instanceKey:e});f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(1056836502,"2778"),"process_setup_thread_start",{instanceKey:f});g=l(a,p,g,b);e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"process-setup-thread-end",{instanceKey:e});f!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(1056836502,"2778"),"process_setup_thread_end",{instanceKey:f});return g})}function b(a,b,c,e){return d("MAWDbGroupInfoTxns").getGroupInfo(a,b).then(function(b){if(!b.success)return null;var f=b.value;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{createTs:d("WATimeUtils").castUnixTimeToMillisTime(f.creationTs),description:"getOrRepairGroupThread",folder:c,jid:f.groupJid,skipVerifyThread:e}).then(function(a){var b=a.created;a=a.thread;return{created:b,groupInfo:f,thread:a}})})}function i(a,b){var c=[],e=[];b.forEach(function(a){d("MAWDbMsg").isMediaMsg(a)&&a.mediaId!=null&&(c.push(a.mediaId),e.push(a.msgId))});return a.media.bulkGet(c).then(function(b){var c=[],f=[];b.forEach(function(a,b){if(a!=null){var g=e[b];a.msgIds=d("WASortedLists").filter(a.msgIds,function(a){return a!==g});a.mediaEntries["delete"](g);a.msgIds.length===0&&a.mediaEntries.size===0&&(a.plaintextHash!=null&&c.push(a.hashedPlaintextHash),f.push(a.mediaId))}});b=a.media.bulkDelete(f);var g=a.chunk.where("hashedPlaintextHash").anyOf(c)["delete"]();return d("MAWDexieTable").dexieAll([b,g]).then(function(){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted "," media rows and "," chunk rows"])),f.length,c.length)})})}function j(a,b){return d("MAWDbMsgTxns").getThreadNewestMessageMs(a,b.jid).then(function(c){return a.messages.where("threadJid").equals(b.jid).toArray().then(function(d){return k(a,b,c,d,!0)})})}function e(a,b,c,e){var f=c==null?void 0:c.lastMessageTimestamp;if(c==null)return j(a,b);var g=a.messages.where("threadJid").equals(b.jid).toArray(),h=d("MAWDbMsgTxns").getThreadNewestMessageMs(a,b.jid);return d("MAWDexieTable").dexieAll([g,h]).then(function(g){var h=g[0];g=g[1];var i=[],j=new Set();f!=null&&h.forEach(function(a){var b;b=(b=a.originalTs)!=null?b:a.ts;b<=f+1&&(j.add(a.msgId),i.push(a))});if((c==null?void 0:c.messages.length)!==0){var l=new Set();c.messages.forEach(function(a){l.add((a=a.key)==null?void 0:a.id)});h.forEach(function(a){l.has(a.externalId)&&!j.has(a.msgId)&&(j.add(a.msgId),i.push(a))})}if(i.length!==h.length)for(var m of h)if(!j.has(m.msgId)&&m.type!==d("WAMsgType").ADMIN)return k(a,b,g,i,!1,e);return k(a,b,g,h,!0,e)})}function k(a,b,c,e,f,g){var h=d("WAJids").interpretAsGroupJid(b.jid),j=f?d("MAWDbThreadTxns").deleteThread(a,b.jid):d("MAWDexieTable").dexieResolve(),k=f?d("MAWDbParticipantTxns").deleteAllParticipantsForThread(a,b.jid):d("MAWDexieTable").dexieResolve(),l=d("MAWDexieTable").dexieResolve(!1),m=d("MAWDexieTable").dexieResolve();h!=null&&f&&(l=d("MAWGroupInviteManagementTxns").deleteGroupInvitesByThread(a,h),m=d("MAWDbGroupInfoTxns").deleteGroupInfo(a,h));return d("MAWDexieTable").dexieAll([i(a,e),d("MAWDbReactionsTxns").deleteAllReactionsForMessages(a,e),d("MAWDbMsgTxns").deleteMessages(a,e,g),j,k,m,l]).then(function(a){a[0];a[1];a[2];a[3];a[4];a[5];a=a[6];f&&(d("MAWBridgeEventTransmitter").deleteMessagesOfThreadAfterTxn(b,c),h!=null&&a&&d("MAWIndexedDb").afterTransaction({tag:"DeleteGroupInvite",value:d("MAWBridgeTypesCreators").createBridgeDeleteGroupInvite(b.jid)}),d("MAWIndexedDb").afterTransaction({tag:"ThreadHiddenV2",value:b.jid}));return{deletedMessages:e.map(function(a){return d("MAWDbMsg").getWAMsgId(a)})}})}function l(a,b,c,e){a=d("MAWDbParticipantTxns").bulkRemoveIncorrectAndInsertMissingParticipantsInOneToOneThread(a,b).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(a)})});return d("MAWDexieTable").dexieAll([d("MAWLoadOneToOneMessageRequestCapabilitiesTxn").loadOneToOneMessageRequestCapabilities([e.jid]),a]).then(function(){return{created:c,thread:e}})}g.getOrSetupOneToOneThread=a;g.getGroupThread=b;g.deleteAllThreadData=j;g.metaSyncChatDeleteThread=e}),98);
__d("MAWThreadFetchAndEmitTxns",["MAWDexieTable","MAWLoadGroupInvitesTxns","MAWLoadOneToOneMessageRequestCapabilitiesTxn","MAWLoadThreadsTxns","MAWThreadManagementTxns","WAJids","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){c===void 0&&(c="getOrCreateThread");return d("WAJids").switchOnMsgrChatJidType(b,{group:function(b){return d("MAWThreadManagementTxns").getGroupThread(a,b,void 0).then(function(a){return a==null?null:{created:a.created,thread:a.thread}})},user:function(b){return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{createTs:void 0,description:c,folder:void 0,userJid:b})}})}function b(a,b,c,e,f){f===void 0&&(f="fetchAndEmitThread");return d("WAJids").switchOnMsgrChatJidType(b,{group:function(b){return d("MAWThreadManagementTxns").getGroupThread(a,b,c).then(function(a){return a==null?null:{created:a.created,thread:a.thread}})},user:function(b){return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{createTs:e==null?void 0:d("WATimeUtils").castUnixTimeToMillisTime(e),description:f,folder:c!=null?c:void 0,userJid:b})}}).then(function(b){return b==null||b.thread==null?null:d("MAWLoadThreadsTxns").loadContentsForThreads(a,[b.thread],1,null,f).then(function(){return b})})}function e(a,b){if(b.size===0)return d("MAWDexieTable").dexieResolve();b=Array.from(b);return a.threads.where("jid").anyOf(b).toArray().then(function(b){b=b.filter(Boolean);return d("MAWDexieTable").dexieAll([d("MAWLoadThreadsTxns").loadGroups(a,b),d("MAWLoadOneToOneMessageRequestCapabilitiesTxn").loadOneToOneMessageRequestCapabilities(b.map(function(a){return a.jid})),d("MAWLoadGroupInvitesTxns").loadGroupInvites(a,b)])}).then(c("emptyFunction"))}g.getOrCreateThread=a;g.fetchAndEmitThread=b;g.emitThreadContents=e}),98);
__d("MAWFetchAndEmitThreadApi",["MAWIndexedDb","MAWThreadFetchAndEmitTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READONLY,groupInfo:a.READWRITE,groupInvites:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READWRITE,poll:a.READONLY,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"fetchAndEmitThread",function(a){return function(b,c){c===void 0&&(c="fetchAndEmitThreadInTxn");return d("MAWThreadFetchAndEmitTxns").fetchAndEmitThread(a,b,void 0,void 0,c)}});g.fetchAndEmitThreadInTxn=b}),98);
__d("MAWGetDownloadableThumbnailForMediaApi",["MAWOptimisticUploadManager","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h;a=async function(a){a=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a);if(a==null)return null;a=a.previewPlaintextHash;if(a==null)return null;a=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a);if(a==null)return null;a=await ((a=a.optimisticUploadPromise)==null?void 0:a.catch(function(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["GetDownloadableThumbnail - previewEntry optimistedPromise rejected with ",""])),a);return d("WAResultOrError").makeError("runtime-error")}));if(a==null||a.success!==!0)return null;a=a.value;var b=a.directPath,c=a.fileEncSha256,e=a.fileSha256,f=a.mediaKey,g=a.mediaKeyTimestamp;a=a.objectId;return{directPath:b,fileEncSha256:c,fileSha256:e,mediaKey:f,mediaKeyTimestamp:g,objectId:a}};g.getDownloadableThumbnailForMedia=a}),98);
__d("MAWGetEditMsgForSending",["FBLogger","MAWAckLevel","MAWAsMessageApplication","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWTransactionMode","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:(a=d("MAWTransactionMode")).READONLY,messages:a.READONLY,reactions:a.READONLY,threads:a.READONLY},"getEditMsgForSending",function(a){return function(b,e){return l(a,b,e).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var e=d("MAWAsMessageApplication").asEditMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("FBLogger")("messenger_web").mustfixThrow("This cannot happen because there are no system edit");return{dbMsg:a,editOriginalExternalId:a.originalMsgExternalId,messageApplication:e,messageType:{isEdit:!0,isRevoked:!1,type:"text"},protocolMsgId:b,type:"unsent"}})}});function l(a,b,c){return d("MAWDbEditMsgHistoryTxns").getEditHistoryMsgByEditedProtocolMsgId(a,b,c).then(function(b){if(b==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get edit history"])));return d("WAResultOrError").makeError("missing_history")}else if(b.sendStatus!=null&&b.sendStatus>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var c=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.originalMsgExternalId);if(c==null){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsgProtocolMsgId"])));return d("WAResultOrError").makeError("missing_msg")}return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,b.threadJid),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)]).then(function(a){var c=a[0];a=a[1];if(!c.success){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get thread (success:",")"])),c.success);return d("WAResultOrError").makeError("missing_thread")}if(a==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsg"])));return d("WAResultOrError").makeError("missing_msg")}return a.ack>d("MAWAckLevel").ACK.clock?d("WAResultOrError").makeError("sent"):d("WAResultOrError").makeResult({msg:b,thread:c.value})})})}g.getEditMsgForSending=b}),98);
__d("MAWGetMediaKnownEntriesApi",["MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","MWFBLogger","WAHashUtils","WAJids","WAMsgMap","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("MWFBLogger").MWMediaLogger().tags(["GetMediaKnownEntries"]);a=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY},"getMediaKnownEntries",function(a){return function(b){return k(a,b)}});function k(a,b){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,b).then(function(c){if(!c){j.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for plaintextHash ",". Returning new MsgMap."])),d("WAHashUtils").sanitisePlaintextHash(b));return d("WAResultOrError").makeError("no-media-entry-by-plaintext-hash")}var e=Array.from(c.mediaEntries.keys());return d("MAWDexieTable").dexieAll(e.map(function(b){return d("MAWDbMsgTxns").maybeGetMsgListByMsgId_I_KNOW_WHAT_I_AM_DOING(a,b)})).then(function(a){a=a.map(function(a){return a.find(function(a){return(a==null?void 0:a.mediaId)===c.mediaId})});var f=[];a=a.reduce(function(a,g,h){if(!g){j.WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Message missing in messages table for given msgId for plaintextHash ",". Skipping..."])),d("WAHashUtils").sanitisePlaintextHash(b));f.push(e[h]);return a}h=c.mediaEntries.get(g.msgId);var k=g.author,l=g.threadJid;h&&!d("WAJids").isAuthorSystem(k)&&l!=null&&a.set({author:k,chat:l,externalId:g.externalId},h);return a},new(d("WAMsgMap").MsgMap)());return{missingMessages:f,msgMap:a,numEntries:e.length}}).then(d("WAResultOrError").makeResult)})}g.getMediaKnownEntries=a;g.getMediaKnownEntriesTxn=k}),98);
__d("MAWGetMediaPlaintextApi",["MAWIndexedDb","MAWMediaUtils","MAWOptimisticUploadManager","MAWTransactionMode","Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a){var c=d("MAWOptimisticUploadManager").getOptimisticUploadManager();c=c.get(a);if(c==null)return j(a);else return(i||(i=b("Promise"))).resolve(c.file)};function j(a){return d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY},"getMediaPlaintextFromDb",function(a){return function(b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return a.chunk.where("hashedPlaintextHash").equals(b).first().then(function(a){if(!a){d("WALogger").WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Media blob does not exist for the given hashedPlaintextHash"])));return null}return new Blob([a.blobData],{type:a.mimetype})})}})(a)}g.getMediaPlaintext=a}),98);
__d("MAWMediaType",["WAServerMediaType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case"XMA":return"xma-image";case"EphemeralScreenshotAction":case"Raven":case"RavenAction":case"EditAction":case"NoteReply":case"BumpExistingMessage":return null;default:return d("WAServerMediaType").getMediaType(a)}}g.getMediaType=a}),98);
__d("MAWSendMsgUtil",["MAWMediaType","WAArmadilloApplication.pb","WAConsumerApplication.pb","WAMsgType","decodeProtobuf","getMediaTypeFromConsumerMessage","qex"],(function(a,b,c,d,e,f,g){"use strict";({});function h(a){var b=d("MAWMediaType").getMediaType(a),c=a===d("WAMsgType").MSG_TYPE.REVOKED;if(b!=null)return{mediaType:b,type:"media"};else if(a===d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION)return{isInvisible:!0,isRevoked:!1,type:"text"};else return{isRevoked:c,type:"text"}}function a(a){var b=d("MAWMediaType").getMediaType(a);if(b!=null)return{mediaType:b,type:"media"};switch(a){case"XMA":case"Raven":case"RavenAction":case"EphemeralScreenshotAction":case"EditAction":case"BumpExistingMessage":return{isRevoked:!1,type:"text"};default:return h(a)}}function b(a){var b;b=(b=a.payload)==null||(b=b.subProtocol)==null?void 0:b.consumerMessage;a=(a=a.payload)==null||(a=a.subProtocol)==null?void 0:a.armadillo;if(b!=null){var e;b=d("decodeProtobuf").decodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,b.payload);if(b!=null&&(e=b.payload)!=null&&(e=e.applicationData)!=null&&e.revoke)return{isRevoked:!0,type:"text"};b=d("getMediaTypeFromConsumerMessage").getMediaTypeFromConsumerMessage(b);if(b!=null)return{mediaType:b,type:"media"}}if(a!=null&&c("qex")._("310")===!0){b=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,a.payload);a=d("getMediaTypeFromConsumerMessage").getMediaTypeFromConsumerMessage(b);if(a!=null)return{mediaType:a,type:"media"}}return{isRevoked:!1,type:"text"}}g.waGetMessageTypeFromMsg=h;g.getMessageTypeFromMsg=a;g.getMessageTypeFromMessageApplication=b}),98);
__d("MAWGetMsgForSendingApi",["FBLogger","MAWAckLevel","MAWAsMessageApplication","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWSendMsgUtil","MAWTransactionMode","MAWXMAUtils","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l;b=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY,xma:a.READONLY},"getMsgForSending",function(a){return function(b){return m(a,b).then(function(a){if(!a.success){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Error: ",""])),b,a.error);return{type:a.error}}a=a.value;var e=a.groupInvite,f=a.isReplyMsg,g=a.media,k=a.msg;a=a.xmaPayload;if(!d("MAWDbMsg").NO_CONTENT_MESSAGE_TYPES_ALLOWLIST.includes(k.type)&&!d("MAWDbMsg").isContentMsg(k)){d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Unrecognized type ",""])),b,k.type);throw c("FBLogger")("messenger_web").mustfixThrow("We do not support message sending with "+k.type+" type")}var l=d("MAWAsMessageApplication").asMessageApplication(k,g,e,a,k.threadJid),m=null;k.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE&&e?m={invitedParticipantUserJid:e.inviteeJid,isRevoked:!1,type:"text"}:m=d("MAWSendMsgUtil").getMessageTypeFromMsg(k.type);if(d("WAJids").isAuthorSystem(k.author))throw c("FBLogger")("messenger_web").mustfixThrow("A system message cannot be sent");d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Done"])),b);return{dbMsg:k,isReplyMsg:f,isXMAMsg:a!=null,media:g,messageApplication:l,messageType:m,protocolMsgId:{author:k.author,chat:k.threadJid,externalId:a!=null&&a.associatedMessage!=null?a.associatedMessage.externalId:k.externalId},type:"unsent",xmaPayload:a}})}});function m(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(c){var e=c[0];c=c[1];var f=c.value,g=e||f;if(g==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get message"])));return d("WAResultOrError").makeError("missing_msg")}else if(g.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var h=d("MAWXMAUtils").maybeXMAMessage(e),i=g.quote!=null;return d("MAWDexieTable").dexieAll([e?d("MAWDbMediaTxns").getAndCheckMediaFromMsg(a,e):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()),c.success?d("MAWDbGroupInviteTxns").getAndCheckGroupInviteFromMsg(a,c.value):d("MAWDexieTable").dexieResolve(),h?d("MAWDbXMATxns").maybeGetXMAPayloadFromProtocolMsgId(a,b):null]).then(function(a){var b=a[0],c=a[1];a=a[2];if(!b.success)return b;if(a!=null&&!a.success){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get XMA: isXma: ",", type: "," "])),h,g.type);return d("WAResultOrError").makeError("missing_xma")}b=b.value;return d("WAResultOrError").makeResult({groupInvite:c,isReplyMsg:i,media:b,msg:g,xmaPayload:a!=null?a.value:null})})})}g.getMsgForSending=b}),98);
__d("MAWGetMsgIdByProtocolMsgId",["MAWDbMsgTxns","MAWDbReactionsTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWTransactionMode","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({messages:(a=d("MAWTransactionMode")).READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getMsgIdByProtocolMsgId",function(a){return function(b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgResultByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(a){var b=a[0],c=a[1];a=a[2];if(b.success)return d("WAResultOrError").makeResult(b.value.msgId);else if(c!=null)return d("WAResultOrError").makeResult(c.reactionId);else if(a.success&&a.value.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return d("WAResultOrError").makeResult(a.value.msgId);var e="missing_msg_in_db";b=b.error;a=a.error;b==="missing_msg"&&c==null&&a==="missing_unrendered_msg"?e="missing_all_db_msg":b==="missing_thread_msg"&&a==="missing_thread_unrendered_msg"?e="missing_all_thread":(b==="missing_thread_msg"||a==="missing_thread_unrendered_msg")&&(e=b+"__"+(a!=null?a:"unrenderedMsgResultNoError"));return d("WAResultOrError").makeError(e)})}});g.getMsgIdByProtocolMsgId=b}),98);
__d("MAWGetNoteReplyMsgForSendingApi",["MAWAckLevel","MAWAsMessageApplication","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWSendMsgUtil","MAWTransactionMode","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b)]).then(function(a){a=a[0];a=a;if(a==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get message"])));return d("WAResultOrError").makeError("missing_msg")}else if(a.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");return d("WAResultOrError").makeResult({msg:a})})}b=d("MAWIndexedDb").makeMsgrTransactor({media:(a=d("MAWTransactionMode")).READONLY,messages:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getNoteReplyForSending",function(a){return function(b){return i(a,b).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var b=d("MAWAsMessageApplication").asNoteReplyMessageApplication(a),e=d("MAWSendMsgUtil").getMessageTypeFromMsg(a.type);if(d("WAJids").isAuthorSystem(a.author))throw c("err")("A system message cannot be sent");return{dbMsg:a,messageApplication:b,messageType:e,protocolMsgId:{author:a.author,chat:a.threadJid,externalId:a.externalId},type:"unsent"}})}});g.getNoteReplyForSending=b}),98);
__d("MAWGetOrCreateMediaKnownEntriesApi",["MAWGetMediaKnownEntriesApi","MAWIndexedDb","MAWTransactionMode","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY},"getOrCreateMediaKnownEntries",function(a){return function(b){return d("MAWGetMediaKnownEntriesApi").getMediaKnownEntriesTxn(a,b).then(function(a){if(a.success===!1)return new(d("WAMsgMap").MsgMap)();else return a.value.msgMap})}});g.getOrCreateMediaKnownEntries=a}),98);
__d("getProtocolMsgIdByMsgIdCommon",["MAWDexieTable","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWDexieTable").dexieAll([a.messages.get({msgId:b}),a.unrenderedMessages.get({msgId:b}),a.reactions.get({reactionId:b})]).then(function(b){var c=b[0],e=b[1];b=b[2];if(b!=null)if(d("WAJids").isAuthorSystem(b.author))return null;else return{author:b.author,chat:b.threadJid,externalId:b.externalId};var f=c||e;return f==null?null:a.threads.get({jid:f.threadJid}).then(function(a){if(a==null)return null;return d("WAJids").isAuthorSystem(f.author)?null:{author:f.author,chat:a.jid,externalId:f.externalId}})})}g.getProtocolMsgIdByMsgIdCommon=a}),98);
__d("MAWGetProtocolMsgIdByMsgId",["MAWIndexedDb","MAWTransactionMode","getProtocolMsgIdByMsgIdCommon"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({messages:(a=d("MAWTransactionMode")).READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getProtocolMsgByMsgId",function(a){return function(b){return d("getProtocolMsgIdByMsgIdCommon").getProtocolMsgIdByMsgIdCommon(a,b)}});g.getProtocolMsgIdByMsgId=b}),98);
__d("MAWGetReactionForSending",["FBLogger","MAWAckLevel","MAWAsMessageApplication","MAWDbReactionsTxns","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WAJids","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b).then(function(b){if(b==null)return d("WAResultOrError").makeError("missing");else if(b.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");return d("MAWDbThreadTxns").getThread(a,b.threadJid).then(function(a){return!a.success?d("WAResultOrError").makeError(a.error):d("WAResultOrError").makeResult({msg:b})})})}a=d("MAWIndexedDb").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getReactionForSending",function(a){return function(b){return h(a,b).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var b=d("MAWAsMessageApplication").asReactionMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("FBLogger")("messenger_web").mustfixThrow("This cannot happen because there are no system reactions");return{chat:a.threadJid,dbMsg:a,externalId:a.externalId,messageApplication:b,messageType:{isInvisible:!0,type:"reaction"},protocolMsgId:{author:a.author,chat:a.threadJid,externalId:a.externalId},type:"unsent"}})}});g.getReactionForSending=a}),98);
__d("isUseridAnnotationEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("24163")}g["default"]=a}),98);
__d("MAWUserHash",["MAWCurrentUser","WAGlobals","WAJids","isUseridAnnotationEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("MAWCurrentUser").isEmployee()&&c("isUseridAnnotationEnabled")()?d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()).slice(-5):null}g.getUserHash=a}),98);
__d("MAWIncomingMsg",["MAWUserHash","MWFBLogger","WAGetPlatformFromStanzaId","WAHashStringToNumber","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWFBLogger").MWLogger().tags(["ServerRPC","HandleIncomingMsg"]);b=function(a){var b=a.encTypes,c=a.incomingType,e=a.msg,f=a.queueType,g=a.retryCount;a=a.taskSource;var h=e.details;e=e.decrypted;return{"int":{messageAge:d("WATimeUtils").unixTime()-h.ts,msgId:d("WAHashStringToNumber").hashStringToNumber(h.externalId.toString()),offlineDelivery:h.offline,retryCount:g,taskSource:a},string:{e2eePlatform:d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(h.externalId),incomingType:c,jid:h.from.chat,msgDecryptedDataType:e.type,msgType:h.type,queueType:f,threadType:h.from.type,userHash:d("MAWUserHash").getUserHash()},string_array:{encTypes:b}}};g.logger=a;g.prepareAnnotationsForIncomingMessage=b}),98);
__d("MAWIsQuotaExceededError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){return a.name==="QuotaExceededError"||a.inner&&a.inner.name==="QuotaExceededError"};f.isQuotaExceededError=a}),66);
__d("MAWLoadThreadParticipantsApi",["MAWDbParticipantTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"loadThreadParticipants",function(a){return function(b){return a.threads.get({jid:b}).then(function(b){if(b==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["MAWLoadThreadParticipantsApi -- loadThreadParticipants -- there is no thread in db"])));return[]}return d("MAWDbParticipantTxns").getParticipantsInThread(a,b.jid).then(function(a){return a.map(function(a){return a.userJid})})})}});g.loadThreadParticipants=a}),98);
__d("MAWShadowTestMediaStorage",["MAWBridge","MAWQplProxy","MWFBLogger","Random","WAErrorMessage","WAGlobals","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("MWFBLogger").MWMediaLogger().tags(["MediaStorageShadowTest"]),l=["webcache","opfs"],m=9e4;async function a(a){var b;k.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["runMediaStorageShadowTesting started"])));var e=((b=navigator.storage)==null?void 0:b.estimate)!=null?await navigator.storage.estimate():null;b=function(b){var f,g=d("Random").uint32(),h=d("MAWQplProxy").startQplUserFlow(c("qpl")._(521472095,"2859"),{int:{input_file_size:a.byteLength},string:{device_id:c("gkx")("17007")?d("WAGlobals").getMyDeviceJid():null,storage_type:b}},{providedInstanceKey:g,providedTimeoutInMs:m}),l=(g=e==null||(f=e.usageDetails)==null?void 0:f.fileSystem)!=null?g:null;return d("MAWBridge").getBridge().sendAndReceive("event","getMediaStorageResult",{file_bytes:a,storage_type:b},!0,void 0,{toLastActiveClient:!0}).then(function(a){if(a.success){var c;k.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["runMediaStorageShadowTesting succeeded for "," storage type"])),b);c=(c=navigator.storage)!=null&&c.estimate?navigator.storage.estimate():Promise.resolve();return c.then(function(b){if((b==null?void 0:b.usageDetails)!=null){var c;b=b.usageDetails;c=(c=b.fileSystem)!=null?c:null;var d=l!=null&&c!=null?c-l:null;h.addAnnotations({int:{cache_usage:b.caches,opfs_usage:c,opfs_usage_delta:d,opfs_usage_initial:l}})}h.endSuccess({double:{cleanup_latency:a.value.latency.cleanupLatency,read_latency:a.value.latency.readLatency,setup_latency:a.value.latency.setupLatency,write_latency:a.value.latency.writeLatency},int:{num_files:a.value.metadata.numFiles,worker_byte_length:a.value.metadata.byteLength}})})}else{h.addAnnotations({string:{error_name:a.error.errorName,fail_error_message:(c=a.error.errorMessage)!=null?c:"unknown"}});h.endFail("shadow_test_fail")}}).catch(function(a){k.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["runMediaStorageShadowTesting failed: ",""])),a),h.endFail("shadow_test_bridge_fail",{string:{error_message:d("WAErrorMessage").maybeGetMessageFromError(a)}})})};for(var f of l)await b(f)}g.runMediaStorageShadowTesting=a}),98);
__d("MAWXMAManagementTxns",["FBLogger","MAWDexieTable","MAWMediaManagementTxns","MAWXMAUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g){var i=b.unstoredDbXMA,j=b.unstoredFavicon,k=b.unstoredHeaderMedia,l=b.unstoredPreviews;f===void 0&&(f=!1);g===void 0&&(g="wa-incoming");var m=new Map(),n=function(b){return b!=null?d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,b,c,g,!0).then(function(a){return[b.plaintextHash,a]}):d("MAWDexieTable").dexieResolve([void 0,void 0])};f||(m.set(j==null?void 0:j.plaintextHash,n(j)).set(k==null?void 0:k.plaintextHash,n(k)),l==null||l.forEach(function(a){m.set(a==null?void 0:a.plaintextHash,n(a))}));b=Array.from(m.values());return d("MAWDexieTable").dexieAll(b).then(function(b){var g=new Map(b),m=(l!=null?l:[]).map(function(a){return g.get(a.plaintextHash)}).filter(Boolean);return h(a,f?d("MAWXMAUtils").buildUnstoredTombstonedXMA(i):i,g.get(j==null?void 0:j.plaintextHash),g.get(k==null?void 0:k.plaintextHash),m,c,e).then(function(a){return{dbMedias:b.map(function(a){a[0];a=a[1];return a}).filter(Boolean),dbXMA:a,firstPreview:m[0]}})})}function h(a,b,d,e,f,g,h){b=babelHelpers["extends"]({},b,{associatedMessageId:h!=null?h:void 0,defaultPreviewMediaId:(b=f[0])==null?void 0:b.mediaId,defaultPreviewMediaPlaintextHash:(h=f[0])==null?void 0:h.plaintextHash,faviconMediaId:d==null?void 0:d.mediaId,faviconPlaintextHash:d==null?void 0:d.plaintextHash,headerMediaId:e==null?void 0:e.mediaId,headerMediaPlaintextHash:e==null?void 0:e.plaintextHash,msgId:g.msgId,previewMediaIds:f.map(function(a){return a.mediaId})});return a.xma.add(b).then(function(b){return a.xma.get(b)}).then(function(a){if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("Failed to write XMA to db");return a})}function b(a,b,c,e,f,g,h,i,j,k,l,m,n){var o=d("MAWXMAUtils").isXMAExpired(!1,j.targetExpiringAtSec);j=babelHelpers["extends"]({},j,{associatedMessageId:h!=null?h:void 0,author:i.author,externalId:i.externalId,isTombstoned:o,msgId:g,offlineAttachmentId:k,targetType:f,threadJid:i.chat});var p=o?j:babelHelpers["extends"]({},j,{defaultPreviewMediaId:b!=null?b:void 0,defaultPreviewMediaPlaintextHash:l!=null?l:void 0,faviconMediaId:e!=null?e:void 0,faviconPlaintextHash:n!=null?n:void 0,headerMediaId:c!=null?c:void 0,headerMediaPlaintextHash:m!=null?m:void 0,previewMediaIds:b!=null?[b]:[]});return a.xma.add(p).then(function(a){return babelHelpers["extends"]({},p,{xmaId:a})})}g.handleUnstoredXMAContent=a;g.saveXMA=b}),98);
__d("MAWSharedCOPLogger",["MWFBLogger"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWFBLogger").MWLogger().tags(["COP"]);g["default"]=a}),98);
__d("MAWMessageReceiveReliabilityLogger",["WAHashStringToNumber","WAQPLProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(1056840931,"814"),i=c("qpl")._(521477947,"2395"),j=60*1e3;function a(a){return d("WAQPLProxy").waQPLProxyStart(a.incomingType==="ebrestore"?i:h,{"int":{msgId:d("WAHashStringToNumber").hashStringToNumber(a.stanzaId)},string:{incomingType:a.incomingType,jid:a.jid,msgType:a.type}},d("WAHashStringToNumber").hashStringToNumber(a.stanzaId),j)}b=5*60*1e3;g.logRRStartForMessage=a;g.RECEIVE_RELIABILITY_TIMEOUT=b}),98);
__d("MAWMarkMsgDroppedApi",["MAWAckLevel","MAWDbMsgTxns","MAWDbReactionsTxns","MAWDexieTable","MAWIndexedDb","MAWQplProxy","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READWRITE,reactions:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"markMsgDropped",function(a){return function(b,c,e){e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(e.qplEventType,"mark_msg_dropped_msg_and_reaction_fetch_start",{instanceKey:e.qplInstanceKey});return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b)]).then(function(b){var f=b[0];b=b[1];e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(e.qplEventType,"mark_msg_dropped_msg_and_reaction_fetch_end",{instanceKey:e.qplInstanceKey});if(f!=null){var g=(c==null?void 0:c.isRetriable)===!0?d("MAWAckLevel").ACK.failedRetryable:d("MAWAckLevel").ACK.expired;e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(e.qplEventType,"mark_msg_dropped_update_system_ack_start",{annotations:{"int":{ack:g}},instanceKey:e.qplInstanceKey});return d("MAWDbMsgTxns").updateSystemAck(a,f.msgId,g,void 0,void 0,void 0).then(function(a){e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(e.qplEventType,"mark_msg_dropped_update_system_ack_end",{instanceKey:e.qplInstanceKey});return a==null?"missing":a.ack<=d("MAWAckLevel").ACK.clock?"dropped":"sent"})}if(b!=null){e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(e.qplEventType,"mark_msg_dropped_update_delete_reaction_start",{instanceKey:e.qplInstanceKey});return d("MAWDbReactionsTxns").deleteReaction(a,b).then(function(){e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(e.qplEventType,"mark_msg_dropped_update_delete_reaction_end",{instanceKey:e.qplInstanceKey});return"dropped"})}e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(e.qplEventType,"mark_msg_dropped_msg_and_reaction_missing",{instanceKey:e.qplInstanceKey});return"missing"})}});g.markMsgDropped=b}),98);
__d("MAWMessageSendScheduler",["WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";var h=24e4,i;function a(){i==null&&(i=d("WorkerScheduler").makeScheduler("message-send",{concurrency:5,defaultSamplingRate:500,maxConcurrency:5,maxThrottleMs:500,timeToStuckMs:h}));return i}g.messageSendScheduler=a}),98);
__d("MAWMessageSendsCommon",["MAWMarkMsgDroppedApi","MAWMessageSendScheduler","MAWQplProxy","MWFBLogger","WAGetSafeQPLError","WAPromiseDelays","WAResultOrError","WATimeUtils","WAWaitForComms","WorkerScheduler","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=1e3,k=d("MWFBLogger").MWLogger().tags(["MessageSend"]);function l(){if(!c("justknobx")._("4635"))return{activeTasks:[],pendingTasks:[]};var a=d("MAWMessageSendScheduler").messageSendScheduler().getDebugState();return{activeTasks:a.activeTasks.map(function(a){return"executionTimeMs"+a.executionTimeMs+" priority: "+a.priority+" name: "+a.task+" waitTimeMs:"+a.waitTimeMs}),pendingTasks:a.pendingTasksByPriority.map(function(a){return a.map(function(a){return"name: "+a.task+" waitTimeMs:"+a.waitTimeMs})}).flat()}}async function m(a,b,e,f,g){d("MAWQplProxy").sendQplPointThroughBridge(a,"backend_reached",{annotations:{bool:{backendSetupReadyFromWorker:!d("WAWaitForComms").isStillWaitingForComms()}},instanceKey:b});var n;try{d("MAWQplProxy").sendQplPointThroughBridge(a,"wait_for_comms_start",{annotations:{},instanceKey:b});await d("WAWaitForComms").waitForComms();d("MAWQplProxy").sendQplPointThroughBridge(a,"wait_for_comms_end",{annotations:{},instanceKey:b});var o=l(),p=o.activeTasks;o=o.pendingTasks;d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_start",{annotations:c("justknobx")._("4635")?{string_array:{activeTasksBeforeSchedule:p,pendingTasksByPriorityBeforeSchedule:o}}:{},instanceKey:b});n=await d("MAWMessageSendScheduler").messageSendScheduler().runTask({customFlags:{runtimeReliability:!0},fn:function(){return e(d("WATimeUtils").unixTime())},name:f,priority:d("WorkerScheduler").BLOCKING_PRIORITY});if(n.success===!0)d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_end",{instanceKey:b});else{var q;p=l();o=p.activeTasks;p=p.pendingTasks;d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{annotations:{string:{errorType:(q=(q=n.error)==null?void 0:q.type)!=null?q:"unknown-error"},string_array:c("justknobx")._("4635")?{activeTasksBeforeSchedule:o,pendingTasksByPriorityBeforeSchedule:p}:{}},instanceKey:b})}}catch(e){q=l();o=q.activeTasks;p=q.pendingTasks;k.catching(e).MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Message send fail. Error: ",""])),d("WAGetSafeQPLError").getSafeQPLErrorMessage(e));d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{annotations:{string:{errorDescription:d("WAGetSafeQPLError").getSafeQPLErrorMessage(e),errorType:"runtime-error",sendFailureError:d("WAGetSafeQPLError").getSafeQPLErrorMessage(e)},string_array:c("justknobx")._("4635")?{activeTasksBeforeSchedule:o,pendingTasksByPriorityBeforeSchedule:p}:{}},instanceKey:b});g!=null&&await d("MAWMarkMsgDroppedApi").markMsgDropped(g,void 0,{qplEventType:a,qplInstanceKey:b});throw e}if(!n){q="null-response-from-message-send";k.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Guard: should not happen, result is null"])));d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{instanceKey:b});return d("WAResultOrError").makeError({applicationErrorCode:null,details:q,isRetriable:!0,type:"unexpected-message-codepath"})}if(n.success===!0)return n;n.success;g!=null&&await d("MAWMarkMsgDroppedApi").markMsgDropped(g,n.error,{qplEventType:a,qplInstanceKey:b});if(((o=n.error)==null?void 0:o.type)==="retryable-error"){q=(p=n.error.backoff)!=null?p:j;await d("WAPromiseDelays").delayMs(q);return m(a,b,e,f,g)}else return n}g.messageSendLogger=k;g.messageSendObserver=m}),98);
__d("MAWMarkEditMsgDroppedApi",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWTransactionMode","WAGlobals","WAJids","WALogger","WAMsgType","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o;a=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"markEditMsgDropped",function(a){return function(b,e){var f=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(f==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalProtocolMsgId is null"])));return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([a.threads.get({jid:b.chat}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,f)]).then(function(f){var g=f[0],h=f[1],p=f[2];f=p.sort(function(a,b){return b.editTs-a.editTs});var q=p.find(function(a){return a.editExternalId===b.externalId}),r=f[1];if(h==null){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is null"])));return d("WAResultOrError").makeError("missing_original_msg")}if(q==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is null"])));return d("WAResultOrError").makeError("missing_newest_edited_msg")}if(r==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] previousEditedMsg is null"])));return d("WAResultOrError").makeError("missing_previous_edited_msg")}if(q.editExternalId!==f[0].editExternalId){d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is not the newest edit"])));return d("WAResultOrError").makeError("invalid_newest_edited_msg")}if(g==null){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] thread is null"])));return d("WAResultOrError").makeError("missing_thread")}if(h.type!==d("WAMsgType").MSG_TYPE.TEXT){d("WALogger").ERROR(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is not a text message"])));return d("WAResultOrError").makeError("invalid_original_msg")}return a.messages.where("quoteExternalId").equals(e).toArray().then(function(e){var f,g=babelHelpers["extends"]({},h,{ack:d("MAWAckLevel").ACK.sent,editCount:((f=h.editCount)!=null?f:0)-1,msgContent:r.msgContent}),i=d("WAGlobals").getMyUserJid(),j=[];f=e.find(function(a){var c;return(((c=a.quote)==null?void 0:c.content.author)===d("WAJids").AUTHOR_ME||((c=a.quote)==null?void 0:c.content.author)===i)&&a.threadJid===b.chat});if(f!=null){e=f.quote;var k=f.quoteExternalId;if(e==null)c("FBLogger")("messenger_web").warn("[markEditMsgDropped] Failed to get the quoted content for a msg that has been quoted.",k);else{k=babelHelpers["extends"]({},f,{quote:babelHelpers["extends"]({},e,{content:babelHelpers["extends"]({},e.content,{msgContent:babelHelpers["extends"]({},g.msgContent)})})});j.push(k)}}f=[];h.editCount===1&&p.length===2&&f.push(r.editMsgHistoryId);f.push(q.editMsgHistoryId);return d("MAWDexieTable").dexieAll([a.messages.put(g),a.editMsgHistory.bulkDelete(f)]).then(function(){d("WALogger").LOG(o||(o=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] editMsgHistory updated"])));d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(g)});j.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})});return d("WAResultOrError").makeResult()})})})}});g.markEditMsgDropped=a}),98);
__d("MAWMarkEditMsgSentApi",["ArmadilloDataTraceType","MAWAckLevel","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTraceEvent","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWFTSTxns","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWTransactionMode","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n;b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READWRITE,ftsBackloggedMessages:a.READWRITE,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,xma:a.READONLY},"markEditMsgSent",function(a){return function(b,e,f,g){var o=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(o==null){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalProtocolMsgId is null"])));return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,o),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,o),d("MAWFTSTxns").maybePutMessageToBacklog(a,e)]).then(function(h){var o=h[0];h=h[1];var p=h.find(function(a){return a.editExternalId===e}),q=h.find(function(a){return a.editExternalId===b.externalId});if(o==null){d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsg is null"])));return d("WAResultOrError").makeError("missing_original_msg")}if(p==null){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsgHistory is null"])));return d("WAResultOrError").makeError("missing_original_msg_edit_history")}if((q==null?void 0:q.editExternalId)==null){d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editedMsg?.editExternalId is null"])));return d("WAResultOrError").makeError("missing_edit_external_id")}if(q.sendStatus!=null&&q.sendStatus>d("MAWAckLevel").ACK.clock&&o.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory has already been sent"])));return d("WAResultOrError").makeError("already_sent")}if(q.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] on incoming message"])));return d("WAResultOrError").makeError("not_author")}d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([q.editExternalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});var r=[];if(h.length===2&&o.editCount===1){h=babelHelpers["extends"]({},p,{sendStatus:d("MAWAckLevel").ACK.sent});r.push(h)}p=babelHelpers["extends"]({},q,{editTs:f,sendStatus:d("MAWAckLevel").ACK.sent});r.push(p);var s=babelHelpers["extends"]({},o,{ack:d("MAWAckLevel").ACK.sent});g!=null&&(s.reportingMeta=g);return d("MAWDexieTable").dexieAll([a.editMsgHistory.bulkPut(r),a.messages.put(s),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,s)]).then(function(a){a[0];a=a[2];d("WALogger").LOG(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory updated"])));d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(s,a)});return d("WAResultOrError").makeResult()})})}});g.markEditMsgSent=b}),98);
__d("MAWMarkMsgSentApi",["ArmadilloDataTraceType","MAWAckLevel","MAWBridgeTrace","MAWBridgeTraceEvent","MAWDbMsgTxns","MAWDbThread","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWEphemeralMsgTxns","MAWEphemeralSettingsTxns","MAWIndexedDb","MAWMsgType","MAWTransactionMode","MAWUpdateThreadActivity","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"markMsgSent",function(a){return function(b,e,f){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(g){var k=g[0];g=g[1];if(k==null&&!g.success){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Msg missing from DB"])));return}else if(k!=null){d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([k.externalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});g.success&&d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Found both regular and unrendered message with the same protocol msg ID"])));var l=k.ack<d("MAWAckLevel").ACK.sent;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").updateSystemAck(a,k.msgId,d("MAWAckLevel").ACK.sent,e,f),d("MAWDbThreadTxns").getThread(a,k.threadJid)]).then(function(b){var c=b[0];b=b[1];if(!b.success){d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Thread missing from DB"])));return}var f=b.value;b=d("WATimeUtils").castUnixTimeToMillisTime(e);b=babelHelpers["extends"]({},f,{lastReadMsgTs:b,newestMsgTs:b,threadOrder:d("MAWDbThread").craftThreadOrder(b,f.jid)});b=l?d("MAWDbThreadTxns").updateThread(a,b):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWEphemeralMsgTxns").markEphemeralMessageAsSent(a,c),b]).then(function(){if(c!=null)return d("MAWUpdateThreadActivity").updateThreadActivityFromInsertionTxn(a,c,f.jid,"outgoing_msg")})})}else if(g.success){var m=g.value;return d("MAWDbUnrenderedMsgTxns").updateSystemAckForUnrenderedMsg(a,m.msgId,d("MAWAckLevel").ACK.sent).then(function(){if(m.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE)return d("MAWEphemeralSettingsTxns").updateContactWhenEphemeralSettingChangeMarkedSent(a,b.chat,e)})}})}});g.markMsgSent=b}),98);
__d("MAWSendWrittenMsg",["EBAPI","EBLogger","MAWBridge","MAWDebugMsg","MAWGetEditMsgForSending","MAWGetMsgForSendingApi","MAWGetNoteReplyMsgForSendingApi","MAWGetReactionForSending","MAWJids","MAWLoadThreadParticipantsApi","MAWMarkEditMsgDroppedApi","MAWMarkEditMsgSentApi","MAWMarkMsgDroppedApi","MAWMarkMsgSentApi","MAWMessageSendsCommon","MAWMpsGating","MAWODSProxy","MAWSendMsgUtil","MpsTypes","WAAPI","WAAsMessageApplication","WABuildMpsPayload","WAFrankingTypes","WAGetSafeQPLError","WAGlobals","WAMsgApplication.pb","WAOdsEnums","WAResultOrError","WebMps","encodeProtobuf","err","getErrorSafe","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;async function l(a,b,e){d("MAWMessageSendsCommon").messageSendLogger.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg ",""])),String(a.protocolMsgId));b.addPoint("get_msg_for_sending_start",{string:{type:a.type}});var f,g,l,m,n=null,o;if(e==null){if(a.type==="message"||a.type==="revoke"||a.type==="bump")n=await d("MAWGetMsgForSendingApi").getMsgForSending(a.protocolMsgId);else if(a.type==="reaction")n=await d("MAWGetReactionForSending").getReactionForSending(a.protocolMsgId);else if(a.type==="edit")n=await d("MAWGetEditMsgForSending").getEditMsgForSending(a.protocolMsgId,a.referencedOriginalExternalId);else if(a.type==="noteReply")n=await d("MAWGetNoteReplyMsgForSendingApi").getNoteReplyForSending(a.protocolMsgId);else{a.type;throw c("err")("This cannot happen because type has `message` as default argument but flow does not know that")}if(n.type!=="unsent"){d("MAWMessageSendsCommon").messageSendLogger.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg not sending message: ",""])),n.type);return d("WAResultOrError").makeError({details:n.type,isRetriable:!0,type:"wrong-message-state"})}var p=n,q=p.dbMsg,r=p.isReplyMsg;p=p.isXMAMsg;o=n.protocolMsgId;f=n.messageApplication;l=n.messageType;g=q==null?void 0:q.type;m=n.editOriginalExternalId;q=(q==null?void 0:q.ephemeralSetting)!=null&&((q=(q=q.ephemeralSetting)==null?void 0:q.ephemeralExpirationInSec)!=null?q:0)>0;b.addPoint("get_msg_for_sending_end",{bool:{isEditMsg:m!=null,isEphemeralMsg:q,isReplyMsg:r,isXMAMsg:p},string:{msgType:l.type}});q&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_OLD_MESSAGE_SEND,key:"sendEphemeralMsg"},!0)}else f=e.messageApplication,l=d("MAWSendMsgUtil").getMessageTypeFromMessageApplication(f),m=null,o=a.protocolMsgId;r=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,f).readBuffer();p={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(new Uint8Array(r)),version:"v3"};b.addPoint("wa_send_msg_start");q=await c("WAAPI").sendChatMessage({loadThreadParticipants:d("MAWLoadThreadParticipantsApi").loadThreadParticipants,messagePayload:{backupDirective:null,frankingKey:(q=f.metadata)!=null&&q.frankingKey?d("WAFrankingTypes").castToFrankingKey(new Uint8Array((e=f.metadata)==null?void 0:e.frankingKey)):null,frankingVersion:(a=f.metadata)==null?void 0:a.frankingVersion,messageBytes:p,messageType:l,protocolMsgId:o}},b);if(q.success===!1){b.addPoint("wa_send_msg_fail",{string:{errorType:q.error.type,msgType:g}});m!=null?await d("MAWMarkEditMsgDroppedApi").markEditMsgDropped(o,m):await d("MAWMarkMsgDroppedApi").markMsgDropped(o,q.error);d("MAWMessageSendsCommon").messageSendLogger.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg END "," : ",""])),q.error.type,String((e=q.payload)!=null?e:""));switch(q.error.type){case"non-retryable-error":if(q.error.applicationErrorCode!=null&&q.error.applicationErrorCode===10009)try{d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"RefreshContact",value:d("MAWJids").convertChatJidToIntJid(o.chat)}]})}catch(b){a=c("getErrorSafe")(b);d("EBLogger").EBLogger().catching(a).mustfix("Failed to call bridge handler RefreshContact for JID %s and mediaType %s",o.chat,g)}return q;case"missing-receipt":case"wrong-message-state":case"unexpected-message-codepath":case"result-parsing-error":case"retryable-error":case"no-recipients":case"encryption-error":case"too-many-retries":return q;default:q.error.type;throw c("err")("Unreachable code")}}q.success;b.addPoint("wa_send_msg_end");(l=q.value.meta)!=null&&l.pOrDhashMismatch&&(b.addPoint("dhash_phash_mismatch"),c("promiseDone")(d("MAWDebugMsg").writeDebugMsg(o.chat,"Outgoing msg "+o.externalId+" got a phash mismatch")));n!=null&&(b.addPoint("mark_edit_msg_sent_start"),m!=null?await d("MAWMarkEditMsgSentApi").markEditMsgSent(o,m,q.value.serverTs,q.value.reportingMeta):await d("MAWMarkMsgSentApi").markMsgSent(o,q.value.serverTs,q.value.reportingMeta),b.addPoint("mark_edit_msg_sent_end"));try{await d("WebMps").mps().saveNewMessages([{directive:null,insertionSource:d("MpsTypes").InsertionSource.Send,message:d("WABuildMpsPayload").buildMpsMessage({encryptedTransportMessage:r},{externalId:o.externalId,frankingTag:(e=q.value.reportingMeta)==null?void 0:e.frankingTag,reportingTag:(a=q.value.reportingMeta)==null?void 0:a.reportingTag,senderJid:d("WAGlobals").getMyUserJid(),serverTs:q.value.serverTs,threadId:o.chat})}],{source:"wa-message-sent"})}catch(a){d("MAWMessageSendsCommon").messageSendLogger.MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Failed to save message to MPS: ",""])),d("WAGetSafeQPLError").getSafeQPLErrorMessage(a))}if(n!=null&&!d("MAWMpsGating").isEbUploadViaMpsEnabled()){b.addPoint("eb_upload_scheduling_start");l=n;m=l.dbMsg;r=l.isXMAMsg;e=l.media;a=l.xmaPayload;await c("EBAPI").uploadSentMessage({dbMsg:m,instanceKey:o.externalId,isXMAMsg:r,media:e,messageApplication:f,messageApplicationBytes:p.bytes,protocolMsgId:o,serverTs:q.value.serverTs,xmaPayload:a});b.addPoint("eb_upload_scheduling_end")}return q}function a(a,b,c,d){b.addAnnotations({bool:{is_secure:!0},string:{description:c,jid:a.protocolMsgId.chat}});return l(a,b,d)}g.sendWrittenMsgExternal=a}),98);
__d("MAWWriteOutgoingMsgApi",["MAWAckLevel","MAWBuildNewMsgPayload","MAWDbMsg","MAWDbMsgTxns","MAWDbRavenActionTxns","MAWDexieTable","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWMsgType","MAWQplProxy","MAWTransactionMode","MAWVault","MAWWriteMsgTxns","WAJids","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b,c,e){b!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c,a,{annotations:e,instanceKey:b})};b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"writeOutgoingMsg",function(a){return function(b,c,d,e,f,g,h){return i(a,b,c,d,e,f,g,h)}});function i(a,b,c,e,f,g,i,l){f.content!=null&&(f.content=d("MAWVault").vault(f.content));h("write_outgoing_msg_start",l,i);return d("MAWDexieTable").dexieAll([a.threads.get({jid:c}),a.messages.where("externalId").equals(b).toArray(),j(a,f.quote,c),d("MAWDbRavenActionTxns").maybeGetRavenMsgQueryByProtocolMsgId(a,f.ravenProtocolMsgId,g)]).then(function(c){var j=c[0],m=c[1],n=c[2];c=c[3];h("write_outgoing_msg_data_fetched",l,i,{bool:{isUnrenderedMsgType:d("MAWDbMsg").isUnrenderedMsgType(g)}});if(j==null)return{type:"missing_thread"};m=m.find(function(a){return a.threadJid===j.jid&&a.author===d("WAJids").AUTHOR_ME});if(m!=null)return m.ack>=d("MAWAckLevel").ACK.sent?{msgId:m.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:j.jid,externalId:m.externalId},type:"already_sent"}:{msgId:m.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:j.jid,externalId:m.externalId},type:"not_sent"};else{if(!d("MAWDbMsg").isUnrenderedMsgType(g)){m={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:d("WAJids").AUTHOR_ME,ephemeralSetting:f.ephemeralSetting,externalId:b,isForwarded:f.isForwarded,specialTextSize:f.specialTextSize,threadJid:j.jid,ts:e};var o=d("MAWBuildNewMsgPayload").buildNewMsg(g,m,f,n),p=f.isFirstMsg,q=f.openMessageOtid,r=f.openMessageParticipantCount,s=f.optimisticMsg,t=f.participantCount;m=d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,o).then(function(b){return d("MAWWriteMsgTxns").writeMsg(a,o,j,{isFirstMsg:p,isOutgoing:!0,openMessageOtid:q,openMessageParticipantCount:r,optimisticMsg:s,participantCount:t,quotedReplyAttachmentMeta:b})})}else{n={ack:d("MAWAckLevel").ACK.clock,author:d("WAJids").AUTHOR_ME,externalId:b,threadJid:j.jid,ts:e};n=d("MAWBuildNewMsgPayload").getNewUnrenderedMsg(g,n,f,c==null?void 0:c.externalId);m=d("MAWWriteMsgTxns").writeUnrenderedMsg(a,n,j)}return m.then(function(c){h("write_outgoing_msg_promise_resolved",l,i);return k(a,g,j.jid,e).then(function(){return{msgId:c.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:j.jid,externalId:b},type:"not_sent"}})})}})}function j(a,b,c){return b==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){return b==null?null:a.threads.get({jid:b.threadJid}).then(function(a){var e=d("MAWBuildNewMsgPayload").msgToQuotedMsg(b);if(e==null)return null;b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&(e=babelHelpers["extends"]({},e,{mediaId:void 0,msgContent:void 0,type:d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL,xmaMessageType:void 0}));if(a==null||a.jid===c)return{content:e,remoteJid:null};a=d("WAJids").interpretAndValidateJid(a.jid);a=a.jidType==="group"?a.groupJid:null;return{content:e,remoteJid:a}})})}function k(a,b,e,f){if(b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE)return d("WAJids").switchOnMsgrChatJidType(e,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){var c;if(b==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo={syncResponseRetries:((c=(c=b.ephemeralSyncResponseBackoffInfo)==null?void 0:c.syncResponseRetries)!=null?c:0)+1,syncResponseSentTs:f};return a.ephemeralSettings.put(b)}).then(c("emptyFunction"))}});return b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE?d("WAJids").switchOnMsgrChatJidType(e,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){if(b==null||b.ephemeralSyncResponseBackoffInfo==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo=void 0;return a.ephemeralSettings.put(b).then(c("emptyFunction"))})}}):d("MAWDexieTable").dexieResolve()}g.writeOutgoingMsg=b;g.writeOutgoingMsgImpl=i;g.getQuoteInfo=j}),98);
__d("MediaDownloadMediator",[],(function(a,b,c,d,e,f){"use strict";var g=new Map();function a(a,b){g.set(a,b)}async function b(a,b){var c;await ((c=g.get(a))==null?void 0:c.continue(b));g.delete(a)}function c(a,b){var c;void ((c=g.get(a))==null?void 0:c.handleError(b));g.delete(a)}f.mapDeliveryObjectIdToMediaDownloader=a;f.handleNewCDNUrlFromMI=b;f.handleMIDownloadFailure=c}),66);
__d("WAFtsTokenizerBaseNormalizer",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){var b=this,c=[];this.$1=new Map();a.forEach(function(a){var d=a[0];a=a[1];b.$1.set(d,a);c.push(d)});this.$2=new RegExp(c.join("|"),"g")}var b=a.prototype;b.normalize=function(a){var b=this;a===void 0&&(a="");return a.replace(this.$2,function(a){var c=b.$1.get(a);return c!=null?c:a})};return a}();f["default"]=a}),66);
__d("WAFtsTokenizerPostLowercaseNormalizer",["WAFtsTokenizerBaseNormalizer"],(function(a,b,c,d,e,f,g){"use strict";a=[["\u0131","i"],["\u0629","\u0647"],["\u0640",""],["\u0649","\u064a"],["\u0671","\u0627"],["\u06a4","\u0641"],["\u06a9","\u0643"],["\u06ba","\u0646"],["\u06be","\u0647"],["\u06c3","\u06c2"],["\u06cc","\u064a"],["\u06d2","\u064a"],["\u06d5","\u0647"],["\u06f0","\u0660"],["\u06f1","\u0661"],["\u06f2","\u0662"],["\u06f3","\u0663"],["\u06f4","\u0664"],["\u06f5","\u0665"],["\u06f6","\u0666"],["\u06f7","\u0667"],["\u06f8","\u0668"],["\u06f9","\u0669"],["\u08bb","\u0641"],["\u08bc","\u0642"],["\u08bd","\u0646"],["\u200c",""],["\u0966","0"],["\u0967","1"],["\u0968","2"],["\u0969","3"],["\u096a","4"],["\u096b","5"],["\u096c","6"],["\u096d","7"],["\u096e","8"],["\u096f","9"],["\u0901","\u0902"],["\u0903",""],["\u093c",""],["\u09e6","0"],["\u09e7","1"],["\u09e8","2"],["\u09e9","3"],["\u09ea","4"],["\u09eb","5"],["\u09ec","6"],["\u09ed","7"],["\u09ee","8"],["\u09ef","9"],["\u0a66","0"],["\u0a67","1"],["\u0a68","2"],["\u0a69","3"],["\u0a6a","4"],["\u0a6b","5"],["\u0a6c","6"],["\u0a6d","7"],["\u0a6e","8"],["\u0a6f","9"],["\u0c66","0"],["\u0c67","1"],["\u0c68","2"],["\u0c69","3"],["\u0c6a","4"],["\u0c6b","5"],["\u0c6c","6"],["\u0c6d","7"],["\u0c6e","8"],["\u0c6f","9"],["\u0ae6","0"],["\u0ae7","1"],["\u0ae8","2"],["\u0ae9","3"],["\u0aea","4"],["\u0aeb","5"],["\u0aec","6"],["\u0aed","7"],["\u0aee","8"],["\u0aef","9"],["\u0ce6","0"],["\u0ce7","1"],["\u0ce8","2"],["\u0ce9","3"],["\u0cea","4"],["\u0ceb","5"],["\u0cec","6"],["\u0ced","7"],["\u0cee","8"],["\u0cef","9"],["\u0d66","0"],["\u0d67","1"],["\u0d68","2"],["\u0d69","3"],["\u0d6a","4"],["\u0d6b","5"],["\u0d6c","6"],["\u0d6d","7"],["\u0d6e","8"],["\u0d6f","9"],["\u0142","l"]];b=new(c("WAFtsTokenizerBaseNormalizer"))(a);d=b;g["default"]=d}),98);
__d("WAFtsTokenizerPreNFKDNormalizer",["WAFtsTokenizerBaseNormalizer"],(function(a,b,c,d,e,f,g){"use strict";a=[["\u0675","\u0674\u0627"],["\u0676","\u0674\u0648"],["\u0677","\u0674\u06c7"],["\u0678","\u0674\u0649"],["\u0905\u0946","\u0904"],["\u0905\u093e","\u0906"],["\u0930\u094d\u0907","\u0908"],["\u0909\u0941","\u090a"],["\u090f\u0945","\u090d"],["\u090f\u0946","\u090e"],["\u090f\u0947","\u0910"],["\u0905\u0949","\u0911"],["\u0906\u0945","\u0911"],["\u0905\u094a","\u0912"],["\u0906\u0946","\u0912"],["\u0905\u094b","\u0913"],["\u0906\u0947","\u0913"],["\u0905\u094c","\u0914"],["\u0906\u0948","\u0914"],["\u0905\u0945","\u0972"],["\u0905\u093a","\u0973"],["\u0905\u093b","\u0974"],["\u0906\u093a","\u0974"],["\u0905\u094f","\u0975"],["\u0905\u0956","\u0976"],["\u0905\u0957","\u0977"],["\u0985\u09be","\u0986"],["\u098b\u09c3","\u09e0"],["\u098c\u09e2","\u09e1"],["\u0a05\u0a3e","\u0a06"],["\u0a72\u0a3f","\u0a07"],["\u0a72\u0a40","\u0a08"],["\u0a73\u0a41","\u0a09"],["\u0a73\u0a42","\u0a0a"],["\u0a72\u0a47","\u0a0f"],["\u0a05\u0a48","\u0a10"],["\u0a73\u0a4b","\u0a13"],["\u0a05\u0a4c","\u0a14"],["\u0a85\u0abe","\u0a86"],["\u0a85\u0ac5","\u0a8d"],["\u0a85\u0ac7","\u0a8f"],["\u0a85\u0ac8","\u0a90"],["\u0a85\u0ac9","\u0a91"],["\u0a85\u0acb","\u0a93"],["\u0a85\u0abe\u0ac5","\u0a93"],["\u0a85\u0acc","\u0a94"],["\u0a85\u0abe\u0ac8","\u0a94"],["\u0ac5\u0abe","\u0ac9"],["\u0b05\u0b3e","\u0b06"],["\u0b0f\u0b57","\u0b10"],["\u0b13\u0b57","\u0b14"],["\u0bb8\u0bcd\u0bb0\u0bc0","\u0bb6\u0bcd\u0bb0\u0bc0"],["\u0c12\u0c55","\u0c13"],["\u0c12\u0c4c","\u0c14"],["\u0c3f\u0c55","\u0c40"],["\u0c46\u0c55","\u0c47"],["\u0c4a\u0c55","\u0c4b"],["\u0c89\u0cbe","\u0c8a"],["\u0c92\u0ccc","\u0c94"],["\u0c8b\u0cbe","\u0ce0"],["\u0d07\u0d57","\u0d08"],["\u0d09\u0d57","\u0d0a"],["\u0d0e\u0d46","\u0d10"],["\u0d12\u0d3e","\u0d13"],["\u0d12\u0d57","\u0d14"],["\u0d23\u0d4d\u200d","\u0d7a"],["\u0d28\u0d4d\u200d","\u0d7b"],["\u0d30\u0d4d\u200d","\u0d7c"],["\u0d32\u0d4d\u200d","\u0d7d"],["\u0d33\u0d4d\u200d","\u0d7e"],["\u0d85\u0dcf","\u0d86"],["\u0d85\u0dd0","\u0d87"],["\u0d85\u0dd1","\u0d88"],["\u0d8b\u0ddf","\u0d8c"],["\u0d8d\u0dd8","\u0d8e"],["\u0d8f\u0ddf","\u0d90"],["\u0d91\u0dca","\u0d92"],["\u0d91\u0dd9","\u0d93"],["\u0d94\u0ddf","\u0d96"]];b=new(c("WAFtsTokenizerBaseNormalizer"))(a);d=b;g["default"]=d}),98);
__d("WAFtsMultiLangTokenizer",["WAFtsTokenizerPostLowercaseNormalizer","WAFtsTokenizerPreNFKDNormalizer"],(function(a,b,c,d,e,f,g){"use strict";var h={NFC_CHARACTER:/(?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u3005\u3007\u3021-\u3029\u3030\u3038-\u303B\u303D\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u31F0-\u31FF\u3297\u3299\u32D0-\u32FE\u3300-\u3357\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFF66-\uFF6F\uFF71-\uFF9D]|\uD81B[\uDFF0\uDFF1]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/g,NFC_WORD:/((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1100-\u11FF\u302E\u302F\u3131-\u318E\u3200-\u321E\u3260-\u327E\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0E01-\u0E3A\u0E40-\u0E5B])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0F00-\u0F47\u0F49-\u0F6C\u0F71-\u0F97\u0F99-\u0FBC\u0FBE-\u0FCC\u0FCE-\u0FD4\u0FD9\u0FDA])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1000-\u109F\uA9E0-\uA9FE\uAA60-\uAA7F])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1780-\u17DD\u17E0-\u17E9\u17F0-\u17F9\u19E0-\u19FF])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u02EA\u02EB\u3105-\u312F\u31A0-\u31BF])+/g},i=/(?![\u0902\u094D])(?:[\^`\xA8\xAF\xB4\xB7\xB8\u02B0-\u034E\u0350-\u0357\u035D-\u0362\u0374\u0375\u037A\u0384\u0385\u0483-\u0487\u0559\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u064B-\u0652\u0657\u0658\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F5\u0818\u0819\u08E3-\u08FE\u093C\u094D\u0951-\u0954\u0971\u09BC\u09CD\u0A3C\u0A4D\u0ABC\u0ACD\u0AFD-\u0AFF\u0B3C\u0B4D\u0B55\u0BCD\u0C4D\u0CBC\u0CCD\u0D3B\u0D3C\u0D4D\u0DCA\u0E47-\u0E4C\u0E4E\u0EBA\u0EC8-\u0ECC\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F82-\u0F84\u0F86\u0F87\u0FC6\u1037\u1039\u103A\u1063\u1064\u1069-\u106D\u1087-\u108D\u108F\u109A\u109B\u135D-\u135F\u17C9-\u17D3\u17DD\u1939-\u193B\u1A75-\u1A7C\u1A7F\u1AB0-\u1ABD\u1B34\u1B44\u1B6B-\u1B73\u1BAA\u1BAB\u1C36\u1C37\u1C78-\u1C7D\u1CD0-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1D2C-\u1D6A\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2CEF-\u2CF1\u2E2F\u302A-\u302F\u3099-\u309C\u30FC\uA66F\uA67C\uA67D\uA67F\uA69C\uA69D\uA6F0\uA6F1\uA700-\uA721\uA788-\uA78A\uA7F8\uA7F9\uA8C4\uA8E0-\uA8F1\uA92B-\uA92E\uA953\uA9B3\uA9C0\uA9E5\uAA7B-\uAA7D\uAABF-\uAAC2\uAAF6\uAB5B-\uAB5F\uAB69-\uAB6B\uABEC\uABED\uFB1E\uFE20-\uFE2F\uFF3E\uFF40\uFF70\uFF9E\uFF9F\uFFE3]|\uD800\uDEE0|\uD802[\uDEE5\uDEE6]|\uD803[\uDD22-\uDD27\uDF46-\uDF50]|\uD804[\uDCB9\uDCBA\uDD33\uDD34\uDD73\uDDC0\uDDCA-\uDDCC\uDE35\uDE36\uDEE9\uDEEA\uDF3C\uDF4D\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC42\uDC46\uDCC2\uDCC3\uDDBF\uDDC0\uDE3F\uDEB6\uDEB7\uDF2B]|\uD806[\uDC39\uDC3A\uDD3D\uDD3E\uDD43\uDDE0\uDE34\uDE47\uDE99]|\uD807[\uDC3F\uDD42\uDD44\uDD45\uDD97]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF8F-\uDF9F\uDFF0\uDFF1]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD]|\uD838[\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD46\uDD48-\uDD4A])+/g,j=/(?:[!-#%-\/:-@\[-`\{-~\xA1\xA7\xA8\xAB\xAC\xAF\xB1\xB4\xB6-\xB8\xBB\xBF\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u037E\u0384\u0385\u0387\u03F6\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0606-\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u200D\u2010-\u2027\u2030-\u205E\u207A-\u207E\u208A-\u208E\u2118\u2140-\u2144\u214B\u2190-\u2194\u219A\u219B\u21A0\u21A3\u21A6\u21AE\u21CE\u21CF\u21D2\u21D4\u21F4-\u22FF\u2308-\u230B\u2320\u2321\u2329\u232A\u237C\u239B-\u23B3\u23DC-\u23E1\u25B7\u25C1\u25F8-\u25FF\u266F\u2768-\u2775\u27C0-\u27FF\u2900-\u2AFF\u2B30-\u2B44\u2B47-\u2B4C\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u309B\u309C\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA700-\uA716\uA720\uA721\uA789\uA78A\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uAB5B\uAB6A\uAB6B\uABEB\uFB29\uFBB2-\uFBC1\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0F\uFF1A-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE2\uFFE3\uFFE9-\uFFEC]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]|\uD83B[\uDEF0\uDEF1]|\uD83C[\uDFFB-\uDFFF])/g,k=/(^|(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))((?:[0-9A-Z\^`-z\xA8\xAA\xAF\xB2-\xB5\xB7-\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u034E\u0350-\u0357\u035D-\u0362\u0370-\u0377\u037A-\u037D\u037F\u0384-\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u05D0-\u05EA\u05EF-\u05F2\u0620-\u0652\u0657\u0658\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u06EE-\u06FC\u06FF\u0710\u0712-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u0815\u0818-\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08E3-\u08FE\u0904-\u0939\u093C\u093D\u094D\u0950-\u0954\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC\u09BD\u09CD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A4D\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC\u0ABD\u0ACD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0AFD-\u0AFF\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C\u0B3D\u0B4D\u0B55\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BCD\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C4D\u0C58-\u0C5A\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC\u0CBD\u0CCD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3D\u0D4D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E4C\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBA\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECC\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F33\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F82-\u0F84\u0F86-\u0F8C\u0FC6\u1000-\u102A\u1037\u1039\u103A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1063-\u1066\u1069-\u1070\u1075-\u1081\u1087-\u109B\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17C9-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1939-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A75-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B05-\u1B34\u1B44-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B83-\u1BA0\u1BAA\u1BAB\u1BAE-\u1BE5\u1C00-\u1C23\u1C36\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CFA\u1D00-\u1DBF\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA67C\uA67D\uA67F-\uA69D\uA6A0-\uA6F1\uA700-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA92B-\uA92E\uA930-\uA946\uA953\uA960-\uA97C\uA984-\uA9B3\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAABF-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB6B\uAB70-\uABE2\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE20-\uFE2F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3E\uFF40-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE3]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE6\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF54\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC83-\uDCAF\uDCB9\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD33\uDD34\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD73\uDD76\uDD83-\uDDB2\uDDC0-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE35\uDE36\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEE9\uDEEA\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C\uDF3D\uDF4D\uDF50\uDF5D-\uDF61\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC34\uDC42\uDC46-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC2-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDBF\uDDC0\uDDD8-\uDDDB\uDE00-\uDE2F\uDE3F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB6-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF2B\uDF30-\uDF3B]|\uD806[\uDC00-\uDC2B\uDC39\uDC3A\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3D-\uDD3F\uDD41\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE34\uDE3A\uDE47\uDE50\uDE5C-\uDE89\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC3F\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD42\uDD44-\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD97\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD838[\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCD6\uDD00-\uDD46\uDD48-\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])+)[\"\'\xAB\xBB\u2018-\u201F\u2039\u203A\u2E42\u300C-\u300F\u301D-\u301F\uFE41-\uFE44\uFF02\uFF07\uFF62\uFF63]((?:[0-9A-Z\^`-z\xA8\xAA\xAF\xB2-\xB5\xB7-\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u034E\u0350-\u0357\u035D-\u0362\u0370-\u0377\u037A-\u037D\u037F\u0384-\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u05D0-\u05EA\u05EF-\u05F2\u0620-\u0652\u0657\u0658\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u06EE-\u06FC\u06FF\u0710\u0712-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u0815\u0818-\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08E3-\u08FE\u0904-\u0939\u093C\u093D\u094D\u0950-\u0954\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC\u09BD\u09CD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A4D\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC\u0ABD\u0ACD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0AFD-\u0AFF\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C\u0B3D\u0B4D\u0B55\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BCD\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C4D\u0C58-\u0C5A\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC\u0CBD\u0CCD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3D\u0D4D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E4C\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBA\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECC\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F33\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F82-\u0F84\u0F86-\u0F8C\u0FC6\u1000-\u102A\u1037\u1039\u103A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1063-\u1066\u1069-\u1070\u1075-\u1081\u1087-\u109B\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17C9-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1939-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A75-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B05-\u1B34\u1B44-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B83-\u1BA0\u1BAA\u1BAB\u1BAE-\u1BE5\u1C00-\u1C23\u1C36\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CFA\u1D00-\u1DBF\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA67C\uA67D\uA67F-\uA69D\uA6A0-\uA6F1\uA700-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA92B-\uA92E\uA930-\uA946\uA953\uA960-\uA97C\uA984-\uA9B3\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAABF-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB6B\uAB70-\uABE2\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE20-\uFE2F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3E\uFF40-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE3]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE6\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF54\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC83-\uDCAF\uDCB9\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD33\uDD34\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD73\uDD76\uDD83-\uDDB2\uDDC0-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE35\uDE36\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEE9\uDEEA\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C\uDF3D\uDF4D\uDF50\uDF5D-\uDF61\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC34\uDC42\uDC46-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC2-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDBF\uDDC0\uDDD8-\uDDDB\uDE00-\uDE2F\uDE3F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB6-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF2B\uDF30-\uDF3B]|\uD806[\uDC00-\uDC2B\uDC39\uDC3A\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3D-\uDD3F\uDD41\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE34\uDE3A\uDE47\uDE50\uDE5C-\uDE89\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC3F\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD42\uDD44-\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD97\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD838[\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCD6\uDD00-\uDD46\uDD48-\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])+)($|(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))/g,l=/(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F])+/g,m=/(?:[\$\xA2-\xA5\u058F\u060B\u07FE\u07FF\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BF\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]|\uD807[\uDFDD-\uDFE0]|\uD838\uDEFF|\uD83B\uDCB0)+/g;function n(a){return a.replace(k,function(a,b,c,d,e){return" "+c+d+" "+c+" "+d+" "})}function o(a){return a.split(l)}function p(a){return a.replace(j,"")}function q(a){return a.replace(i,"")}function r(a){return a.normalize("NFC").replace(h.NFC_CHARACTER,function(a){return" "+a+" "})}function s(a){return a.normalize("NFC").replace(h.NFC_WORD,function(a){return" "+a+" "})}function t(a){return a.replace(m,function(a){return" "+a+" "})}a=function(){function a(){}var b=a.prototype;b.tokenize=function(a){a===void 0&&(a="");a=n(a);a=t(r(s(a)));a=o(a);a=a.map(function(a){a=a;a=p(a);if(!a.length)return a;else a.match(h.NFC_CHARACTER)?a=a.normalize("NFC"):a.match(h.NFC_WORD)?a=a.normalize("NFC"):(a=q(c("WAFtsTokenizerPreNFKDNormalizer").normalize(a).normalize("NFKD")),a=a.toLocaleLowerCase("en-US"),a=c("WAFtsTokenizerPostLowercaseNormalizer").normalize(a));return a});return new Set(a.filter(function(a){return!!a&&!!a.trim()&&!a.match(l)}))};return a}();g["default"]=a}),98);
__d("WAStringz",[],(function(a,b,c,d,e,f){"use strict";var g=/\ud83c[\udffb-\udfff](?=\ud83c[\udffb-\udfff])|(?:[^\ud800-\udfff][\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]?|[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0]|\ud83c[\udffb-\udfff])?)*/g;function a(a){a=a.match(g);return a?a.length:0}function b(a,b,c){b===void 0&&(b=0);a=a.match(g);return!a?"":a.slice(Math.max(0,b),Math.max(0,c)).join("")}function c(a){return a.match(g)||[]}f.astralRange=g;f.length=a;f.substring=b;f.toArray=c}),66);
__d("WAUnicodeUtils",["WAStringz"],(function(a,b,c,d,e,f,g){"use strict";var h=5e3,i=.5;function a(a,b){return j(a||"",0,b)}function b(a){return d("WAStringz").length(a||"")}function j(a,b,c){if(a==null||a==="")return"";b=b||0;c=c==null?Infinity:c;if(b===0&&c===Infinity)return a;return a.length>=h&&c/a.length<=i?l(a,b,c):d("WAStringz").substring(a,b,c)}function k(a,b,c){a=a||"";b=b||0;c=c==null?Infinity:c;return a.length>=h&&c/a.length<=i?m(a,b,c):d("WAStringz").toArray(a).slice(b,c)}function c(a,b){b===void 0&&(b=0);if(a.codePointAt)return a.codePointAt(b);var c=a.charCodeAt(b);if(c>=55296&&c<=56319){a=a.charCodeAt(b+1);a>=56320&&a<=57343&&(c=65536+(c-55296<<10)+(a-56320))}return c}function e(a,b){if(b==null)return a;if(encodeURI(a).length<=b)return a;var c=0,d=k(a),e=d.length;for(var f=0;f<e;f++){var g=d[f];g=encodeURI(g).length;if(c+g>b)return j(a,0,f);c+=g}return a}function l(a,b,c){b=new RegExp(d("WAStringz").astralRange);var e="",f,g=0;do f=b.exec(a),f&&(e+=f[0]),g++;while(f&&g<c);return e}function m(a,b,c){b=new RegExp(d("WAStringz").astralRange);var e=[],f;do f=b.exec(a),f&&e.push(f[0]);while(f&&e.length<c);return e}g.firstNCodepoints=a;g.numCodepoints=b;g.substring=j;g.toArray=k;g.codePointAt=c;g.firstNEncodedBytes=e}),98);
__d("MpsMessageToSearchBridge",["MpsMessageToBridgeWrapper"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("MpsMessageToBridgeWrapper").MpsMessageToBridgeWrapper.fromTopLevel(a.toplevelProtobuf);if(a.expiryTimestampMs!=null)return;a=(a=b.deserialize().encryptedTransportMessage())==null||(a=a.consumerMessage())==null||(a=a.payload)==null||(a=a.content)==null||(a=a.messageText)==null?void 0:a.text;return a==null?null:{chatJid:b.getChatJid(),externalId:b.getExternalId(),msg:{content:a,sender:b.message.senderId,ts:b.getUnixTs()},sortOrderMs:b.message.timestampMs}}g.messageToSearchBridge=a}),98);
__d("MAWMsgUtil",["MAWDbMsgTxns","MAWIndexedDb","MAWTransactionMode","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,xma:a.READONLY},"updateSystemAckWithTxn",function(a){return function(b,e){return d("MAWDbMsgTxns").updateSystemAck(a,b,e).then(c("emptyFunction"))}});g.updateSystemAckWithTxn=b}),98);
__d("MAWStartMediaUploadQplFlow",["WAGetStorageQplAnnotations","WAJids","WAMediaQplHelper","WAPREList","WAPREMetrics","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.chatJid,e=a.fileSize,f=a.serverMediaType;a=a.uploadEntry;var g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_UPLOAD,{string:{chat_type:d("WAJids").switchOnMsgrChatJidType(b,{group:function(){return"group"},user:function(){return"user"}}),jid:b,media_size:d("WAMediaQplHelper").convertIntegerSizeToStringBucket(e),media_type:f,upload_entry:a}},void 0);c("promiseDone")(d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){g.addAnnotations(a)}));return g}g.startMediaUploadQplFlow=a}),98);
__d("MAWUpdateMediaEntryForOptimisticUploadApi",["FBLogger","MAWGetProtocolMsgIdByMsgId","MAWOptimisticUploadManager","MAWUpdateMediaEntryForMsgApi"],(function(a,b,c,d,e,f,g){"use strict";a=async function(a,b,e,f){var g=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),h=g.get(a),i=h==null?void 0:h.msgId,j=b();if(i!=null){i=await d("MAWGetProtocolMsgIdByMsgId").getProtocolMsgIdByMsgId(i);i&&await d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg(a,i,b,e,f)}else{if(!h)throw c("FBLogger")("messenger_web").mustfixThrow("Cannot update mediaEntry without both uploadEntry and msgId");g.set(a,babelHelpers.extends({},h,{mediaEntry:j}))}return};g.updateMediaEntryForOptimisticUpload=a}),98);
__d("MAWMediaSizeCheck",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a>100*1024}f.isMinSizeForImagePreviewGeneration=a}),66);
__d("MAWUploadAndHandleMedia",["MAWMediaManager","MWFBLogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=d("MWFBLogger").MWMediaLogger();function a(a){var b=a.chatJid,c=a.dbCallbacks,d=a.filename,e=a.hash,f=a.plaintext,g=a.protocolMsgId,h=a.serverMediaType,i=a.size;a=a.uploadMediaMetric;return k({chatJid:b,dbCallbacks:c,filename:d,hash:e,plaintext:f,protocolMsgId:g,serverMediaType:h,size:i,uploadMediaMetric:a})}async function k(a){var b=a.chatJid,c=a.dbCallbacks,e=a.filename,f=a.hash,g=a.plaintext,k=a.serverMediaType,l=a.size;a=a.uploadMediaMetric;b=await d("MAWMediaManager").getMawMediaManager().enqueueUploadFullSize({chatJid:b,mediaUploadFlow:a,plaintext:g,plaintextHash:f,serverMediaType:k});if(b.success!==!0){j.WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Failed to enqueue upload full size: ",""])),b.error);a.endFail(b.error);return b}g=await c.getDownloadableThumbnailForMedia(f).catch(function(a){j.catching(a).MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["getDownloadableThumbnailForMedia unexpected runtime-erorr: ",""])),a);return null});k=babelHelpers.extends({},b.value,{downloadableThumbnail:g,filename:e,size:l});a.endSuccess();return d("WAResultOrError").makeResult(k)}g.uploadAndHandleMedia=a}),98);
__d("MAWOptimisticUploadMedia",["MAWConfig","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetOrCreateMediaKnownEntriesApi","MAWMediaSizeCheck","MAWMediaUtils","MAWOptimisticUploadManager","MAWStartMediaUploadQplFlow","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","MAWUploadAndHandleMedia","MWFBLogger","WABlobToArrayBuffer","WAHashUtils","WAMediaCrypto","WAProgressiveJpegGetScanLengths","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r=d("MWFBLogger").MWMediaLogger().tags(["OptimisticUploadMedia"]);async function s(a,b,c){r.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["start uploading type: ",""])),String(c));var e=await d("MAWMediaUtils").hashBlob(a);e=d("WAHashUtils").toPlaintextHash(e);var f=d("MAWOptimisticUploadManager").getOptimisticUploadManager();f=f.get(e);if(f!=null)return d("WAResultOrError").makeError("already_uploading");f=c.type==="regular"?c.mediaType:"preview";var g=await d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:b,fileSize:a.size,serverMediaType:f,uploadEntry:"optimisticUploadMedia"});b=d("MAWUploadAndHandleMedia").uploadAndHandleMedia({chatJid:b,dbCallbacks:{getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload},filename:f==="document"?a.name:void 0,hash:e,mediaTypeDetails:c,plaintext:await d("WABlobToArrayBuffer").blobToArrayBuffer(a),protocolMsgId:null,serverMediaType:f,size:a.size,uploadMediaMetric:g});return d("WAResultOrError").makeResult({plaintextHash:e,uploadPromise:b})}async function a(a){var b=a.file,c=a.jid;a=a.thumbnail;var e=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(b.type);f=f.serverMediaType;r.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["file uploading"])));var g=await s(b,c,{mediaType:f,type:"regular"});g.success===!0?(r.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["fileUploadResult success"]))),e.set(g.value.plaintextHash,{file:b,optimisticUploadPromise:g.value.uploadPromise,previewPlaintextHash:null})):(g.error,r.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["File is already being uploaded"]))));var h=null;r.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["thumbnail_exists: ",""])),a!=null);var q=new Uint8Array(await d("WABlobToArrayBuffer").blobToArrayBuffer(b));if(a&&t(f,b.size,q)){r.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["preview uploading"])));q=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(f);if(q==null){r.MUSTFIX(n||(n=babelHelpers.taggedTemplateLiteralLoose(["unsupported preview media type ",""])),f);return}f=await s(a,c,{messageType:q,type:"preview"});f.success===!0&&(r.DEBUG(o||(o=babelHelpers.taggedTemplateLiteralLoose(["previewUploadResult success"]))),h=f.value.plaintextHash,e.set(f.value.plaintextHash,{file:a,optimisticUploadPromise:f.value.uploadPromise}),g.success===!0&&(r.DEBUG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["fileUploadResult success, setting with previewPlaintextHash"]))),e.set(g.value.plaintextHash,{file:b,optimisticUploadPromise:g.value.uploadPromise,previewPlaintextHash:h})))}}function t(a,b,c){switch(a){case"gif":return!1;case"image":return u(b,c);case"video":return!0;default:r.DEBUG(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Skipping preview upload for media type ",""])),a);return!1}}function u(a,b){if(!d("MAWMediaSizeCheck").isMinSizeForImagePreviewGeneration(a))return!1;return!v(b)&&d("MAWConfig").getConfig().shouldFallbackToPreviewForFailedProgressiveJpeg()===!0?!0:!1}function v(a){a=d("WAProgressiveJpegGetScanLengths").getProgressiveJpegScanLengths(a);return a.length>0}g.optimisticUploadMedia=a;g.shouldUploadPreview=t}),98);
__d("MAWTSUtils",["WATimeUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return!c("justknobx")._("2554")?null:a!=null?d("WATimeUtils").castToUnixTime(Math.floor(a/1e3)):a}g.gatedLSOptimisticTsToMaybeUnixTime=a}),98);
__d("MawWmiGetMsgTypeFromMediaType",["FBLogger","MAWDbMedia","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return d("WAMsgType").MSG_TYPE.IMAGE;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return d("WAMsgType").MSG_TYPE.VIDEO;case d("MAWDbMedia").MEDIA_TYPE.PTT:return d("WAMsgType").MSG_TYPE.PTT;case d("MAWDbMedia").MEDIA_TYPE.GIF:return d("WAMsgType").MSG_TYPE.GIF;case d("MAWDbMedia").MEDIA_TYPE.STICKER:return d("WAMsgType").MSG_TYPE.STICKER;case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return d("WAMsgType").MSG_TYPE.DOCUMENT_FILE;default:throw c("FBLogger")("wmi").tags(["unsupported_media"]).mustfixThrow("unsupported media type %s",a)}}g.getMsgTypeFromMediaType=a}),98);
__d("SendMsgArgsToProtobuf",["FBLogger","MAWAsConsumerApplication","MAWMpsGating","MAWMsgType","MAWParseSubprotocolVersionConsts","WAArmadilloApplication.pb","WAConsumerApplication.pb","WAFranking","WAGlobals","WAJids","WAMsgApplication.pb","WATimeUtils","encodeMAWDocumentFileMessage","encodeProtobuf","nullthrows","qex"],(function(a,b,c,d,e,f,g){"use strict";function h(a){switch(a){case d("MAWMsgType").MSG_TYPE.IMAGE:return d("MAWAsConsumerApplication").encodeValidatedImageMessage;case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.GIF:return d("MAWAsConsumerApplication").encodeValidatedVideoMessage;case d("MAWMsgType").MSG_TYPE.PTT:return d("MAWAsConsumerApplication").encodeValidatedAudioMessage;case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return d("encodeMAWDocumentFileMessage").encodeValidatedFileMessage;case d("MAWMsgType").MSG_TYPE.STICKER:return d("MAWAsConsumerApplication").encodeValidatedStickerMessage}return null}function i(a,b,e){var f=null,g=null,h=null,i=null;if(b.associatedMsgSendArgs!=null){e=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,c("nullthrows")(m(d("MAWMsgType").MSG_TYPE.TEXT,b.associatedMsgSendArgs,e)));f={payload:e.readBuffer(),version:d("MAWParseSubprotocolVersionConsts").ASSOCIATED_MESSAGE_SUBPROTOCOL_VERSION}}e=j(b.faviconMetadata,a.accessibilityLabel);e!=null&&(g={payload:e,version:d("MAWParseSubprotocolVersionConsts").XMA_FAVICON_SUBPROTOCOL_VERSION});e=j(b.headerMetadata,a.accessibilityLabel);e!=null&&(h={payload:e,version:d("MAWParseSubprotocolVersionConsts").XMA_HEADER_SUBPROTOCOL_VERSION});e=j(b.previewMetadata,a.accessibilityLabel);e!=null&&(i={payload:e,version:d("MAWParseSubprotocolVersionConsts").XMA_PREVIEW_SUBPROTOCOL_VERSION});e=b.xmaArgs;return{payload:{content:{extendedContentMessage:{associatedMessage:f,commands:a.commands,contentRef:e.contentRef,ctas:e.defaultCTA==null?void 0:[e.defaultCTA].concat(e.ctas).filter(Boolean),favicon:g,headerImage:h,headerTitle:e.headerTitle,maxSubtitleNumOfLines:e.maxSubtitleNumOfLines,maxTitleNumOfLines:e.maxTitleNumOfLines,mentionedJid:a.mentionedJids,messageText:a.content,overlayDescription:e.overlayDescription,overlayIconGlyph:e.overlayIconGlyph,overlayTitle:e.overlayTitle,previews:i?[i]:void 0,sentWithMessageId:f?b.xmaMsgExternalId:void 0,subtitleText:e.subtitleText,targetExpiringAtSec:e.targetExpiringAtSec,targetId:e.targetId,targetType:a.xmaMessageType,targetUsername:e.targetUsername,titleText:e.titleText,xmaLayoutType:e.xmaLayoutType}}}}}function j(a,b){return a==null?null:d("MAWAsConsumerApplication").encodeValidatedMediaToImageTransport(babelHelpers["extends"]({accessibilitySummaryText:b,mediaType:a.mediaType,size:a.file.size},a.mediaInfo),a.mediaEntry)}function k(a,b){var e;switch(a){case d("MAWMsgType").MSG_TYPE.TEXT:return{metadata:d("MAWAsConsumerApplication").encodeConsumerApplicationMetadata(b.specialTextSize),payload:{content:{messageText:{commands:b.commands,mentionedJid:b.mentionedJids,text:(e=b.content)!=null?e:""}}}};case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:e=b;return{payload:{content:{editMessage:{key:{fromMe:!0,id:e.originalProtocolMsgId.externalId,remoteJid:e.originalProtocolMsgId.chat},message:{commands:e.editMsgContent.commands,mentionedJid:e.editMsgContent.mentionedJids,text:e.editMsgContent.content},timestampMs:Date.now()}}}};case d("MAWMsgType").MSG_TYPE.REACTION:e=b;return{payload:{content:{reactionMessage:{groupingKey:e.groupingKey,key:{fromMe:!0,id:e.reactToProtocolMsgId.externalId,remoteJid:e.reactToProtocolMsgId.chat},senderTimestampMs:Date.now(),text:e.reaction}}}};case d("MAWMsgType").MSG_TYPE.REVOKED:e=b;return{payload:{applicationData:{revoke:{key:{fromMe:!0,id:e.msgId.externalId}}}}};case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.IMAGE:e=c("nullthrows")(h(a));var f=b;return e(babelHelpers["extends"]({accessibilitySummaryText:b.accessibilityLabel,mediaType:a,size:f.fileSize},f.mediaInfo),f.mediaEntry);default:return null}}function l(a,b,e,f){switch(a){case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:a=b.quote;if(a==null){c("FBLogger")("mps").mustfix("bumps should always have quotes!");return null}var g=d("WAJids").isAuthorMe(a.author)||a.author===d("WAGlobals").getMyUserJid();return{payload:{content:{bumpExistingMessage:{key:{fromMe:g,id:a.externalId,participant:g?null:a.author,remoteJid:e}}}}};case d("MAWMsgType").MSG_TYPE.NOTE_REPLY:g=b.noteExpirationTs!=null?d("WATimeUtils").castUnixTimeToMillisTime(d("WATimeUtils").castToUnixTime(b.noteExpirationTs)):void 0;return{payload:{content:{noteReplyMessage:{noteText:{text:b.noteContent},noteTimestampMs:g,textContent:{text:b.content}}}}};case d("MAWMsgType").MSG_TYPE.XMA:return!f?null:i(b,f,e);default:return null}}function m(a,b,e,f){var g;switch(a){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:case d("MAWMsgType").MSG_TYPE.REACTION:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.REVOKED:var h=d("encodeProtobuf").encodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,c("nullthrows")(k(a,b))).readBuffer();g={consumerMessage:{payload:h,version:1}};break;case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.NOTE_REPLY:case d("MAWMsgType").MSG_TYPE.XMA:if(a===d("MAWMsgType").MSG_TYPE.XMA&&c("qex")._("310")!==!0&&d("MAWMpsGating").isMpsMessagePublishSeviceEnabled()===!1)break;h=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,c("nullthrows")(l(a,b,e,f))).readBuffer();g={armadillo:{payload:h,version:1}};break}g=c("nullthrows")(g,"Unsupported message type");a=b.ephemeralSetting;e=b.forwardingScore;f=b.isForwarded;h=b.mediaGroupMetadata;var i=b.quote;a={metadata:babelHelpers["extends"]({chatEphemeralSetting:a&&{ephemeralExpiration:a.ephemeralExpirationInSec,ephemeralSettingTimestamp:a.ephemeralLastUpdatedOrSetTimestamp*1e3},forwardingScore:e!=null?e:0,frankingKey:d("WAFranking").createFrankingKey(),frankingVersion:d("WAFranking").getFrankingVersion()},h,{groupId:(a=b.mediaGroupMetadata)==null?void 0:a.groupId,groupIndex:(e=b.mediaGroupMetadata)==null?void 0:e.groupIndex,groupSize:(h=b.mediaGroupMetadata)==null?void 0:h.groupSize,isForwarded:f,quotedMessage:i&&{participant:i.author===d("WAJids").AUTHOR_ME?d("WAGlobals").getMyUserJid():i.author,stanzaId:i.externalId}}),payload:{subProtocol:g}};return a}g.createMessageApplication=m}),98);
__d("MAWSendMediaMsg",["BlobStorageTypes","EBAPI","EBLogger","MAWAckLevel","MAWAsConsumerApplication","MAWBridge","MAWBridgeTypesCreators","MAWCastToMsgrServerMediaType","MAWCheckThreadExistsTxn","MAWDbChunkTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDexieTable","MAWEphemeralMsgTxns","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetMsgIdByProtocolMsgId","MAWGetOrCreateMediaKnownEntriesApi","MAWIndexedDb","MAWMediaAfterTxns","MAWMediaBackupTxns","MAWMediaDownloadStatus","MAWMediaDownloadStatusForUI","MAWMediaManagementTxns","MAWMediaUtils","MAWMessageSendsCommon","MAWMpsGating","MAWMsgUtil","MAWOptimisticUploadManager","MAWQplProxy","MAWSendWrittenMsg","MAWStartMediaUploadQplFlow","MAWTSUtils","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","MAWUploadAndHandleMedia","MAWWriteOutgoingMsgApi","MawWmiGetMsgTypeFromMediaType","MpsMediaManager","MpsToBridgeMessageId","MpsTypes","SendMsgArgsToProtobuf","WAAPI","WAAsMessageApplication","WABlobToArrayBuffer","WAJids","WAMediaUtils","WAMsgApplication.pb","WAMsgMap","WAQPLProxy","WAResultOrError","WASortedLists","WAValidateMedia","encodeProtobuf","gkx","nullthrows","validateMAWMediaAndComposeEntryForProtoMsg"],(function(a,b,c,d,e,f,g){"use strict";var h=["qplEventType","qplInstanceKey"],i,j,k,l,m,n,o;b=function(){function a(){this.mediaEntry=null}var b=a.prototype;b.writeToDb=function(a,b,c,e){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};b.attachHashAndSaveMedia=function(a,b,c,e,f,g,h,i,j,k){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};b.maybePersistMediaEntry=function(a,b,c,e){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};b.perisitMediaEntryForQuickMediaSend=function(a,b,c){return d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE},"perisitMediaEntryForQuickMediaSend",function(e){return function(){var f=d("WAMediaUtils").encodeMediaEntryForUpload(c);return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(e,a).then(function(a){var g;if(a==null)throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("media should already exist upon this point");g=babelHelpers.extends({},a,{mediaEntries:a.mediaEntries.set(b,f),msgIds:d("WASortedLists").addToSet(a.msgIds,b),objectId:(g=c.objectId)!=null?g:void 0});return e.media.update(a.mediaId,g).then(function(){})})}})()};b.getUnderlyingMessage=function(a,b,c){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};b.updateSystemAckWithTxn=function(a,b){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};b.getProtobufData=function(a,b,c,e,f,g,h){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};b.uploadToWaapi=function(a,b,c,e,f,g,h){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};b.checkThreadExists=function(a){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};b.persistMessageAndMedia=function(a){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};b.constructMediaInfo=function(a,b){a={validatedAudioInfo:a==="Ptt"&&b.duration!=null?{duration:b.duration,mimetype:c("gkx")("3053")?d("MAWAsConsumerApplication").AUDIO_OGG_MIME_TYPE:d("MAWAsConsumerApplication").AUDIO_WAV_MIME_TYPE,played:!1}:null,validatedDocumentFileInfo:a==="DocumentFile"&&b.filename!=null?{filename:b.filename,mimetype:d("MAWAsConsumerApplication").FILE_MIME_TYPE}:null,validatedImageInfo:a==="Image"?{hdType:b.hdType,height:b.height,jpegThumbnail:b.jpegThumbnail,jpegThumbnailHeight:b.jpegThumbnailHeight,jpegThumbnailWidth:b.jpegThumbnailWidth,width:b.width}:a==="Gif"||a==="Sticker"?{height:b.height,jpegThumbnailHeight:b.height,jpegThumbnailWidth:b.width,width:b.width}:null,validatedVideoInfo:a==="Video"?{duration:b.duration,height:b.height,jpegThumbnail:b.jpegThumbnail,jpegThumbnailHeight:b.jpegThumbnailHeight,jpegThumbnailWidth:b.jpegThumbnailWidth,mimetype:d("MAWAsConsumerApplication").VIDEO_MIME_TYPE,width:b.width}:null};return a};b.getMediaEntry=function(a){var b,c=d("MAWOptimisticUploadManager").getOptimisticUploadManager();return(b=this.mediaEntry)!=null?b:(b=c.get(a))==null?void 0:b.mediaEntry};b.updateMediaEntry=function(a,b){d("MAWUpdateMediaEntryForMsgApi").maybeUpdateOptimisticUploadMediaEntry(a,b),this.mediaEntry=b()};b.saveAndPassOff=async function(a,b,c,e,f,g,h){e=b.mediaType;b=b.serverMediaType;var j=f.args;f.attachmentType;var k=f.chatJid;f.externalId;var l=f.file;f=f.filename;var m=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(b);if(!m){d("EBLogger").EBLogger().tags(["unsupported_media"]).mustfix("unsupported media type");d("MAWQplProxy").sendQplPointThroughBridge(g,"failed_media_unsupported_type",{instanceKey:h});throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Media type unsupported: "+(b!=null?b:""))}await this.getUnderlyingMessage(a,g,h);d("MAWQplProxy").sendQplPointThroughBridge(g,"get_validated_media_info_start",{instanceKey:h});m=a.msgId;var n=this.constructMediaInfo(e,j);d("MAWQplProxy").sendQplPointThroughBridge(g,"get_validated_media_info_end",{instanceKey:h});d("MAWQplProxy").sendQplPointThroughBridge(g,"attach_hash_and_save_media_start",{instanceKey:h});await this.attachHashAndSaveMedia(k,a.protocolMsgId,l,c,void 0,void 0,e,n,j.offlineAttachmentId,j.accessibilityLabel);d("MAWQplProxy").sendQplPointThroughBridge(g,"attach_hash_and_save_media_end",{instanceKey:h});var o=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),p=o.get(c),q=p==null?void 0:p.optimisticUploadPromise,r=q!=null;d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(g,"isOptimisticUpload",r,h);d("MAWQplProxy").sendQplPointThroughBridge(g,"upload_media_to_backend_start",{instanceKey:h});var s;q!=null&&(s=await q,s.success||d("MAWQplProxy").sendQplPointThroughBridge(g,"optimistic_upload_failure",{annotations:{string:{optimisticUploadError:s.error}},instanceKey:h}));if(s==null||!s.success){s==null&&d("MAWQplProxy").sendQplPointThroughBridge(g,"upload_media_when_no_existing_optimistic_upload",{instanceKey:h});r=await d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:k,fileSize:l.size,serverMediaType:b,uploadEntry:"sendMediaMsg"});s=await this.uploadToWaapi(k,a,c,b,f,l,r)}if(!s.success){d("MAWMessageSendsCommon").messageSendLogger.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media for msgId: ",""])),m);d("MAWQplProxy").sendQplPointThroughBridge(g,"upload_media_to_backend_fail",{instanceKey:h});d("MAWQplProxy").sendQPLStringAnnotationThroughBridge(g,"errorDescription",s.error,h);await this.updateSystemAckWithTxn(m,d("MAWAckLevel").ACK.failed);return d("WAResultOrError").makeError({isRetriable:!1,type:"media-error"})}d("MAWQplProxy").sendQplPointThroughBridge(g,"upload_media_to_backend_end",{instanceKey:h});d("MAWQplProxy").sendQplPointThroughBridge(g,"persist_media_entry_start",{instanceKey:h});await this.perisitMediaEntryForQuickMediaSend(c,m,s.value);d("MAWQplProxy").sendQplPointThroughBridge(g,"persist_media_entry_end",{instanceKey:h});q=this.getProtobufData(e,j,c,l,n,k);d("MAWQplProxy").sendQplPointThroughBridge(g,"send_written_msg_start",{instanceKey:h});b=await d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:a.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(g,h),"MAWSendMediaMsg",q);d("MAWQplProxy").sendQplPointThroughBridge(g,"send_written_msg_end",{instanceKey:h});d("MAWQplProxy").sendQplPointThroughBridge(g,"clean_up_memory_start",{instanceKey:h});o.delete(c);(p==null?void 0:p.previewPlaintextHash)!=null&&o.delete(p.previewPlaintextHash);d("MAWQplProxy").sendQplPointThroughBridge(g,"clean_up_memory_end",{instanceKey:h});if(b.success===!1)return d("WAResultOrError").makeError(b.error);else{f={chatJid:a.protocolMsgId.chat,content:j.content,ephemeralSetting:j.ephemeralSetting,externalId:a.protocolMsgId.externalId,fileType:l.type,initiatingSource:j.initiatingSource,messageType:"sendMsg",quote:j.quote,source:j.source,specialTextSize:j.specialTextSize,xmaMessageType:j.xmaMessageType};return d("WAResultOrError").makeResult(f)}};b.saveAndPassOffForQuickSend=async function(a,b,e,f,g,h,i,k){var l=b.mediaType;b=b.serverMediaType;var m=f.args;f.attachmentType;var n=f.chatJid;f.externalId;var o=f.file;f=f.filename;var p=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(b);if(!p){d("EBLogger").EBLogger().tags(["unsupported_media"]).mustfix("unsupported media type");d("MAWQplProxy").sendQplPointThroughBridge(g,"failed_media_unsupported_type",{instanceKey:h});throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Media type unsupported: "+(b!=null?b:""))}d("MAWQplProxy").sendQplPointThroughBridge(g,"get_validated_media_info_start",{instanceKey:h});p=a.msgId;var q=this.constructMediaInfo(l,m);d("MAWQplProxy").sendQplPointThroughBridge(g,"get_validated_media_info_end",{instanceKey:h});d("MAWQplProxy").sendQplPointThroughBridge(g,"attach_hash_and_save_media_start",{instanceKey:h});await this.attachHashAndSaveMedia(n,a.protocolMsgId,o,e,void 0,void 0,l,q,m.offlineAttachmentId,m.accessibilityLabel);d("MAWQplProxy").sendQplPointThroughBridge(g,"attach_hash_and_save_media_end",{instanceKey:h});var r=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),s=r.get(e),t=s==null?void 0:s.optimisticUploadPromise,u=t!=null;d("MAWQplProxy").sendQPLBoolAnnotationThroughBridge(g,"isOptimisticUpload",u,h);d("MAWQplProxy").sendQplPointThroughBridge(g,"upload_media_to_backend_start",{instanceKey:h});var v;if(t!=null){u=await Promise.all([t,k]);v=u[0];d("MAWQplProxy").sendQplPointThroughBridge(g,"fetch_devices_end",{instanceKey:h});v.success||d("MAWQplProxy").sendQplPointThroughBridge(g,"optimistic_upload_failure",{annotations:{string:{optimisticUploadError:v.error}},instanceKey:h})}if(v==null||!v.success){v==null&&d("MAWQplProxy").sendQplPointThroughBridge(g,"upload_media_when_no_existing_optimistic_upload",{instanceKey:h});t=await d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:n,fileSize:o.size,serverMediaType:b,uploadEntry:"sendMediaMsg"});u=await Promise.all([this.uploadToWaapi(n,a,e,b,f,o,t),k]);v=u[0];d("MAWQplProxy").sendQplPointThroughBridge(g,"fetch_devices_end",{instanceKey:h})}if(!v.success){d("MAWMessageSendsCommon").messageSendLogger.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media for msgId: ",""])),p);d("MAWQplProxy").sendQplPointThroughBridge(g,"upload_media_to_backend_fail",{instanceKey:h});d("MAWQplProxy").sendQPLStringAnnotationThroughBridge(g,"errorDescription",v.error,h);return d("WAResultOrError").makeError({isRetriable:!1,type:"media-error"})}d("MAWQplProxy").sendQplPointThroughBridge(g,"upload_media_to_backend_end",{instanceKey:h});d("MAWQplProxy").sendQplPointThroughBridge(g,"persist_media_entry_start",{instanceKey:h});b=d("WAMediaUtils").encodeMediaEntryForUpload(v.value);d("MAWQplProxy").sendQplPointThroughBridge(g,"persist_media_entry_end",{instanceKey:h});f=this.getProtobufData(l,m,e,o,q,n,b);d("MAWQplProxy").sendQplPointThroughBridge(g,"send_written_msg_start",{instanceKey:h});t=await d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:a.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(g,h),"MAWSendMediaMsg",f);d("MAWQplProxy").sendQplPointThroughBridge(g,"send_written_msg_end",{instanceKey:h});d("MAWQplProxy").sendQplPointThroughBridge(g,"clean_up_memory_start",{instanceKey:h});r.delete(e);(s==null?void 0:s.previewPlaintextHash)!=null&&r.delete(s.previewPlaintextHash);d("MAWQplProxy").sendQplPointThroughBridge(g,"clean_up_memory_end",{instanceKey:h});if(t.success===!1)return d("WAResultOrError").makeError(t.error);else{d("MAWQplProxy").sendQplPointThroughBridge(g,"persist_message_and_media_start",{instanceKey:h});k=await this.persistMessageAndMedia({blob:o,blobArrayBuffer:await d("WABlobToArrayBuffer").blobToArrayBuffer(o),chatJid:n,externalId:a.protocolMsgId.externalId,jobStartTime:i,mediaEntryData:b,mediaInfo:q,mediaSendArgs:m,mediaType:l,plaintextHash:e,protocolMsgId:a.protocolMsgId,qplEventType:g,qplInstanceKey:h,serverTs:t.value.serverTs});d("MAWQplProxy").sendQplPointThroughBridge(g,"persist_message_and_media_end",{instanceKey:h});d("MAWQplProxy").sendQplPointThroughBridge(g,"persist_message_and_media_end",{instanceKey:h});u=k!=null?k:[];p=u[0];r=u[1];if(p!=null&&r!=null&&(f==null?void 0:f.messageApplication)!=null&&!d("MAWMpsGating").isEbUploadViaMpsEnabled()){d("MAWQplProxy").sendQplPointThroughBridge(g,"eb_upload_scheduling_start",{instanceKey:h});s=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,f==null?void 0:f.messageApplication).readBuffer();await c("EBAPI").uploadSentMessage({dbMsg:p,instanceKey:a.protocolMsgId.externalId,isXMAMsg:!1,media:r,messageApplication:f==null?void 0:f.messageApplication,messageApplicationBytes:d("WAAsMessageApplication").castToMessageApplicationBytes(new Uint8Array(s)),protocolMsgId:a.protocolMsgId,serverTs:t.value.serverTs,xmaPayload:void 0});d("MAWQplProxy").sendQplPointThroughBridge(g,"eb_upload_scheduling_end",{instanceKey:h})}n={chatJid:a.protocolMsgId.chat,content:m.content,ephemeralSetting:m.ephemeralSetting,externalId:a.protocolMsgId.externalId,fileType:o.type,initiatingSource:m.initiatingSource,messageType:"sendMsg",quote:m.quote,source:m.source,specialTextSize:m.specialTextSize,xmaMessageType:m.xmaMessageType};return d("WAResultOrError").makeResult(n)}};b.sendMediaMsg=async function(a,b,e,f){var g=c("gkx")("1165");d("MAWQplProxy").sendQplPointThroughBridge(e,"fetch_devices_start",{instanceKey:f});var h=c("WAAPI").getDevicesBeforeSend({chatJid:a.chatJid,reason:"SendMediaMsg"});g||(await h,d("MAWQplProxy").sendQplPointThroughBridge(e,"fetch_devices_end",{instanceKey:f}));d("MAWQplProxy").sendQplPointThroughBridge(e,"write_msg_to_db_start",{instanceKey:f});var i=await this.writeToDb({args:a.args,attachmentType:a.attachmentType,chatJid:a.chatJid,externalId:a.externalId,file:a.file},b,e,f),j=i[0];i=i[1];d("MAWQplProxy").sendQplPointThroughBridge(e,"write_msg_to_db_end",{instanceKey:f});d("MAWQplProxy").sendQplPointThroughBridge(e,"gen_blob_hashes_start",{instanceKey:f});var k=await d("MAWMediaUtils").genBlobHashes(a.file),l=k[0];k=k[1];d("MAWQplProxy").sendQplPointThroughBridge(e,"gen_blob_hashes_end",{instanceKey:f});d("MAWQplProxy").sendQplPointThroughBridge(e,"save_and_pass_off_start",{instanceKey:f});g?g=await this.saveAndPassOffForQuickSend(j,i,l,a,e,f,b,h):g=await this.saveAndPassOff(j,i,l,k,a,e,f);d("MAWQplProxy").sendQplPointThroughBridge(e,"save_and_pass_off_end",{instanceKey:f});return g};return a}();var p=function(a){function b(){return a.apply(this,arguments)||this}babelHelpers.inheritsLoose(b,a);var e=b.prototype;e.writeToDb=async function(a,b,e,f){var g=a.args,h=a.attachmentType,i=a.chatJid,j=a.externalId;a=a.file;d("MAWMessageSendsCommon").messageSendLogger.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Chat ",": is received in job"])),i);a=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(a.type,void 0,h);h=a.mediaType;a=a.serverMediaType;var m=d("MawWmiGetMsgTypeFromMediaType").getMsgTypeFromMediaType(h),n=c("gkx")("1165");d("MAWMessageSendsCommon").messageSendLogger.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["MAWSendMediaMsg - begin writing "," media msg"])),m);if(n){n=await this.checkThreadExists(i);if(!n){d("MAWQplProxy").sendQplPointThroughBridge(e,"missing_db_thread",{instanceKey:f});throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Failed to write msg to DB - thread missing")}return Promise.resolve([{msgId:c("nullthrows")(d("MAWDbMsg").toMsgId(i+"_"+j+"_m")),protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:i,externalId:j},type:"not_sent"},{mediaType:h,serverMediaType:a}])}n=await d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(j,i,b,g,m,e,f);if(n.type==="missing_thread"){d("MAWQplProxy").sendQplPointThroughBridge(e,"writing_media_to_db_failed",{instanceKey:f});throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Failed to write msg to DB - thread missing")}return[n,{mediaType:h,serverMediaType:a}]};e.attachHashAndSaveMedia=async function(a,b,e,f,g,h,i,j,k,l){var n=c("gkx")("1165");if(n)return Promise.resolve();var o=await d("WABlobToArrayBuffer").blobToArrayBuffer(e);c("gkx")("6236")&&(d("MAWMessageSendsCommon").messageSendLogger.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["writing blob to storage"]))),void async function(){var a=await d("WAValidateMedia").validateMedia(o);a.success&&await d("MAWBridge").getBridge().fireAndForget("event","writeToMediaStorage",{blob:a.value.validatedPlaintext,fileName:d("BlobStorageTypes").toBlobFileName(f)})}());return d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READWRITE,media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,unrenderedMessages:d("MAWTransactionMode").READWRITE},"attachHashAndSaveMedia",function(m){return function(){return d("MAWDexieTable").dexieAll([d("MAWMediaManagementTxns").attachHashToMediaMsg(m,b,f,g,h,i,e.size,j,!1,l!=null?l:void 0),d("MAWDbChunkTxns").getOrCreateMediaChunkWithPlaintextHash(m,f,o,e.type)]).then(function(b){var e=b[0];return m.messages.where("msgId").anyOf(e.msgIds).toArray().then(function(b){var g=d("MAWMediaUtils").createHdTypesForBridgeMedia(b);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"sent_media",hash:f,status:c("MAWMediaDownloadStatus").SUCCESS,type:"main"});b=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:a,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(b,a),hasMediaForUI:!0,hdTypes:g,media:e,offlineAttachmentId:k});return d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(m,b)})})}})()};e.maybePersistMediaEntry=function(a,b,c,e){var f=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),g=f.get(a),h=g==null?void 0:g.mediaEntry;if(g==null){if(e!=null){var i=e.qplEventType,j=e.qplInstanceKey;d("MAWQplProxy").sendQplPointThroughBridge(i,"persist_media_skipped_because_upload_entry_null",{instanceKey:j})}return Promise.resolve()}f.set(a,babelHelpers.extends({},g,{msgId:b}));if(h==null){if(e!=null){i=e.qplEventType;j=e.qplInstanceKey;d("MAWQplProxy").sendQplPointThroughBridge(i,"persist_media_skipped_because_optimistic_media_entry_null",{instanceKey:j})}return Promise.resolve()}return d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READWRITE,mediaBackup:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY},"maybePersistMediaEntry",function(e){return function(){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(e,a).then(function(a){if(a){var f=babelHelpers.extends({},a,{mediaEntries:a.mediaEntries.set(b,h),msgIds:d("WASortedLists").addToSet(a.msgIds,b)});c!=null&&(f=babelHelpers.extends({},f,{objectId:d("WAMediaUtils").stringToDeliveryObjectId(c)}));return e.media.update(a.mediaId,f).then(function(f){c!=null&&d("MAWMediaBackupTxns").linkMediaBackup(e,a.mediaId,b,d("WAMediaUtils").stringToDeliveryObjectId(c))})}else throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("media should already exist upon this point")})}})()};e.getUnderlyingMessage=async function(a,b,c){d("MAWQplProxy").sendQplPointThroughBridge(b,"get_underlying_message_start",{instanceKey:c});var e=await d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(a.protocolMsgId);if(!e.success){d("MAWQplProxy").sendQplPointThroughBridge(b,"failed_media_msgid_missing_in_db",{instanceKey:c});throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Message missing in db")}e.value!==a.msgId&&d("MAWMessageSendsCommon").messageSendLogger.MUSTFIX(n||(n=babelHelpers.taggedTemplateLiteralLoose(["[MAWSendMediaMsg] - msgId mismatch between put msg and got msg"])));d("MAWQplProxy").sendQplPointThroughBridge(b,"get_underlying_message_end",{instanceKey:c})};e.updateSystemAckWithTxn=function(a,b){return d("MAWMsgUtil").updateSystemAckWithTxn(a,b)};e.getProtobufData=function(a,b,e,f,g,h,i){var j=c("gkx")("1165");if(!j)return null;j=d("MawWmiGetMsgTypeFromMediaType").getMsgTypeFromMediaType(a);a=d("validateMAWMediaAndComposeEntryForProtoMsg").validateMediaEntry(e,c("nullthrows")(i!=null?i:this.getMediaEntry(e)));return{messageApplication:d("SendMsgArgsToProtobuf").createMessageApplication(j,babelHelpers.extends({},b,{fileSize:f.size,mediaEntry:a,mediaInfo:g}),h)}};e.uploadToWaapi=async function(a,b,e,f,g,h,i){var j=c("gkx")("1165"),k=function(){throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Not implemented")};return d("MAWUploadAndHandleMedia").uploadAndHandleMedia({chatJid:a,dbCallbacks:{getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:j?k:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:j?k:d("MAWGetMediaPlaintextApi").getMediaPlaintext,updateMediaEntryForMsg:j?k:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:j?k:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload},filename:f==="document"?g:void 0,hash:e,mediaTypeDetails:{mediaType:f,type:"regular"},plaintext:await d("WABlobToArrayBuffer").blobToArrayBuffer(h),protocolMsgId:b.protocolMsgId,serverMediaType:f,size:h.size,uploadMediaMetric:i})};e.checkThreadExists=function(a){return d("MAWCheckThreadExistsTxn").checkThreadExistsTxn(a)};e.persistMessageAndMedia=function(a){var b=a.blob,e=a.blobArrayBuffer,f=a.chatJid,g=a.externalId,h=a.jobStartTime,i=a.mediaEntryData,j=a.mediaInfo,k=a.mediaSendArgs,l=a.mediaType,m=a.plaintextHash,n=a.protocolMsgId,p=a.qplEventType,q=a.qplInstanceKey,r=a.serverTs;return d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READWRITE,ephemeralSettings:a.READWRITE,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READWRITE,mediaBackup:a.READWRITE,messages:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"persistMessageAndMedia",function(a){return function(){var s=d("MawWmiGetMsgTypeFromMediaType").getMsgTypeFromMediaType(l);d("MAWQplProxy").sendQplPointThroughBridge(p,"persist_message_start",{instanceKey:q});return d("MAWWriteOutgoingMsgApi").writeOutgoingMsgImpl(a,g,f,h,k,s,p,q).then(function(a){if(a.type==="missing_thread"){d("MAWQplProxy").sendQplPointThroughBridge(p,"writing_media_to_db_failed",{instanceKey:q});throw d("MAWMessageSendsCommon").messageSendLogger.mustfixThrow("Failed to write msg to DB - thread missing")}d("MAWQplProxy").sendQplPointThroughBridge(p,"persist_message_end",{instanceKey:q});return a}).then(function(g){var h;d("MAWQplProxy").sendQplPointThroughBridge(p,"persist_media_and_chunk_start",{instanceKey:q});return d("MAWDexieTable").dexieAll([d("MAWMediaManagementTxns").attachHashToMediaMsg(a,n,m,void 0,void 0,l,b.size,j,!1,(h=k.accessibilityLabel)!=null?h:void 0,i),d("MAWDbChunkTxns").getOrCreateMediaChunkWithPlaintextHash(a,m,e,b.type)]).then(function(b){var h=b[0];d("MAWQplProxy").sendQplPointThroughBridge(p,"persist_media_and_chunk_end",{instanceKey:q});c("gkx")("6236")&&(d("MAWMessageSendsCommon").messageSendLogger.DEBUG(o||(o=babelHelpers.taggedTemplateLiteralLoose(["writing blob to storage"]))),void async function(){var a=await d("WAValidateMedia").validateMedia(e);a.success&&await d("MAWBridge").getBridge().fireAndForget("event","writeToMediaStorage",{blob:a.value.validatedPlaintext,fileName:d("BlobStorageTypes").toBlobFileName(m)})}());d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"sent_media",hash:m,status:c("MAWMediaDownloadStatus").SUCCESS,type:"main"});return a.messages.where("msgId").anyOf(h.msgIds).toArray().then(function(b){var c=d("MAWMediaUtils").createHdTypesForBridgeMedia(b);b=d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:f,filteredMsgIds:d("MAWBridgeTypesCreators").getMsgIdsFilteredByJid(b,f),hasMediaForUI:!0,hdTypes:c,media:h,offlineAttachmentId:k.offlineAttachmentId});return d("MAWMediaAfterTxns").handleNewMediaAfterTxnWithBridgeMedia(a,b)}).then(function(){d("MAWQplProxy").sendQplPointThroughBridge(p,"mark_message_as_sent_start",{instanceKey:q});return d("MAWDbMsgTxns").updateSystemAck(a,g.msgId,d("MAWAckLevel").ACK.sent,r)}).then(function(b){d("MAWQplProxy").sendQplPointThroughBridge(p,"mark_message_as_sent_end",{instanceKey:q});if(b!=null&&b.ephemeralSetting!=null){d("MAWQplProxy").sendQplPointThroughBridge(p,"mark_ephemeral_message_as_sent_start",{instanceKey:q});return d("MAWEphemeralMsgTxns").markEphemeralMessageAsSent(a,b,!0).then(function(a){d("MAWQplProxy").sendQplPointThroughBridge(p,"mark_ephemeral_message_as_sent_end",{instanceKey:q});return[a!=null?a:b,h]})}return[b,h]})})})}})()};return b}(b),q=function(a){function b(){return a.apply(this,arguments)||this}babelHelpers.inheritsLoose(b,a);var e=b.prototype;e.writeToDb=function(a){var b=a.attachmentType,c=a.chatJid,e=a.externalId;a=a.file;a=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(a.type,void 0,b);b=a.mediaType;a=a.serverMediaType;return Promise.resolve([{msgId:d("MpsToBridgeMessageId").mpsToBridgeMsgId(d("MpsTypes").toThreadId(c),d("MpsTypes").toMessageId(e)),protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:c,externalId:e},type:"not_sent"},{mediaType:b,serverMediaType:a}])};e.attachHashAndSaveMedia=async function(a,b,c,e){a=await d("WABlobToArrayBuffer").blobToArrayBuffer(c);await d("MpsMediaManager").storeChunk(e,a,c.type)};e.maybePersistMediaEntry=function(a,b){var c=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),e=c.get(a);if(e==null)return Promise.resolve();c.set(a,babelHelpers.extends({},e,{msgId:b}));return Promise.resolve()};e.getUnderlyingMessage=function(){return Promise.resolve()};e.updateSystemAckWithTxn=function(){return Promise.resolve()};e.getProtobufData=function(a,b,e,f,g,h,i){a=d("MawWmiGetMsgTypeFromMediaType").getMsgTypeFromMediaType(a);i=d("validateMAWMediaAndComposeEntryForProtoMsg").validateMediaEntry(e,c("nullthrows")(i!=null?i:this.getMediaEntry(e)));return{messageApplication:d("SendMsgArgsToProtobuf").createMessageApplication(a,babelHelpers.extends({},b,{fileSize:f.size,mediaEntry:i,mediaInfo:g}),h)}};e.uploadToWaapi=async function(a,b,c,e,f,g,h){var i=this;return d("MAWUploadAndHandleMedia").uploadAndHandleMedia({chatJid:a,dbCallbacks:{getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:function(){return Promise.resolve(new(d("WAMsgMap").MsgMap)())},getMediaPlaintext:function(){return Promise.resolve(g)},updateMediaEntryForMsg:function(a,b,c){i.updateMediaEntry(a,c);return Promise.resolve()},updateMediaEntryForOptimisticUpload:function(a,b){i.updateMediaEntry(a,b);return Promise.resolve()}},filename:e==="document"?f:void 0,hash:c,mediaTypeDetails:{mediaType:e,type:"regular"},plaintext:await d("WABlobToArrayBuffer").blobToArrayBuffer(g),protocolMsgId:b.protocolMsgId,serverMediaType:e,size:g.size,uploadMediaMetric:h})};e.checkThreadExists=function(a){return Promise.resolve(!0)};e.persistMessageAndMedia=function(a){return null};return b}(b);function r(){return d("MAWMpsGating").isFullMpsEnabled()?new q():new p()}function a(a){var b=a.qplEventType,c=a.qplInstanceKey,e=babelHelpers.objectWithoutPropertiesLoose(a,h),f=r();return d("MAWMessageSendsCommon").messageSendObserver(b,c,function(g){var h;return f.sendMediaMsg(e,(h=d("MAWTSUtils").gatedLSOptimisticTsToMaybeUnixTime((h=a.args)==null||(h=h.optimisticMsg)==null?void 0:h.ts))!=null?h:g,b,c)},"media",{author:d("WAJids").AUTHOR_ME,chat:a.chatJid,externalId:a.externalId})}g.mediaSender=r;g.sendMediaMsgFn=a}),98);
__d("MAWWorkerPersistedDataService",["FBLogger","MAWBridge","MAWCacheServiceUtils"],(function(a,b,c,d,e,f,g){"use strict";var h="maw_persisted_data_service_broadcast",i=function(){if(!d("MAWCacheServiceUtils").globalScope.BroadcastChannel){c("FBLogger")("messenger_e2ee_web").warn("BroadcastChannel is not supported in this browser");return null}return new(d("MAWCacheServiceUtils").globalScope.BroadcastChannel)(h)},j=function(){function a(){this.$1=i()}var b=a.prototype;b.emitBroadcastChannelMessageToUI=function(a,b,c,e){b={cache:b,instanceKey:e,namespace:a,source:c};this.$1==null?d("MAWBridge").getBridge().fireAndForget("event","broadcastChannelFallback",{event:{data:b},namespace:h}):this.$1.postMessage(b)};return a}(),k=null;a=function(){k==null&&(k=new j());return k};g.MAW_PERSISTED_DATA_SERVICE_BROADCAST_CHANNEL=h;g.getMAWPersistedDataServiceBroadcastChannel=i;g.getMAWWorkerPersistedDataService=a}),98);
__d("MAWSendXMAShareMsgUtils",["MAWBridgeMsg","MAWDbMsgTxns","MAWDexieTable","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetOrCreateMediaKnownEntriesApi","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWMediaManagementTxns","MAWMediaUtils","MAWMessageSendsCommon","MAWMsgType","MAWStartMediaUploadQplFlow","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","MAWUploadAndHandleMedia","MAWXMAManagementTxns","MAWXMAUtils","WABlobToArrayBuffer","WAJids","validateMAWMediaAndComposeEntryForProtoMsg"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MAWMessageSendsCommon").messageSendLogger.tags(["XMAShare"]);async function i(a,b,c,e,f,g,h){h=h.get(a);h=h==null?void 0:h.optimisticUploadPromise;if(h!=null)return h;var i=d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:b,fileSize:f,serverMediaType:e,uploadEntry:"sendXMAShareMsg"});return d("MAWUploadAndHandleMedia").uploadAndHandleMedia({chatJid:b,dbCallbacks:{getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload},filename:void 0,hash:a,mediaTypeDetails:{mediaType:e,type:"regular"},plaintext:await d("WABlobToArrayBuffer").blobToArrayBuffer(g.file),protocolMsgId:c,serverMediaType:e,size:f,uploadMediaMetric:i}).catch(function(a){i.endFail("xma_upload_unknown_failure",{string:{errorDescription:a.toString()}});throw a})}function a(a){var b=a.chatJid,c=a.favicon,e=a.header,f=a.optimisticUploadManager,g=a.preview,h=a.protocolMsgId;a=[g,c,e].filter(Boolean);g=a.map(function(a){var c=a.dbMedia;a=a.file;var e=d("MAWMediaUtils").getServerMediaTypeFromMediaType(c.mediaType,"xma-media");return i(c.plaintextHash,b,h,e,c.size,a,f).then(function(a){return{media:c,uploadResult:a}})});return Promise.all(g)}async function b(a){var b=a.chatJid,c=a.favicon,e=a.header,f=a.optimisticUploadManager,g=a.preview,h=a.protocolMsgId;a=await Promise.all([j(g),j(c),j(e)]);g=a[0];c=a[1];j=a[2];return{favicon:c,header:j,preview:g};function j(a){if(a==null)return Promise.resolve(null);var c=a.file,e=a.mediaType,g=a.plaintextHash;a=d("MAWMediaUtils").getServerMediaTypeFromMediaType(e,"xma-media");return i(g,b,h,a,c.file.size,c,f).then(function(a){return{plaintextHash:g,uploadResult:a}})}}async function c(a,b,c,d,e,f,g,h,i,l,m){a=await Promise.all([j(a,m,"preview"),j(b,m,"header"),j(c,m,"favicon")]);b=a[0];c=a[1];m=a[2];return k(d,b,c,m,e,f,g,h,i,l)}function e(a){var b=a.associatedMsgId,c=a.chatJid,d=a.db,e=a.faviconMediaEntry,f=a.faviconMetadata,g=a.headerMediaEntry,h=a.headerMetadata,i=a.msgId,j=a.offlineAttachmentId,k=a.previewMediaEntry,m=a.previewMetadata,n=a.targetType,o=a.xmaArgs;a=a.xmaMsgProtocolMsgId;return l({associatedMsgId:b,chatJid:c,db:d,faviconMediaEntry:e,faviconMetadata:f,headerMediaEntry:g,headerMetadata:h,msgId:i,offlineAttachmentId:j,previewMediaEntry:k,previewMetadata:m,targetType:n,xmaArgs:o,xmaMsgProtocolMsgId:a})}async function j(a,b,c){if(a==null)return a;var e=a.file,f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(e.type,!0),g=f.mediaType;f=f.serverMediaType;var i=await d("MAWMediaUtils").genBlobHashes(e),j=i[0];i=i[1];if(g!=="Image"){b==null||b("xma_media_type_not_image",{string:{xma_get_media_metadata_source:c,xma_media_type:g}});throw h.mustfixThrow("Expected Image when sending XMA share")}b=await d("WABlobToArrayBuffer").blobToArrayBuffer(e);return{blobArrayBuffer:b,file:e,hashedPlaintextHash:i,mediaInfo:{validatedAudioInfo:null,validatedDocumentFileInfo:null,validatedImageInfo:{height:a.height,width:a.width},validatedVideoInfo:null},mediaType:g,plaintextHash:j,serverMediaType:f}}function k(a,b,c,e,f,g,h,i,j,k){var m;return d("MAWIndexedDb").makeMsgrTransactor({chunk:(m=d("MAWTransactionMode")).READWRITE,media:m.READWRITE,mediaBackup:m.READWRITE,messages:m.READWRITE,unrenderedMessages:m.READWRITE,xma:m.READWRITE},"saveXMAMediaAndMetadata",function(d){return function(){return l({associatedMsgId:g,chatJid:j,db:d,faviconMetadata:e,headerMetadata:c,msgId:a,offlineAttachmentId:k,previewMetadata:b,targetType:f,xmaArgs:i,xmaMsgProtocolMsgId:h})}})()}function l(a){var b=a.associatedMsgId,c=a.chatJid,e=a.db,f=a.faviconMediaEntry,g=a.faviconMetadata,h=a.headerMediaEntry,i=a.headerMetadata,j=a.msgId,k=a.offlineAttachmentId,l=a.previewMediaEntry,n=a.previewMetadata,o=a.targetType,p=a.xmaArgs,q=a.xmaMsgProtocolMsgId;a=new Map();n!=null&&a.set(n.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(e,q,n.blobArrayBuffer,n.plaintextHash,void 0,void 0,n.mediaType,n.mediaInfo,n.file,!0,void 0,l));if(i!=null){l=a.get(i.plaintextHash);l==null&&a.set(i.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(e,q,i.blobArrayBuffer,i.plaintextHash,void 0,void 0,i.mediaType,i.mediaInfo,i.file,!0,void 0,h))}if(g!=null){l=a.get(g.plaintextHash);l==null&&a.set(g.plaintextHash,d("MAWMediaManagementTxns").attachHashAndSaveMedia(e,q,g.blobArrayBuffer,g.plaintextHash,void 0,void 0,g.mediaType,g.mediaInfo,g.file,!0,void 0,f))}h=Array.from(a.values());return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsg(e,b),d("MAWDexieTable").dexieAll(h)]).then(function(a){var f=a[0];a=a[1];a=a.reduce(function(a,b){return a.set(b.plaintextHash,b)},new Map());var h=n!=null?a.get(n.plaintextHash):void 0,l=i!=null?a.get(i.plaintextHash):void 0,r=g!=null?a.get(g.plaintextHash):void 0;d("MAWDexieTable").dexieResolve();return d("MAWXMAManagementTxns").saveXMA(e,h==null?void 0:h.mediaId,l==null?void 0:l.mediaId,r==null?void 0:r.mediaId,o,j,b,q,p,k,h==null?void 0:h.plaintextHash,l==null?void 0:l.plaintextHash,r==null?void 0:r.plaintextHash).then(function(b){d("MAWXMAUtils").isXMAStoryReply(o)&&f!=null?a=m(e,c,b,h,f):a=d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(e,b,h);return a.then(function(){return{dbXMA:b,faviconDbMedia:r,headerDbMedia:l,previewDbMedia:h}})})})}function m(a,b,c,e,f){var g=d("WAJids").interpretAsUserJid(b);if(g==null)throw h.mustfixThrow("this is a flow check, participant jid can not be null");var i=c.defaultCTA;i=i==null?void 0:i.nativeUrl;g={author:g,expirationTs:c.targetExpiringAtSec,externalId:c.externalId,mediaId:e==null?void 0:e.mediaId,plaintextHash:e==null?void 0:e.plaintextHash,sourceId:i,ts:f.ts,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:c.targetType};e={content:g,remoteJid:b};if(f.type!==d("MAWMsgType").MSG_TYPE.TEXT)throw h.mustfixThrow("flow check, this message type is only in text type");var j=babelHelpers.extends({},f,{quote:e});return a.messages.put(j).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(j)})})}function f(a,b){return a==null||b==null?null:{file:a.file,mediaEntry:d("validateMAWMediaAndComposeEntryForProtoMsg").validateMediaEntry(a.plaintextHash,b),mediaInfo:a.mediaInfo,mediaType:a.mediaType}}g.uploadXMAMediasLegacy=a;g.uploadXMAMediasForQuickSend=b;g.saveXMAContentLegacy=c;g.saveXMAContent=e;g.getMediaMetadata=j;g.getXMAMediaMetadataForSending=f}),98);
__d("WAGetRemotePublicIdentity",["WAJids","WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b){return d("WASignalDB").getDb().runInTransaction(["identity"],"readonly",async function(c){var e=d("WAJids").toMsgrUserJid(b);e=d("WAJids").toDeviceJid(e,a);c=await c.stores.identity.get(e);return c==null?void 0:c.identity},d("WASignalDB").signalOp("getRemotePublicIdentityKey"))};g.getRemotePublicIdentity=a}),98);
__d("MAWLowLevelApiImpl",["MAWBridgeHandlers"],(function(a,b,c,d,e,f,g){"use strict";function a(){return{bridgeHandlers:d("MAWBridgeHandlers").bridgeHandlers}}g.makeLowLevelApi=a}),98);
__d("createInstamadilloAddMessagePayload",["I64","InstamadilloMessageIdUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return a!=null?{ephemeralityParams:{ephemeralDurationSec:(h||(h=d("I64"))).to_int32(a)}}:{}}function j(a){return a.isForwarded===!0?{forwardingParams:{forwardedThreadId:(h||(h=d("I64"))).to_string(a.threadKey)}}:{}}function k(a){if(a.replySourceId==null&&a.replySourceTimestampMs==null)return{};function b(){return a.replySourceId!=null?{repliedToMessageOtid:d("InstamadilloMessageIdUtils").fromInstamadilloMessageId(a.replySourceId).stanzaId}:{}}function c(){return a.replySourceTimestampMs!=null?{repliedToMessageWaServerTimeSec:(h||(h=d("I64"))).to_string(a.replySourceTimestampMs)}:{}}return{repliedToMessage:babelHelpers["extends"]({},b(),c())}}function a(a,b){b={content:{text:{text:b?void 0:a.text}},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),j(a),k(a))};return b}function b(a,b){b={content:{media:b},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),j(a),k(a))};return b}function c(a,b){b={content:{receiverFetchXma:JSON.parse(b)},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),j(a),k(a))};return b}g.createInstamadilloAddMessageTextPayload=a;g.createInstamadilloAddMessageMediaPayload=b;g.createInstamadilloAddMessageReceiverFetchXmaPayload=c}),98);
__d("createInstamadilloTransportPayload",[],(function(a,b,c,d,e,f){"use strict";function a(a){a={add:a};return a}function b(a){a={supplement:a};return a}function c(a){a={"delete":a};return a}function d(a){a={franking:a};return a}f.createInstamadilloAddMessageTransportPayload=a;f.createInstamadilloSupplementMessageTransportPayload=b;f.createInstamadilloDeleteMessageTransportPayload=c;f.createInstamadilloFrankingTransportPayload=d}),66);
__d("WAFrameSocket",["WABinary","WAErrors","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=function(a){function b(b){var c="SocketClosed";b=a.call(this,b!=null?b:c)||this;b.name=c;return b}babelHelpers.inheritsLoose(b,a);var c=b.prototype;c.toString=function(){return this.name};return b}(babelHelpers.wrapNativeSuper(Error));a=function(){function a(a,b){var c=this;this.$3=new(d("WABinary").Binary)();this.closed=!1;this.$4=!1;this.onFrame=null;this.onClose=null;this.$5=function(a){c.$3.writeByteArray(a),c.convertBufferedToFrames()};this.$6=function(){if(c.$3.peek(n)){d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed, waiting for pending processing"])));c.$4=!0;return}c.$9()};this.$7=function(a){d("WALogger").DEV(i||(i=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket error"]))).devConsole(a)};this.$2=b;this.$1=a;a.onData=this.$5;a.onClose=this.$6;a.onError=this.$7}var b=a.prototype;b.sendFrame=function(a){if(this.$4)return;this.throwIfClosed();var b=this.$2,c=a.byteLength;this.$8(c);var d=this.$1.dataToSend;b?(this.$2=null,d.ensureAdditionalCapacity(b.length+3+c),d.writeByteArray(b)):d.ensureAdditionalCapacity(3+c);d.writeUint8(c>>16);d.writeUint16(c&65535);d.write(a);this.$1.requestSend()};b.$9=function(){if(this.closed)return;d("WALogger").LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed"])));this.$4=!1;this.closed=!0;var a=this.onClose;a&&a()};b.$8=function(a){if(a>=1<<24){d("WALogger").WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Buffer to send: ",""])),a);throw new(d("WAErrors").BufferTooLargeError)("Buffer too large: "+a)}};b.convertBufferedToFrames=function(){var a=this.$3,b=this.onFrame;while(b&&a.peek(n)){var c=o(a);c=a.readByteArrayView(c);b(c);b=this.onFrame}this.$4&&!a.peek(n)&&this.$9();b&&a.size()&&d("WALogger").LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket: queueing partial frame of "," bytes"])),a.size())};b.throwIfClosed=function(){if(this.closed)throw new m()};b.close=function(){this.$1.close()};return a}();function n(a){if(a.size()<3)return!1;var b=o(a);return b<=a.size()}function o(a){return a.readUint8()<<16|a.readUint16()}g.SocketClosed=m;g.FrameSocket=a}),98);
__d("WANoiseSocket",["WACryptoDependencies","WALogger","WAPromiseQueue"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;a=Promise.reject("UNINITIALIZED HANDSHAKE");var k=new Uint8Array(0);a.catch(function(){});b=function(){function a(a,b,c){var e=this;this.$4=[];this.$5=new(d("WAPromiseQueue").PromiseQueue)();this.$6=new(d("WAPromiseQueue").PromiseQueue)();this.$7=0;this.$8=0;this.$9=!1;this.$14=function(a){!e.$1.closed?(d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Sending encrypted frame to web socket"]))).tags("WANoiseSocket"),e.$1.sendFrame(a)):d("WALogger").LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["NoiseSocket socket closed while encrypting frame"])))};this.$12=function(a){var b=e.$7++;e.$5.enqueueHandlers(n(e.$2,b,void 0,a),e.$15)};this.$13=function(){e.$9=!0,e.$5.wait().then(function(){e.$9=!1;var a=e.$11;a&&a()})};this.$15=function(a){e.$10?e.$10(a):e.$4.push(a)};this.$1=a;this.$3=b;this.$2=c;a.onFrame=this.$12;this.$1.onClose=this.$13;a.convertBufferedToFrames()}var b=a.prototype;b.sendFrameAsync=async function(a){a=await this.sendFrame(a);return a};b.sendFrame=function(a){if(this.$9)return Promise.resolve();this.$1.throwIfClosed();var b=this.$8++;d("WALogger").DEV(j||(j=babelHelpers.taggedTemplateLiteralLoose(["sendFrame adding to queue with frame size: "," bytes"])),a.length).tags("WANoiseSocket");return this.$6.enqueueHandlers(m(this.$3,b,void 0,a),this.$14)};b.setOnFrame=function(a){this.$10=a};b.setOnClose=function(a){this.$11=a};b.close=function(){this.$1.close()};return a}();function l(a){var b=new ArrayBuffer(12),c=new DataView(b);c.setUint32(8,a);return new Uint8Array(b)}function m(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-GCM",iv:l(b),additionalData:c?new Uint8Array(c):k},a,e)}function n(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-GCM",iv:l(b),additionalData:c?new Uint8Array(c):k},a,e)}g.NoiseSocket=b}),98);
__d("getBroadcastChannelForExecutionContext",["CometTaskFrameworkTypes","MWBroadcastChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MWBroadcastChannel").MWBroadcastChannel(d("CometTaskFrameworkTypes").TASK_FRAMEWORK_PREFIX+"_"+String(a))}g["default"]=a}),98);
__d("loadTaskHandlerResource",["cr:3760"],(function(a,b,c,d,e,f,g){"use strict";async function a(a){a=b("cr:3760").TASK_HANDLERS_RESOURCES[a];return a==null?null:a.getModuleIfRequired()||a.load()}g.default=a}),98);
__d("registerExecutionContext",["BroadcastChannelClientServerHandshake","FBLogger","getBroadcastChannelForExecutionContext","loadTaskHandlerResource","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";async function h(a,b){var d=a.context,e=a.name,f=a.payload;try{var g=await c("loadTaskHandlerResource")(e);if(g==null)throw c("FBLogger")("messenger_web").mustfixThrow("No task handler found in context %s",e);e=await g.handleTask(f,d);g={context:d,result:e,type:"task_success"};b.postMessage(g)}catch(g){c("FBLogger")("messenger_web").catching(g).mustfix("%s executionContext: Failed to execute task %s",String(a.context.executionContext),a.name);e={context:d,reason:(f=g.message)!=null?f:"",type:"task_failure"};b.postMessage(e)}return}function a(a){var b=c("getBroadcastChannelForExecutionContext")(a);d("BroadcastChannelClientServerHandshake").listen(b);var e=new Set();b.addEventListener("message",function(a){switch(a.data.type){case"execute_task":a=a.data;var d=a.context.taskID;if(e.has(d))return;e.add(d);c("promiseDone")(h(a,b).finally(function(){e.delete(d)}));break;default:}});return function(){return b.close()}}g.default=a}),98);
__d("MAWMainWebWorker",["CurrentWorkerMessagePort","FalcoLoggerTransports","MAWBackend","MAWCommonMainWebWorker","MAWLowLevelApiImpl","MAWMainWebWorkerConfig","WABridge","WADynamicRouterSync","WorkerBridgeAdaptor","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=!((b=c("gkx")("23949"))!=null?b:!1);function a(){var a=new(c("WorkerBridgeAdaptor"))(d("CurrentWorkerMessagePort").getMessagePort(),"MAWMainWebWorker");d("WABridge").makeWABridge(new(d("WADynamicRouterSync").DynamicRouterSync)());d("MAWCommonMainWebWorker").initWorker({config:d("MAWMainWebWorkerConfig").waConfig,currentWorker:a,initBackend:d("MAWBackend").startMAWBackend,makeLowLevelApi:d("MAWLowLevelApiImpl").makeLowLevelApi});h&&d("FalcoLoggerTransports").attach()}g["default"]=a}),98);
__d("MAWMainWebWorkerV2",["MAWMainWebWorker"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=c("MAWMainWebWorker")}),98);
__d("MAWSendXMAShareMsgImplLegacy",["MAWAckLevel","MAWBridge","MAWExpiredXMACleaner","MAWFetchAndEmitThreadApi","MAWGetMsgIdByProtocolMsgId","MAWMessageSendsCommon","MAWMsgType","MAWMsgUtil","MAWOptimisticUploadManager","MAWQplProxy","MAWSendMediaMsg","MAWSendWrittenMsg","MAWSendXMAShareMsgUtils","MAWVault","MAWWriteOutgoingMsgApi","MAWXMAUtils","WAArmadilloXMA.pb","WAMediaQplHelper","WAQPLProxy","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n=d("MAWMessageSendsCommon").messageSendLogger.tags(["XMAShare"]);async function a(a,b,c,e){var f,g=function(a,b){b===void 0&&(b={}),e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c,a,{annotations:b,instanceKey:e})};g("received_message_in_wajob");var o=Boolean(a.associatedMsgContent)&&a.associatedMsgContent!=null?d("MAWVault").vault(a.associatedMsgContent):void 0,p=void 0,q=a.associatedMsgContentExternalId,r=a.args.xmaMessageType;if(r==null){n.MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["XMAMessageType is null"])));return d("WAResultOrError").makeError({isRetriable:!1,type:"xma-content-error"})}g("fetch_thread_start");await d("MAWFetchAndEmitThreadApi").fetchAndEmitThreadInTxn(a.chatJid,"sendXMAShareMsg");g("fetch_thread_end");g("write_msg_to_db_start");var s=await d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(a.xmaMsgExternalId,a.chatJid,b,a.args,d("MAWMsgType").MSG_TYPE.XMA,c,e);g("write_msg_to_db_end");if(o!=null&&q!=null){o=babelHelpers.extends({},a.args,{content:o});g("write_associated_msg_to_db_start");q=await d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(q,a.chatJid,b,o,d("MAWMsgType").MSG_TYPE.TEXT,c,e);if(q.type==="missing_thread"){n.MUSTFIX(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Failed to send xma associated msg - missing thread"])));return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"})}b=await d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(q.protocolMsgId);if(!b.success){n.MUSTFIX(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Associated Message missing in db"])));return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-referenced-msg"})}p=b.value;g("write_associated_msg_to_db_end")}if(s.type==="missing_thread"){n.MUSTFIX(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Failed to send xma - missing thread"])));return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"})}g("get_underlying_message_start");o=await d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(s.protocolMsgId);if(!o.success){n.MUSTFIX(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Message missing in db"])));return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-referenced-msg"})}var t=o.value;g("get_underlying_message_end");g("write_xma_content_to_db_start");q=a.previewFile;b=a.headerFile;o=a.faviconFile;f=babelHelpers.extends({},a.xmaArgs,{overlayIconGlyph:(f=a.xmaArgs.overlayIconGlyph)!=null?f:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.NONE,xmaLayoutType:(f=a.xmaArgs.xmaLayoutType)!=null?f:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_XMA_LAYOUT_TYPE.SINGLE});r=await d("MAWSendXMAShareMsgUtils").saveXMAContentLegacy(q,b,o,t,r,p,s.protocolMsgId,f,a.chatJid,a.args.offlineAttachmentId,g);g("write_xma_content_to_db_end");p=f.targetExpiringAtSec;f=d("MAWXMAUtils").isXMAExpired(!1,p);if(!f&&p!=null)g("add_expired+xma_cleaner_timestamp"),d("MAWExpiredXMACleaner").addNewExpiredXMACleanerTimestamp(p);else if(f){g("send_expired_written_msg_start");p=await d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:s.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(c,e),"MAWSendXMAShareMsg-isExpired");p.success===!0?(g("send_expired_written_msg_end"),d("MAWBridge").getBridge().fireAndForget("event","handleMessageSendResult",{report:{chatJid:s.protocolMsgId.chat,content:a.args.content,ephemeralSetting:a.args.ephemeralSetting,externalId:s.protocolMsgId.externalId,initiatingSource:a.args.initiatingSource,messageType:"sendMsg",quote:a.args.quote,source:a.args.source,specialTextSize:a.args.specialTextSize,xmaMessageType:a.args.xmaMessageType},success:!0},!0)):(g("send_expired_written_msg_fail",{string:{errorType:p.error.type}}),d("MAWBridge").getBridge().fireAndForget("event","handleMessageSendResult",{success:!1},!0))}g("upload_media_to_backend_start",{bool:{has_xma_favicon:r.faviconDbMedia!=null,has_xma_header:r.headerDbMedia!=null,has_xma_preview:r.previewDbMedia!=null},string:{xma_favicon_size_bucket:r.faviconDbMedia!=null?d("WAMediaQplHelper").convertIntegerSizeToStringBucket(r.faviconDbMedia.size):void 0,xma_header_size_bucket:r.headerDbMedia!=null?d("WAMediaQplHelper").convertIntegerSizeToStringBucket(r.headerDbMedia.size):void 0,xma_preview_size_bucket:r.previewDbMedia!=null?d("WAMediaQplHelper").convertIntegerSizeToStringBucket(r.previewDbMedia.size):void 0}});var u=d("MAWOptimisticUploadManager").getOptimisticUploadManager();f=await d("MAWSendXMAShareMsgUtils").uploadXMAMediasLegacy({chatJid:a.chatJid,favicon:r.faviconDbMedia!=null&&o!=null?{dbMedia:r.faviconDbMedia,file:o}:null,header:r.headerDbMedia!=null&&b!=null?{dbMedia:r.headerDbMedia,file:b}:null,optimisticUploadManager:u,preview:r.previewDbMedia!=null&&q!=null?{dbMedia:r.previewDbMedia,file:q}:null,protocolMsgId:s.protocolMsgId});p=f.filter(function(a){return!a.uploadResult.success}).length;if(p>0){n.MUSTFIX(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Failed to upload media xma"])));g("upload_media_to_backend_fail");await d("MAWMsgUtil").updateSystemAckWithTxn(t,d("MAWAckLevel").ACK.failed);return d("WAResultOrError").makeError({isRetriable:!1,type:"xma-content-error"})}g("upload_media_to_backend_end");g("write_upload_result_to_db_start");o=f.map(function(a){var b=a.uploadResult;a=a.media;return b.success===!1?Promise.resolve():d("MAWSendMediaMsg").mediaSender().perisitMediaEntryForQuickMediaSend(a.plaintextHash,t,b.value)});await Promise.all(o);g("write_upload_result_to_db_end");g("send_written_msg_start");b=await d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:s.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(c,e),"MAWSendXMAShareMsg");if(b.success===!0){g("clean_up_memory_start");f.forEach(function(a){u.delete(a.media.plaintextHash)});g("clean_up_memory_end");g("send_written_msg_end");r={chatJid:s.protocolMsgId.chat,content:a.args.content,ephemeralSetting:a.args.ephemeralSetting,externalId:s.protocolMsgId.externalId,initiatingSource:a.args.initiatingSource,messageType:"sendMsg",quote:a.args.quote,source:a.args.source,specialTextSize:a.args.specialTextSize,xmaMessageType:a.args.xmaMessageType};return d("WAResultOrError").makeResult(r)}else{g("clean_up_memory_start");f.forEach(function(a){u.delete(a.media.plaintextHash)});g("clean_up_memory_end");g("send_written_msg_fail",{string:{errorType:b.error.type}});return d("WAResultOrError").makeError(b.error)}}g.default=a}),98);